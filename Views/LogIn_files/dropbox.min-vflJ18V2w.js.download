define("dropbox",["modules/clean/sharing/shared_content_link_sync_utils","modules/clean/teams/modals/suggest_team_invite_modal","modules/clean/browse_interface","modules/clean/react/previews/preview_linkfile","modules/clean/legacy_pyxl_controllers/role_picker","modules/clean/base64","modules/clean/sharing/api/client","modules/clean/teams/team_folder_modal","modules/clean/avatar/stacked_avatars","modules/clean/sharing/share_modal_util","modules/core/uri","modules/clean/file_events","modules/clean/previews/preview_actions_helper","modules/clean/em_string","modules/constants/page_load","modules/constants/debug","libs","modules/constants/legacy","modules/clean/uirequest","modules/clean/react/file_viewer/file_preview_update_watcher","modules/clean/history","external/underscore","modules/clean/legacy_pyxl_controllers/ajax_form","modules/clean/sharing/content_info","modules/clean/ajax","modules/clean/sso_login_checks","modules/core/notify","modules/clean/sharing/api","modules/clean/search/search_helpers","modules/clean/job_progress","modules/clean/pagination_manager","modules/constants/static","modules/constants/file_viewer","modules/clean/previews/pdf_loader","modules/constants/teams","modules/constants/viewer","modules/clean/sharing/constants","modules/clean/account/email","modules/clean/dbmodal","modules/clean/flux/dispatcher","modules/clean/events/rollback","modules/clean/react/browse/constants","modules/clean/page_role_observer","modules/clean/display_format","modules/clean/event_load","modules/clean/css","modules/clean/contacts/facebook_modal","modules/clean/contacts/facebook_oauth","external/plupload_dev","external/react-dom","external/keymaster","modules/clean/image_size","modules/clean/viewer","modules/core/controller_helpers","modules/clean/sharing/shared_content_link_sync_modal","modules/constants/python","modules/clean/sprite","modules/clean/dbmodal_loading","modules/clean/undo","modules/clean/notserver","modules/clean/gandalf_util","modules/clean/multiaccount_login","modules/clean/datetime","modules/clean/downloads","modules/clean/contacts/types","external/react","modules/clean/profile_services/profile_services_constants","external/flash_detect","external/purify","modules/constants/env","modules/clean/react/previews/image_helpers","jquery","modules/core/exception","modules/clean/groups/api","require","external/modernizr","modules/clean/legacy_pyxl_controllers/bubble_picker","modules/clean/browse_events","modules/clean/react/modal","modules/clean/contacts/list","modules/clean/sharing/ui_util","modules/clean/profile_services/profile_services_link","modules/core/i18n","modules/constants/request","modules/clean/top_notif","modules/core/dom","modules/clean/web_timing_logger","modules/clean/form","modules/core/cookies","modules/clean/clipboard","modules/clean/payments/cash","modules/clean/browse/browse_drag_utils","modules/clean/account/email_verify_reasons","modules/clean/previews/util","modules/clean/payments/dfb_util","modules/clean/search/search_type","external/jquery_ui","modules/clean/contacts/cache","modules/clean/frame_messenger","modules/clean/analytics","modules/clean/photos/legacy_thumb_loader","modules/core/browser","modules/clean/react/previews/preview_blank","modules/clean/react/file_viewer/controller","modules/clean/filepath","modules/core/html","modules/clean/static_urls"],function(e,t,n,i,s,o,r,a,_,l,u,c,d,h,m,p,f,v,g,w,b,y,k,x,E,C,D,S,T,A,R,N,I,L,O,M,U,j,q,F,P,B,Y,z,H,K,W,V,J,G,X,Q,Z,ee,te,ne,ie,se,oe,re,ae,_e,le,ue,ce,de,he,me,pe,fe,ve,ge,we,be,ye,ke,xe,Ee,Ce,De,$e,Se,Te,Ae,Re,Ne,Ie,Le,Oe,Me,Ue,je,qe,Fe,Pe,Be,Ye,ze,He,Ke,We,Ve,Je,Ge,Xe,Qe,Ze){var et,tt={},nt=(i.PreviewLinkfile,s.RolePickerState),it=(r.FolderShareApiClient,l.showShareModal),st=(d.LegacyFileViewerActions,x.ContentInfo,S.SharingApi),ot=(S.UserlessSharingApi,A.Job),rt=A.ModalProgress,at=j.EmailVerification,_t=q.DBModal,lt=q.DBModalStack,ut=(q.DBUserModal,B.FileTypes,B.SharedWithActionTypes),assert=(Q.image_best_fit_size,re.NotServer,re.NotClients,we.SEVERITY,we.assert),raiseAndReport=we.raiseAndReport,reportException=we.reportException,ct=(Ce.SimpleModal,Se.LinkedProfileServices),dt=Se.ProfileServicesLinkingHandler,ht=Te.ungettext,mt=Te._,pt=(Te.N_,Te.E_,Te.render_sentences,Re.TopNotificationBar),ft=Ue.CashUtil,vt=Pe.DfBTransitionInfoFetcher,gt=ze.DefaultContactsCache,wt=ze.LegacyContactsCache;INLINE_JS.$=$,INLINE_JS.$u=y,Function.prototype.defer=Function.prototype.defer.wrap(function(e){var t;return t=$A(arguments).slice(1),e.apply(this,t)}),String.prototype.evalScripts=String.prototype.evalScripts.wrap(function(e){var t,n,i;t=$A(arguments).slice(1);try{return e.apply(this,t)}catch(e){return n=e,assert(0,n.toString())}}),et={cache:{},set:function(e,t,n){var i;return i=et.cache[e],null==i&&(i=et.cache[e]={}),i.value=t,i.expires=n?(new Date).getTime()+n:0},get:function(e){var t;return t=et.cache[e],null==t||(new Date).getTime()>t.expires?(delete et.cache[e],!1):t.value}},Function.prototype.cached=function(e){var t,n;return monkey_check(),n=Math.random(),t=this,function(){var i;return i=et.get(n),i!==!1?i:(i=t(),et.set(n,i,e),i)}},Array.prototype.sort_by_key=function(e,t){var n;return null==t&&(t=!1),monkey_check(),n=t?-1:1,this.sort(function(t,i){return t=e(t),i=e(i),i>t?-1*n:t>i?1*n:0})},Array.prototype.contains=function(e){return monkey_check(),-1!==this.indexOf(e)},Array.prototype.remove=function(e,t){return monkey_check(),t=t||e+1,this.splice(e,t-e)},Array.prototype.removeItem=function(e){var t;return monkey_check(),t=this.indexOf(e),t>=0?this.remove(t):!1},Array.prototype.dict_by=function(e){var t,n,i,s,o;for(monkey_check(),o={},t=i=0,s=this.length;s>i;t=++i)n=this[t],o[this[t][e]]=this[t];return o},Array.prototype.unique=function(){var e,t,n,i,s;for(monkey_check(),e={},n=0,i=this.length;i>n;n++){if(t=this[n],"string"!=typeof t)return this;e[t]=0}s=[];for(t in e)s.push(t);return s},String.prototype.widthSplit=function(e){var t,n,i,s;for(null==e&&(e=15),monkey_check(),t=[],n=this,s=0,i=n.substring(s,s+e);""!==i;)t.push(i),s+=e,i=n.substring(s,s+e);return t},Object.extend(Effect.Transitions,{EaseIn:function(e){return Math.pow(e,2)},EaseOut:function(e){return Math.pow(e,.5)}}),function(e){var t,n;return n=function(e){var t,n,i,s,o,r,a,_,l;if(e)if(Object.isArray(e)){for(t=[],i=0,o=e.length;o>i;i++)n=e[i],t.push(Qe.escape(n).toHTML());e=new Qe(t.join(""))}else if(e.top||e.bottom||e.before||e.after)for(_=["top","bottom","before","after"],s=0,r=_.length;r>s;s++)a=_[s],l=e[a],l&&(e[a]=arguments.callee(l));else yt.isElm(e)||e.toElement||e.toHTML||(e=Qe.escape(e));return e},Element.addMethods({db_observe:function(e,t,n){return monkey_check(),e.observe(t,function(t){return n(t,e)})},smoothScrollIntoView:function(e,t){var n,i,s,o,r,a;return null==t&&(t={}),monkey_check(),n={duration:.3,offset:0,padding:0,transition:Effect.Transitions.EaseOut},t=Object.extend(n,t),s=e.viewportOffset(e),i=e.getDimensions(),a=document.viewport.getDimensions(),r=t.padding||0,s.top>r&&s.top+i.height<a.height-r?void 0:(o=s.top<r?-1*Math.floor(a.height/4):-1*Math.floor(3*a.height/4),t.offset=t.offset||o,new Effect.ScrollTo(e,t))},__sert:function(e,t){return Element.insert(e,n(t))},__date:function(e,t){return Element.update(e,n(t))},replace:t=function(t,i){return e(t,n(i))}})}(Element.replace),String.prototype.lpad=function(e,t){var n;for(null==t&&(t="0"),monkey_check(),n=this;n.length<e;)n=t+n;return n.toString()},String.prototype.reverse=function(){var e,t,n;return monkey_check(),n=this.split(""),t=n.reverse(),e=t.join("")},String.prototype.count=function(e){return monkey_check(),(this.length-this.gsub(e,"").length)/e.length},String.prototype.repeat=function(e){return monkey_check(),new Array(e+1).join(this)},String.prototype.title=function(){return monkey_check(),this.charAt(0).toUpperCase()+this.substr(1)},Ajax.DBRequest=Class.create(Ajax.Request,{initialize:function($super,e,t){var n,i,s,o,r,a,_,l,c,d,h,f,v,g,w;if(null==t&&(t={}),monkey_check(),this.orig_req={url:e,options:t},this.start_time=le.time(),t.method=t.method||"post",t.evalJS=!1,t.suppress_nonstandard_headers=!0,t.parameters=t.parameters||{},t.parameters.t=Oe.read(Ae.JS_CSRF_COOKIE),t.parameters.is_xhr=!0,("post"===t.method.toLowerCase()||p.CPROFILE_ENABLED)&&(t.parameters.parent_request_id=Ae.REQUEST_ID),p.CPROFILE_ENABLED&&(t.parameters.cProfile=p.CPROFILE_PARAMETER),m.PUBLIC_MODE_OVERRIDE&&(t.parameters.public_mode_override="1"),m.COUNTRY_OVERRIDE&&(t.parameters.public_mode_override=m.COUNTRY_OVERRIDE),Ajax.DBRequest.restrict&&(t.parameters.restrict=Ajax.DBRequest.restrict),i=t.cleanUp||function(){},this.subject_user=t.subject_user||t.job_user,t.job&&(this.job_id=yt.nonce(),t.parameters.job_id=this.job_id,Qn.watch(this,t.dont_hide_progress_on_complete)),t.no_watch||Et.watch(this,!!t.job),d=t.onFailure,h=t.onSuccess,c=t.onComplete,l=function(e){return function(n){var i,s;return t.parameters.xhr_retry||!t.allow_retries?!1:0===(i=n.status)||500===i||502===i||503===i?(e.orig_req.options.parameters.xhr_retry=!0,e.orig_req.options.onFailure=d,e.orig_req.options.onSuccess=h,s=new Ajax.DBRequest(e.orig_req.url,e.orig_req.options),!0):!1}}(this),t.onFailure=function(n){var s,o,r;if(!ot.handled(n.request.job_id)&&!l(n))return t.noAutonotify||(!fe.IS_PROD&&500===n.status&&n.getHeader("X-Debug-Url")?(e=n.getHeader("X-Debug-Url"),s=mt("There was a problem completing this request.")+(' <a href="'+e+'" target="_blank">View debug</a>'),D.error(new Qe(s))):D.error()),i(!1),d&&d(n),403===n.status&&(r=yt.session_storage_get("reload-timestamp"),(!r||le.time()-r>3e4)&&(yt.session_storage_set("reload-timestamp",le.time()),location.reload(!0))),assert(t.noAutonotify||403===(o=n.status)||404===o||502===o,"Ajax "+n.status+" on "+n.request.url)},t.onComplete=function(e){return function(e){return e.responseText.length&&c&&0!==e.responseText.indexOf("async_task_started:")?c(e):void 0}}(this),t.onSuccess=function(n){return function(s){var o,r,a,_,c,m,p,f,v,g,w,b,y,k,x,E,C;if(C=le.time()-s.request.start_time,!ot.handled(s.request.job_id)){if(s.responseText.length){if(0===s.responseText.indexOf("err:"))t.noAutonotify||(f=s.responseText.substr(4),t.html_in_error_msg&&(f=new Qe(f)),D.error(f)),d&&d(s);else if(0===s.responseText.indexOf("async_task_started:")?(n.async_task_id=s.responseText.split(":")[1],Qn.watch(n)):h&&(0===s.responseText.indexOf("ok:")&&D.success(s.responseText.substr(3)),h(s)),E=s.getHeader("X-Server-Response-Time")||"-1",t.log_timing&&Ie.log_ajax_transition.defer(C,void 0,void 0,void 0,E,e=bt.absolutize(n.url)),r=ge("#cprofile"),!t.no_watch&&r.length){if(y=Ae.REQUEST_ID+"-"+s.getHeader("X-Dropbox-Request-Id"),e=s.request.url.replace(/[^\/]*\/\/[^\/]+/,"").replace(/\?.*$/,""),g={request_id:y},b=s.request.url,-1!==b.indexOf(fe.BLOCK_CLUSTER))g.block=1;else for(w=fe.BATCH_THUMB_ENDPOINTS,m=0,p=w.length;p>m;m++)if(c=w[m],-1!==b.indexOf(c)){g.block=1;break}o=function(e,t,n,i){var s,o;return s=ge(i?'<a target="_blank" />':"<a />"),o=s.attr("href",String(u({authority:fe.WEBSERVER,path:t,query:n}))).text(e+" ")},v=[["svg","/profile/cprofile/svg",!0],["pstats","/profile/cprofile/pstats",!1],["callgrind","/profile/cprofile/callgrind",!1],["IO","/profile/ioprofile",!0],["DB","/profile/dbprofile",!0]],x=function(){var e,t,n;for(n=[],e=0,t=v.length;t>e;e++)a=v[e],n.push(o(a[0],a[1],g,a[2]));return n}(),k=ge('<div class="ajax">').text("Ajax: "+e+" ("+E+"ms)").prepend(x),_=r.find(".ajax"),_.length>=10&&_.last().remove(),r.prepend(k)}}else if(!t.job){if(l(s))return;t.noAutonotify||s&&0===s.status||D.error(),d&&d(s)}return i(!0)}}}(this),t.onException=function(t,n){var i;if(window.console)throw n;return i="Error with AJAX callback for: "+e+" :::: "+n.toString(),reportException({err:n})},t.job&&(e+=(-1===e.indexOf("?")?"?":"&")+"long_running=1"),t.subject_user&&!(null!=(v=t.parameters)?v[M.UID_PARAM_NAME]:void 0)&&(e=u.parse(e).updateQuery(M.UID_PARAM_NAME,t.subject_user).toString()),n=$H({url:e}),t.parameters){for(n.update(t.parameters),g=n.keys(),s=0,a=g.length;a>s;s++)for(r=g[s],w=["passwd","password","oauth","ccn","host_id"],o=0,_=w.length;_>o;o++)f=w[o],-1!==r.indexOf(f)&&n.unset(r);n.unset("t")}return t.onSuccess.__tb_ajax_info__=t.onFailure.__tb_ajax_info__=Object.toJSON(n),$super(e,t)}}),"undefined"!=typeof X&&null!==X&&Object.extend(X,{main_modifier:function(){return monkey_check(),yt.is_mac()?decodeURIComponent("%E2%8C%98"):"ctrl"}}),Object.extend(Prototype.BrowserFeatures,{DB_CORS:window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}),INLINE_JS.$j=ge;var bt,yt,kt;yt=INLINE_JS.Util=tt.Util={scroll_to_thumb:function(e){var t,n,i,s;return n=e.cumulativeOffset().top,t=e.getHeight(),s=Ne.scroll_offsets().top,i=Ne.viewport_dimensions().height,s>n||n+t>s+i?Ne.scroll_to(0,n-i/2):void 0},decode_sort_key:function(e){var t,n,i,s;for(s=[],n=0,i=e.length;i>n;n++)t=e[n],"string"==typeof t?s.push(o.decode(t)):s.push(t);return s},sort_by_rank_or_key:function(e,t){return null!=e.sort_rank&&null!=t.sort_rank?e.sort_rank-t.sort_rank:(assert(null!=e.sort_key&&null!=t.sort_key,"expected sort keys on both elms"),this._sort_by_key(e,t))},sort_by_key:function(e,t){return this._sort_by_key(e,t)},_sort_by_key:function(e,t){var n,i,s,o,r;for(o=e.sort_key,r=t.sort_key,n=i=0,s=o.length;s>=0?s>i:i>s;n=s>=0?++i:--i){if(null==r[n])return 1;if(typeof o[n]!=typeof r[n])return"string"==typeof o[n]?1:-1;if(o[n]!==r[n])return o[n]>r[n]?1:-1}return r.length>o.length?-1:0},add_sort_arrow_mouseover:function(e,t,n,i){var s,o,r,a,_;for(a=$$(n),_=[],s=0,o=a.length;o>s;s++)r=a[s],_.push(function(n){var i;if(e!==n)return ie.src(n.down("img"),"web","downtick-spacer"),n.removeClassName("bolded");if(n.addClassName("bolded"),!n.hasClassName("noarrow"))return i=t?"arrow-up-gray":"arrow-down-gray",ie.src(n.down("img"),"web",i)}(r));return _},add_sort_arrow_mouseover_j:function(e,t,n,i){var s,o,r,a,_;for(a=ge(n),_=[],s=0,o=a.length;o>s;s++)r=a[s],_.push(function(n){var i;if(e.attr("data-sort")!==ge(n).attr("data-sort"))return ie.src(ge(n).find("img")[0],"web","downtick-spacer"),ge(n).removeClass("bolded");if(ge(n).addClass("bolded"),!ge(n).hasClass("noarrow"))return i=t?"arrow-up-gray":"arrow-down-gray",ie.src(ge(n).find("img")[0],"web",i)}(r));return _},one_line_fit:function(e){var t,n;return t=$$(e),t.length<2?void 0:(n=function(e){return function(){var e,i,s,o,r,a,_,l,u;if(s=t[0],a=t[t.length-1],o=s.cumulativeOffset().top,_=a.cumulativeOffset().top,o!==_){if(e=parseInt(s.getStyle("font-size"),10),u=e-1,8>u)return;for(r=0,l=t.length;l>r;r++)i=t[r],i.style.fontSize=u+"px";return n()}}}(this))()},nice_list:function(e){var t,n,i,s,o;return e?1===e.length?e[0]:2===e.length?mt("%(x)s and %(y)s").format({x:e[0],y:e[1]}):(o=mt("%(x)s, %(y)s, and %(z)s").split(/%\(x\)s|%\(y\)s|%\(z\)s/),assert(4===o.length,"bad item list format %(x)s, %(y)s, and %(z)s"),n=o[0],i=o[1],s=o[2],t=o[3],[n,e.slice(0,-1).join(i),s,e[e.length-1],t].join("")):""},list_em_snippet:function(e,t){var n,i,s,o,r,a;for(o="",t-=new h("...").length,i=s=0,r=e.length;(r>=0?r>s:s>r)&&(a=e[i],0!==i&&(a=", "+a),n=new h(a).length,!(n>t));i=r>=0?++s:--s)t-=n,o+=a;return{str:o,snipped:e.length-i}},start_of_day:function(e){var t;return t=new Date,t.setTime(e.getTime()),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t},to_iso8601_date:function(e,t,n){var i;return null==t&&(t=!1),null==n&&(n=!1),t?(i=e.getUTCFullYear().toString()+"-"+(e.getUTCMonth()+1).toString().lpad(2)+"-"+e.getUTCDate().toString().lpad(2),n&&(i+=" "+e.getUTCHours().toString().lpad(2)+":"+e.getUTCMinutes().toString().lpad(2)+":"+e.getUTCSeconds().toString().lpad(2))):(i=e.getFullYear().toString()+"-"+(e.getMonth()+1).toString().lpad(2)+"-"+e.getDate().toString().lpad(2),n&&(i+=" "+e.getHours().toString().lpad(2)+":"+e.getMinutes().toString().lpad(2)+":"+e.getSeconds().toString().lpad(2))),i},to_mysql_date:function(e,t,n){var i,s,o;return i=e.getFullYear().toString()+"-"+(e.getMonth()+1).toString().lpad(2)+"-"+e.getDate().toString().lpad(2),o=e.getHours().toString().lpad(2)+":"+e.getMinutes().toString().lpad(2)+":"+e.getSeconds().toString().lpad(2),s="."+e.getMilliseconds().toString().lpad(3),t?n?i+" "+o+s:i+" "+o:i},from_mysql_date:function(e){var t,n,i,s,o,r,a;return s=e.split(" "),t=s[0],r=s.length>1?s[1]:!1,n=t.split("-"),assert(3===n.length,"weird date format on "+this+", expected yyyy-mm-dd"),i=new Date(n[0],parseInt(n[1],10)-1,n[2]),r&&(a=r.split(":"),assert(3===a.length,"weird time format on "+this+", expected hh:mm:ss.ms"),i.setHours(a[0]),i.setMinutes(a[1]),o=a[2].split("."),i.setSeconds(o[0]),o.length>1&&i.setMilliseconds(o[1])),i},make_table:function(e,t){var n,i,s,o,r,a,_;s=new Element("table",t),o=new Element("tbody"),s.__sert(o);for(i in e)_=e[i],a=new Element("tr"),r=new Element("td").insert(i),n=new Element("td").insert(_),a.__sert(r),a.__sert(n),o.__sert(a);return s},validate_email:function(e){var t;return t=new RegExp("^['&A-Z0-9._%+-]+@[A-Z0-9-][A-Z0-9.-]*\\.[A-Z]{2,15}$","i"),t.test(e)},scrollTop:function(){return window.scrollY||document.documentElement.scrollTop||0},scrollLeft:function(){return window.scrollX||document.documentElement.scrollLeft||0},scried:{},scry:function(e){var t,n;return n=this.scried,t=n[e],t||(t=$(e),n[e]=t),t},urlquote:function(e){return e.split("/").map(encodeURIComponent).join("/")},ie8:Prototype.Browser.IE&&document.documentMode&&!0,ie:Prototype.Browser.IE,log:function(){var e,t;return fe.IS_PROD?void 0:Prototype.Browser.IE?null!=(e=$("ieconsole"))?e.innerHTML+=$A(arguments).join(" ")+"<br>":void 0:"undefined"!=typeof console&&null!==console&&null!=(t=console.log)?t.apply(console,$A(arguments)):void 0},childElement:function(e,t){var n;return n=this.childElementWithIndex(e,t),n[0]},childElementWithIndex:function(e,t){var n,i,s,o,r,a;for(n=0,a=e.childNodes,s=o=0,r=a.length;r>o;s=++o)if(i=a[s],1===i.nodeType&&n++===t)return[i,s];return[!1,!1]},disableSelection:function(e){return e.onselectstart=function(){return!1},e.unselectable="on",e.style.MozUserSelect="none",e.style.cursor="default"},enableSelection:function(e){return e.onselectstart=function(){return!0},e.unselectable="off",e.style.MozUserSelect="",e.style.cursor=""},disable_ie_image_dragging:function(){return Prototype.Browser.IE&&Prototype.Browser.IEV<9?document.ondragstart=function(){return!1}:void 0},bsearch:function(e,t,n,i){var s,o,r,a;for(n||(n=function(e,t){return e-t}),s=e.length,o=0;s>o;)if(r=Math.floor(s/2+o/2),a=n(e[r],t),a>0)s=r;else{if(!(0>a))return r;o=r+1}return i?o:-1},nonce:function(){var e,t,n;return e=new Date,n=e.getTime().toString(),t=Math.floor(1e6*Math.random()).toString().lpad(6),n+t},focus:function(e){if(e){e=$(e);try{return e.focus()}catch(e){}}},sumStyles:function(e,t){var n,i,s,o;if(i=0,e)for(s=0,o=t.length;o>s;s++)n=t[s],i+=parseInt(e.getStyle(n),10)||0;return i},smart_window_load:function(e){return"complete"===document.readyState?e.defer():Event.observe(window,"load",e)},isNumber:function(e){return!isNaN(Number(e,10))},shorten_url:function(e,t){return new Ajax.DBRequest("/shorten_url",{parameters:{url:e},onSuccess:function(e){return t(e.responseText)}})},falsy_to_empty:function(e){return e||""},preloaded_images:{},preload_image:function(e,t,n){var i;if(!this.preloaded_images[e])return i=new Image,null!=t&&Element.extend(i).observe("error",t),null!=n&&Element.extend(i).observe("load",n),i.src=e,this.preloaded_images[e]=i},get_preloaded_image:function(e){return this.preloaded_images[e]?this.preloaded_images[e].clone():new Element("img",{src:e})},clear_selected:function(){var e;if(window.getSelection){if(e=window.getSelection(),e.removeAllRanges)return e.removeAllRanges()}else if(document.selection)return document.selection.empty()},is_mac:function(){return-1!==navigator.appVersion.indexOf("Mac")},is_windows:function(){return-1!==navigator.appVersion.indexOf("Windows")},in_scrollbar:function(e){var t,n;return t=20,n=Ne.viewport_dimensions(),e>n.width-t},freshbutton_overlay:function(e,t){var n,i;return i=e instanceof jQuery&&e||ge(e),n=t instanceof jQuery&&t||ge(t),i.on("mouseover",function(e){return function(){return n.addClass("hovered")}}(this)),i.on("mouseout",function(e){return function(){return n.removeClass("hovered"),n.removeClass("pressed")}}(this)),i.on("mousedown",function(e){return function(){return n.removeClass("hovered"),n.addClass("pressed")}}(this)),i.on("mouseup",function(e){return function(){return n.removeClass("pressed")}}(this))},isElm:function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName},_track_twitter_chars_left:function(e,t){var n;return clearInterval(this.chars_left_interval),n=function(n){return function(){var n,i;return n=$("twitter-chars"),i=t-$F(e).trim().length,0>i?n.addClassName("too-long"):n.removeClassName("too-long"),n.__date(i)}}(this),this.chars_left_interval=setInterval(n,250)},session_storage_set:function(e,t){return window.sessionStorage&&window.JSON?window.sessionStorage.setItem(e,JSON.stringify(t)):void 0},session_storage_get:function(e){return window.sessionStorage&&window.JSON?JSON.parse(window.sessionStorage.getItem(e)):void 0},pdf_plugins:function(){var e,t,n;return n=/Chrome PDF|Adobe Reader|Adobe PDF|Acrobat/gi,e=function(){var e,i,s,o;for(s=window.navigator.plugins,o=[],e=0,i=s.length;i>e;e++)t=s[e],n.test(t.name)&&o.push(t);return o}()},get_window_location:function(){return window.location}},yt.scrollLeft=yt.scrollLeft.cached(50),yt.scrollTop=yt.scrollTop.cached(50),null==window.console&&(window.console={log:function(){},profile:function(){},profileEnd:function(){}}),document.observe("script:loaded",function(){var e,t,n,i,s;if(yt.ie8){for(i=$$("#page-header a, #page-footer a"),s=[],e=0,t=i.length;t>e;e++)n=i[e],"_blank"===n.target?s.push(n.target=""):s.push(void 0);return s}}),bt=tt.URLUtil={absolutize:function(e){return e.startsWith("https://")||e.startsWith("http://")?e:"/"===e.charAt(0)?window.location.protocol+"//"+window.location.host+e:assert(0,"absolutize is confused by "+e)}},kt=tt.Velocity={scroll_container:null,velocity:0,last_nonzero_velocity:0,old_y:0,max_delta_y:0,calculate_velocity:function(){return this.velocity=this.max_delta_y,0!==this.velocity&&(this.last_nonzero_velocity=this.velocity),this.max_delta_y=0},capture_new_y_pos:function(){var e,t;return null==this.old_y?void(this.old_y=null!=this.scroll_container?this.scroll_container.scrollTop:Ne.scroll_offsets().top):null==this.max_delta_y?void(this.max_delta_y=0):(t=null!=this.scroll_container?this.scroll_container.scrollTop:Ne.scroll_offsets().top,e=Math.abs(this.max_delta_y)<Math.abs(t-this.old_y),e?(this.max_delta_y=t-this.old_y,this.old_y=t):void 0)},start_capture:function(e){return this.scroll_container=e,this.velocity_calculator_interval=setInterval(this.calculate_velocity.bind(this,500)),null!=this.scroll_container?this.scroll_container.observe("scroll",this.capture_new_y_pos.bind(this)):Event.observe(window,"scroll",this.capture_new_y_pos.bind(this))},get:function(e){return null==e&&(e=!1),assert(null!=this.velocity_calculator_interval,"Haven't started capturing velocity"),e?this.last_nonzero_velocity:this.velocity}};var xt;xt=tt.DomUtil={fromElm:function(e){return $(e).innerHTML},updateFromElm:function(e,t){return e=$(e),t=$(t),e.update(this.fromElm(t))},fillVal:function(e,t){var n,i,s,o,r,a;for(s=$$("."+t),r=[],n=0,i=s.length;i>n;n++)a=s[n],a=$(a),"INPUT"===a.tagName?(a.value=e,r.push(a.defaultValue=e)):(""!==a.innerHTML||"A"!==(o=a.tagName)&&"B"!==o&&"INPUT"!==o&&"I"!==o&&"LABEL"!==o&&"SELECT"!==o&&"SPAN"!==o&&"TEXTAREA"!==o||yt.log("Filling an empty value; this may look broken in IE7",a),r.push(a.innerHTML=e));return r}};var Et;Et=tt.RequestWatcher={reqs:[],working_msg:mt("Still working...",{comment:"Comment about waiting for a process to complete"}),last_notification:null,TIMEOUT:10,watch:function(e,t){var n;return n=this.reqs,n.length||(this.int_id=setInterval(this.check_up.bind(this),500)),t&&(e.skip_message=!0),n.push([e,le.time()])},check_up:function(){return this.scan(!1)},remove:function(e){return this.scan(e)},scan:function(e){var t,n,i,s,o,r,a,_,l;for(s=le.time(),o=[],a=this.reqs,n=0,i=a.length;i>n;n++)r=a[n],_=r[0],l=r[1],t=s-l,4!==_.transport.readyState?(t>4e3&&!_.skip_message&&(_.skip_message=!0,D.isShown()&&D.current()===!oe.undo_notification&&(this.last_notification=D.success(this.working_msg))),t>1e3*this.TIMEOUT&&_.job&&_.transport.abort(),_!==e?o.push([_,l]):_.transport.abort()):this.clearWorkingMessage();return this.reqs=o,o.length?void 0:clearInterval(this.int_id)},clearWorkingMessage:function(){return D.isShown()&&D.current()===this.last_notification?D.clear():void 0}},ge(function(){var e,t,n,i;n=Prototype.Browser,i=[];for(e in n)t=n[e],t===!0&&i.push(ge(document.body).addClass(e.toLowerCase()));return i});var Ct,Dt,$t=[].slice;Ct=tt.HTML5_HISTORY=ke.history,ge(function(e){return function(){return b.init()}}(this)),Dt=tt.HashRouter={watch_timer:null,callback_map:{},last_hash:"",last_prefix:"",_get_location:function(){return window.location.href},_set_location:function(e){return window.location.href=e},_replace_location:function(e){return window.location.replace(e)},init:function(){return this.watch_timer=setInterval(this.check_hash.bind(this),300)},watch:function(e,t){return this.callback_map[e]=t,this.watch_timer?void 0:this.init()},check_hash:function(){var e,t,n,i,s,o;if(i=this._get_location().split("#")[1],null!=i&&(i=i.replace(/%27/g,"'")),this.last_hash!==i){if(this.last_hash=i,this.last_prefix&&""===i)i=this.last_prefix+":";else if(!i)return;return o=i.split(":"),s=o.first(),this.last_prefix=s,n=this.callback_map[s],null!=n&&(t=function(){var t,n,i,s;for(i=o.slice(1),s=[],t=0,n=i.length;n>t;t++)e=i[t],s.push(decodeURIComponent(e));return s}(),n.apply(null,t)),$(document).fire("db:hash_change",{hash:i})}},_prepare_hash:function(e){var t,n;return n=$A(e).map(yt.falsy_to_empty),t=n.map(encodeURIComponent),t.join(":")},set_hash:function(){var e,t;return e=1<=arguments.length?$t.call(arguments,0):[],t=this._prepare_hash(e),this._set_hash(t)},replace_hash:function(){var e,t;return e=1<=arguments.length?$t.call(arguments,0):[],t=this._prepare_hash(e),this._set_hash(t,!0)},_set_hash:function(e,t){return""===e&&(e="/"),this.last_hash=e,t?this._replace_location("#"+e):this._set_location("#"+e)}};var St;St=tt.SharingUtil=function(){function e(){}return e.success_string_for_recipients=function(e){var t;return t=1===e.length?-1===e[0].indexOf("@")?mt("Sent to %(recipient)s.",{comment:"Recipient is a user's name"}).format({recipient:e[0]}):mt("Sent to %(recipient)s.",{comment:"Recipient is an email address"}).format({recipient:e[0]}):2===e.length?-1===e[0].indexOf("@")?-1===e[1].indexOf("@")?mt("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"Recipients are users' names."}).format({recipient_first:e[0],recipient_second:e[1]}):mt("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"First recipient is a user's name, second is an email address"}).format({recipient_first:e[0],recipient_second:e[1]}):-1===e[1].indexOf("@")?mt("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"First recipient is an email address, second is a user's name"}).format({recipient_first:e[0],recipient_second:e[1]}):mt("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"Recipients are email addresses"}).format({recipient_first:e[0],recipient_second:e[1]}):-1===e[0].indexOf("@")?mt("Sent to %(recipient)s and %(num_others)s others.",{comment:"num_others is 2 or more"}).format({recipient:e[0],num_others:e.length-1}):mt("Sent to %(recipient)s and %(num_others)s others.",{comment:"num_others is 2 or more"}).format({recipient:e[0],num_others:e.length-1})},e.truncate_emails=function(e){var t;return e.length<=1500?e:(t=e.lastIndexOf(",",1500),-1===t?"":e.slice(0,t))},e}();var Tt;Tt=INLINE_JS.SharingModals=tt.SharingModals=function(){function e(){}return e.show_unshare_team_sf_modal=function(e,t,n){var i;return Ke.LegacySharingVortexLogger.log("show-unshare-team-sf-modal"),i=new Rt(e,{element_id:"unshare-confirm-modal",team_shared_folder:!0,nested_shared_folder:!1,ns_id:t,folder_path:n}),i.show()},e}();var At,Rt,Nt=function(e,t){function n(){this.constructor=e}for(var i in t)It.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},It={}.hasOwnProperty,Lt=function(e,t){return function(){return e.apply(t,arguments)}};At=tt.SharedFolderBaseModal=function(e){function t(e,n){this.user=e,this.options=n,t.__super__.constructor.call(this,this.options),this.team_shared_folder=this.options.team_shared_folder,this.nested_shared_folder=this.options.nested_shared_folder,this.path=this.options.folder_path,this.ns_id=this.options.ns_id,this.sharing_api=new st(this.user)}return Nt(t,e),t.prototype.on_show=function(){return this.sharing_api.loading_elem=this.$modal_window},t}(_t),Rt=tt.UnshareFolderModal=function(e){function t(){return this.before_show=Lt(this.before_show,this),this.on_show=Lt(this.on_show,this),this.on_confirm_button_click=Lt(this.on_confirm_button_click,this),t.__super__.constructor.apply(this,arguments)}return Nt(t,e),t.prototype.on_confirm_button_click=function(e){var t;return e.preventDefault(),t=this.$modal_window.find("#keep_files").prop("checked"),this.sharing_api.unshare_folder(this.ns_id,t,function(e){return function(){var t;return t=mt("Unshared folder '%(folder_name)s'"),t=t.format({folder_name:h.em_snippet(Xe.filename(e.path),25)}),D.success(t),document.fire(c.SF_UNSHARE,{target_ns_id:e.ns_id,user_id:e.user.id}),lt.clear()}}(this))},t.prototype.on_show=function(){return t.__super__.on_show.apply(this,arguments),this.$modal_window.find(".tsf_unshare_desc").hide(),this.$modal_window.find(".nestedsf_unshare_desc").hide(),this.$modal_window.find(".regular_unshare_desc").hide(),this.team_shared_folder?this.$modal_window.find(".tsf_unshare_desc").show():this.nested_shared_folder?this.$modal_window.find(".nestedsf_unshare_desc").show():this.$modal_window.find(".regular_unshare_desc").show()},t.prototype.before_show=function(){var e;return e=mt(this.nested_shared_folder?"Reset membership for '%(folder_name)s'":"Unshare '%(folder_name)s'"),e=e.format({folder_name:h.em_snippet(Xe.filename(this.path),21)}),this.format({".db-modal-title-text":e})},t}(At);var Ot;Ot=INLINE_JS.Sharing=tt.Sharing={include_fb:!1};var Mt;Autocompleter.Contacts=Class.create(Autocompleter.Base,{initialize:function(e,t,n,i){var s,o,r,a,_;return this.user=e,Ke.LegacySharingVortexLogger.log("initialize-autocompleter-contacts"),this.baseInitialize(t,n,i),this.options.array=!1,this.options.larray=!1,this.options.frequency=.1,this._num_contacts_shown=0,this._num_query_results=0,o=this.options.include_fb===!0,null==this.options.include_team&&(this.options.include_team=!0),_=this.options.include_team===!0,a=this.options.include_new_style_groups===!0,r=this.options.include_me===!0,this.profile_services=ct.get_linked_profile_services_for_user(this.user.id,this.update_import_contacts_link),this.link_handler=new dt,this._autocompleter_profile_services_item_tmpl=Qe.tmpl("autocompleter_item_tmpl"),this.listen(),this.possible_email_pattern=/[.@_-]/,s=function(e){return function(t){return t=e.options.include_from_linked_accounts&&e.options.viewer?t.includeForViewer(e.options.viewer):t.includeForUser(e.user.id),e.options.contact_filter?t=e.options.contact_filter(t):(o||(t=t.excludeFacebook()),a||(t=t.excludeNewStyleGroups()),_||(t=t.excludeTeamMembers()),r||(t=t.excludeMe())),e.setContacts(t)}}(this),function(){var e;return wt.load_contacts(e=!1,function(e){return s(e),wt.register_for_updates("autocompleter_contacts",s)})}.defer(),this.options.onShow=function(e,t){return t.style.position&&"absolute"!==t.style.position||(t.style.position="absolute",Ne.clone_position(ge(t),ge(e),{setHeight:!1,setTop:!1,setLeft:!1})),ge(t).fadeTo(150,1)}},link_callback:function(e){return dt.show_import_notifications(e)},getToken:function(){var e;return e=this.getTokenBounds(),this.element.value.substring(e[0],e[1])},listen:function(){
var e;return this.install_profile_services_link_listener(),e=function(e){return function(t){return e.profile_services.has_connected_services()||ge(e.element).val()?void 0:(e.activate(),setTimeout(function(){var t;return null!=(t=e.get_entry_container())?t.show():void 0},300),!0)}}(this),ge(this.element).click(e)},install_profile_services_link_listener:function(){var e;return Event.stopObserving(this.element,"blur"),e=function(e){return function(t){var n;return ge(t.target).closest("li").hasClass("profile-services-link-handler")?void 0:null!=(n=e.get_entry_container())?n.hide():void 0}}(this),ge(this.element).closest(".db-modal-box").click(e),ge(this.element).closest("#modal-box").click(e)},get_entry_container:function(){var e;return null!=(e=this.element.up(".tokenized_autocompleter_container"))?e.down(".autocomplete"):void 0},profile_services_show:function(){var e,t,n,i;return e=this.get_entry_container(),(null!=(t=e.firstChild)&&null!=(n=t.firstChild)?n.value:void 0)>0?this.old_display=e.style.display:(this.old_contents="<ul></ul>",this.old_display="none"),this.profile_services_render_buttons(),null!=(i=$("flash_copy_container"))&&i.hide(),this.element.focus()},profile_services_render_buttons:function(){var e;return e=this.get_profile_services_button_list(),this.hasFocus=!0,this.updateChoices("<ul>"+e.join("")+"</ul>")},get_profile_services_button_list:function(){var e,t,n,i,s,o;for(o=[],s=he.importable_contact_services(),t=0,n=s.length;n>t;t++)i=s[t],assert(this.profile_services.is_updated,"profile_services has not been updated"),e="",this.profile_services.service_is_connected(i)?e=mt("Connected"):this.profile_services.service_was_connected(i)&&(e=mt("Reconnect")),o.push(this._autocompleter_profile_services_item_tmpl({email_provider_num:i,email_provider_img:he.to_img(i)[0],email_provider_name:he.to_name(i),bottom_text:e}).toHTML());return o},update_import_contacts_link:function(e){return function(t){return e.profile_services=t,e.profile_services.has_unconnected_services(!0)?ge(e.element).closest("form").find(".import-contacts-link").show():ge(e.element).closest("form").find(".import-contacts-link").hide()}}(this),hide_containing_modal:function(){return this.$hidden_modals=ge(".db-modal-wrapper:visible").first(),this.$hidden_modals.length?this.$hidden_modals.css("display","none"):(this.$hidden_modals=ge("#modal:visible, #modal-overlay:visible"),this.$hidden_modals.hide())},show_containing_modal:function(){return this.$hidden_modals.show(),this.$hidden_modals=null},setContacts:function(e){return this.options.array=e.contacts,this.options.larray=e.lcontacts,this.active||this.getToken()?this.getUpdatedChoices():void 0},loadContacts:function(){var e;return e=function(e){return function(t){var n,i,s,o;return n=e.options.include_fb===!0,null==e.options.include_team&&(e.options.include_team=!0),o=e.options.include_team===!0,s=e.options.include_new_style_groups===!0,i=e.options.include_me===!0,t=e.options.include_from_linked_accounts&&e.options.viewer?t.includeForViewer(e.options.viewer):t.includeForUser(e.user.id),e.options.contact_filter?t=e.options.contact_filter(t):(n||(t=t.excludeFacebook()),s||(t=t.excludeNewStyleGroups()),o||(t=t.excludeTeamMembers()),i||(t=t.excludeMe())),e.setContacts(t)}}(this),function(){var t;return gt.load_contacts(t=!1,function(t){return e(t),gt.register_for_updates("autocompleter_contacts",e)})}.defer()},getUpdatedChoices:function(){return this.updateChoices(this.options.selector())},selectEntry:function(){var e,t,n;return t=this.getCurrentEntry(),e=this.options.array[t.value],e.type===ce.FB||e.type===ce.NEW_STYLE_GROUP?t.innerHTML=e.name:t.innerHTML=e.email,n=this.options.tokens.length>1?this.options.tokens[0]+" ":"",t.innerHTML+=n,this.active=!1,this.updateElement(t),ge(this.element).trigger("db:autocompleted")}},Mt=function(e,t){var n;return n=ge("<div>"),n.addClass(e),"string"==typeof t||t instanceof String?n.text(t):n.append(t),n},{getNumContactsShown:function(){return this._num_contacts_shown},getNumQueryResults:function(){return this._num_query_results},getContactInfoFromEmail:function(e){var t,n,i,s;for(s=this.options.array,n=0,i=s.length;i>n;n++)if(t=s[n],t.email===e)return{display_name:t.name,email:e,avatar_url:t.photo_url};return{display_name:"",email:e,avatar_url:null}},setOptions:function(e){var t;return null==e&&(e={}),t={choices:5,selector:function(e){return function(){var t,n,i,s,o,r,a,_,l,u,c,d,m,p,f,v,g,w,b,y,k,x,E,C,D,$,S,T,A,R,N,I,L,O,M,U,j,q,F,P,B,Y,z,H,K,W;for(B=[],c=e.getToken().toLowerCase(),x=e.options.array.length,o=e.options.array,R=e.options.larray,P=[],-1===c.indexOf(" ")&&P.push("\\s+"),-1===c.indexOf("+")&&P.push("\\+"),-1===c.indexOf("@")&&P.push("@"),-1===c.indexOf(".")&&P.push("\\."),-1===c.indexOf("&lt;")&&P.push("&lt;"),F=RegExp("("+P.join("|")+")"),g=0;c.length>0&&x>g;){switch(s=o[g],A=R[g],d=-1,u=[],I=[],v="",s.name=s.name?h.em_snippet(s.name,22):"",s.email_snippet=s.email?h.em_snippet(s.email,22):"",s.type){case ce.EMAIL:u.push(s.name,s.email_snippet),I.push(A.name,A.email),v="/static/images/icons/mail28-vflHfHPJ0.png";break;case ce.FB:u.push(s.name),I.push(A.name),v="https://graph.facebook.com/"+A.fb_id+"/picture";break;case ce.NEW_STYLE_GROUP:u.push(s.name,s.members),I.push(A.name,""),v="",null!=__CIRCULAR_DEPENDENCY__.GroupsListController&&(n=__CIRCULAR_DEPENDENCY__.GroupsListController.string_to_color(s.name),i=__CIRCULAR_DEPENDENCY__.GroupsListController.get_initials(s.name),m=ge("<span class='group-icon'>").css("border-color",n).css("color",n).text(i));break;default:assert(!1,"should never get here due to type: "+(s.type+", "+s.name+", "+s.email+", "+s))}for(y=p=0,D=I.length;D>p;y=++p){for(N=I[y],M=P.length?N.split(F):[N],a=0,b=0,$=M.length;$>b;b++)if(O=M[b]){if(0===O.indexOf(c)){d=a;break}a+=O.length}if(-1!==d){q=(c.length/O.length*9.4).toFixed(0),null!=s.sort_key&&(q+=s.sort_key),E=document.createTextNode(u[y].substr(0,d)),L=ge("<strong>").text(u[y].substr(d,c.length)),z=document.createTextNode(u[y].substr(d+c.length)),u[y]=[E,L,z];break}}s.type===ce.FB&&u.push(mt("Facebook message")),-1!==d&&(v?f=ge('<img width="28px" height="28px">').attr({src:v,alt:""}):m&&(f=m),U=Mt("autocomplete-line",u[0]),W=Mt("autocomplete-line autocomplete-secondary",u[1]),C=Mt("autocomplete-left",f),H=Mt(null,[U,W]),T=ge("<li>").attr("value",g).append(C,H),B.push([q,T])),g++}for(B.sort(function(e,t){return e[0]<t[0]?1:e[0]>t[0]?-1:0}),e._num_query_results=B.length,B=B.slice(0,e.options.choices),Y=ge("<ul>"),k=0,S=B.length;S>k;k++)K=B[k],Y.append(K[1]);return e._num_contacts_shown=B.length,ge(e.element).hasClass("no-profile-services-link-handler")||e.profile_services.has_unconnected_services(!0)&&(r=ge(e.element).closest(".tokenized_autocompleter_container"),j=r.attr("data-provider"),w=mt(j===he.GOOGLE?"Select from your Gmail contacts":j===he.YAHOO?"Select from your Yahoo contacts":"Select from your contacts"),_=!1,j!==he.GOOGLE&&j!==he.YAHOO||e.profile_services.service_is_connected(j)?e.profile_services.has_connected_services()&&(_=!1,w=mt("Import Contacts")):_=!0,_?(l=e._autocompleter_profile_services_item_tmpl({email_provider_num:j,email_provider_img:he.to_img(j)[0],email_provider_name:w,bottom_text:""}).toHTML(),Y.append(l)):(f=ie.make("web","user_add"),U=Mt("autocomplete-line autocomplete-line-center",w),C=Mt("autocomplete-left",f),H=Mt(null,[U]),T=ge("<li>").addClass("profile-services-link-handler").append(C,H),Y.append(T))),t=Y.wrap("<span>").parent().html(),e.old_contents=t,t}}(this)},this.options=Object.extend(t,e)}});var Ut;Ut=tt.Token=Class.create({initialize:function(e,t,n,i){return this.element=$(e),this.token_manager=n,this.hidden_input=t,this.element.token=this,this.selected=!1,this.info=i,ge(this.element).closest(".tokenized_autocompleter_container").click(this.onclick.bindAsEventListener(this))},select:function(){var e;return this.token_manager.token=this,null!=(e=this.hidden_input)&&e.element.activate(),this.selected=!0,this.element.addClassName("token_selected")},deselect:function(){return this.token_manager.token===this&&(this.token_manager.token=null),this.selected=!1,this.element.removeClassName("token_selected")},onclick:function(e){return e&&e.preventDefault&&e.preventDefault(),this.detect(e)&&!this.selected?this.select():this.deselect()},remove:function(e){return this.token_manager.remove(this)},detect:function(e){var t,n,i;for(n=e.target?e.target:e.srcElement,i=n.token,t=n;null==i&&t.parentNode;)t=t.parentNode,i=t.token;return null!=i&&i.element===this.element}});var jt;jt=tt.TokenManager=Class.create({initialize:function(e,t,n,i){return this.contact_search_logger=i,this.shift_boundary_right_func=t,this.shift_boundary_left_func=n,this.element=e,this.tokens=[],this.token=null},add:function(e){return this.tokens.push(e),this.element.fire("token:add",e.info)},populate:function(){var e,t,n,i,s,o,r;for(r=this.element.select(".token"),i=[],t=0,n=r.length;n>t;t++)o=r[t],e=o.hasClassName("token-warn"),s=new Ut(o,null,this,{external:e}),i.push(this.add(s));return i},remove:function(e){var t;return null==e&&(e=this.token),null!=e?(this.contact_search_logger.flag_record_as_removed(e.info.value),t=this.tokens.indexOf(e),this.tokens.splice(t,1),e.element.remove(),this.token===e&&t<this.tokens.length?this.tokens[t].select():(this.token=null,null!=this.shift_boundary_right_func&&this.shift_boundary_right_func()),this.element.fire("token:remove",e.info)):void 0},removeAll:function(){var e,t,n,i,s;for(s=this.tokens.slice(0),this.tokens.clear(),n=[],e=0,t=s.length;t>e;e++)i=s[e],i.element.remove(),n.push(this.element.fire("token:remove",i.info));return n},shift_left:function(){var e;return e=this.token?this.tokens.indexOf(this.token):this.tokens.length,e>0?(this.token&&this.token.deselect(),this.tokens[e-1].select()):null!=this.shift_boundary_left_func?this.shift_boundary_left_func():void 0},shift_right:function(){var e;return e=this.tokens.indexOf(this.token),this.token&&this.token.deselect(),e+1<this.tokens.length?this.tokens[e+1].select():null!=this.shift_boundary_right_func?this.shift_boundary_right_func():void 0}});var qt;qt=tt.HiddenInput=Class.create({initialize:function(e,t,n){return this.element=$(e),this.auto_complete_element=t,this.token_manager=n,Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},onKeyPress:function(e){switch(e.keyCode){case Event.KEY_LEFT:e.preventDefault(),this.token_manager.shift_left();break;case Event.KEY_TAB:e.preventDefault(),this.token_manager.shift_right();break;case Event.KEY_RIGHT:e.preventDefault(),this.token_manager.shift_right();break;case Event.KEY_BACKSPACE:case Event.KEY_DELETE:this.token_manager.remove()}return!1}});var Ft=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Autocompleter.ContactsTokenizer=Class.create(Autocompleter.Contacts,{initialize:function($super,e,t,n,i,s){var o;return this.user=e,$super(this.user,t,n,s),this.contact_search_logger=new Ke.ContactSearchLogger,this.token_manager=new jt(this.element,this.generate_shift_boundary_right_func(),null,this.contact_search_logger),this.hidden_input=new qt(i,this.element,this.token_manager),this.textbox_height=0,this.element.hacks||(this.element.should_use_borderless_hack=Prototype.Browser.WebKit,this.element.should_use_shadow_hack=Prototype.Browser.IE||Prototype.Browser.Opera,this.element.hacks=!0),(this.element.should_use_borderless_hack||this.element.should_use_shadow_hack)&&ge(this.element).parent().addClass("tokenizer_input_borderless"),this.options.onShow=function(e,t){return Ne.clone_position(ge(t),ge(e.parentNode.parentNode),{setHeight:!1,setTop:!1,setLeft:!1}),t.show()},this.options.onHide=function(e,t){return t.hide()},this.max_textbox_height=270,null!=s.max_textbox_height&&(this.max_textbox_height=s.max_textbox_height),this.members=[],null!=s.members&&(this.members=s.members),this.invitees=[],null!=s.invitees&&(this.invitees=s.invitees),this.new_style_groups=[],null!=s.new_style_groups&&(this.new_style_groups=s.new_style_groups),this.contacts_only=!1,null!=s.contacts_only&&(this.contacts_only=s.contacts_only),o=-1!==b.get_url().indexOf("/referrals")?ge("#retrieve-contacts-button"):ge(this.element).closest("form").find(".tokenizer-submit-button")[0],ge(o).on("mousedown",this.beforeSubmit.bindAsEventListener(this)),ge(this.element).on("focus",this.onFocus.bindAsEventListener(this)),this.import_links=[],s.hide_import_contacts||(this.import_links=ge(".import-contacts-link")),this.calculate_input_size(),this.dynamically_resize_input(),this.check_populated(),setInterval(this.check_populated.bind(this),100)},onClick:function(e){var t,n;return t=e.findElement("li"),this.index=t.autocompleteIndex,n=this.selectEntry(),n?void 0:this.hide()},onBlur:function($super,e){return $(this.element.parentNode).removeClassName("focused"),this.element.up(".tokenizer").removeClassName("focused"),$super(e)},onFocus:function(e){return $(this.element.parentNode).addClassName("focused"),this.element.up(".tokenizer").addClassName("focused")},beforeSubmit:function(e){return this.tokenize_emails_input(!0)},clearTokens:function(e){return this.token_manager.removeAll(),this.calculate_input_size(),this.dynamically_resize_input()},getTokenCount:function(){return this.token_manager.tokens.length},getEmails:function(){var e,t;return e=ge(this.element).closest(".tokenized_autocompleter_container").find(".token-valid").find('[name="emails"]'),function(){var n,i,s;for(s=[],n=0,i=e.length;i>n;n++)t=e[n],s.push(ge(t).val());return s}().join(", ")},check_populated:function(){var e,t;return e=$(this.element.parentNode),t=""===this.element.value&&0===this.token_manager.tokens.length,e.hasClassName("populated")&&t?e.removeClassName("populated"):e.hasClassName("populated")||t?void 0:e.addClassName("populated")},clean_email_addr:function(e,t){var n,i,s;for(i=0,s=e.length;s>i;i++)n=e[i],t=t.sub(n,"");return t.trim()},get_regexp_from_delimiters:function(e){var t,n,i,s;for(n="",i=0,s=e.length;s>i;i++)t=e[i],n+=t+"|";return new RegExp("["+n+"\\r\\n|\\r|\\n|\\t]+")},createTokenInfo:function(e,t,n){var i,s;return s=!0,i=t,n===ce.FB&&(i=e),n!==ce.EMAIL||yt.validate_email(t)?Ft.call(this.members,t)>=0?(s=!1,i=mt("Already member")):Ft.call(this.invitees,t)>=0?(s=!1,i=mt("Already invited")):n===ce.NEW_STYLE_GROUP&&(Ft.call(this.new_style_groups,t)>=0?(s=!1,i=mt("Already member group")):(s=!0,i=mt("Group"))):s=!1,t!==this.user.email&&t!==this.user.id||(i=mt("You"),s=!this.contacts_only),!e&&t&&(e=t.toString()),{display:e,value:t,type:n,valid:s,bubble_title:i}},COMPOUND_EMAIL_REGEX:/([^<>]+)<([^@>]+@[^@>]+)>/,parse_compound_email:function(e){var t,n;return t=e.match(this.COMPOUND_EMAIL_REGEX),t?n=this.createTokenInfo(t[0],t[2],ce.EMAIL):null},tokenize_emails_input:function(e,t){var n,i,s,o,r,a,_,l,u,c,d,h,m,p,f,v,g,w,b;if(i=this.options.tokens,v=this.get_regexp_from_delimiters(i),o=this.options.single_token?[this.element.value]:this.element.value.split(v),w="",e||(w=o[o.length-1],f=this.clean_email_addr(i,w),o=o.slice(0,o.length-1)," "!==(p=w[w.length-1])&&">"!==p||(f.match(this.COMPOUND_EMAIL_REGEX)||yt.validate_email(f))&&(o.push(f),w="")),n=!1,b=[],o.length>0)for(a=0,u=o.length;u>a;a++)s=o[a],g=this.parse_compound_email(s),(null!=g?g.valid:void 0)?(n=!0,this.set_input_size(1),this.addContact(g)&&(h={sort_variant:null,context:"legacy_tokenizer",contact_type:ce.EMAIL,contact_id:g.value,contact_name:g.display,did_select_suggestion:!1},this.contact_search_logger.add_record(h))):b.push(s);if(o=b,!this.options.single_token){for(m=[],_=0,c=o.length;c>_;_++)s=o[_],m.push.apply(m,s.split(" "));o=m}if(o.length>0)for(l=0,d=o.length;d>l;l++)if(s=o[l],s=this.clean_email_addr(i,s)){if(g=this.createTokenInfo(s,s,ce.EMAIL),g.valid)n=!0;else if(t)continue;this.set_input_size(1),this.addContact(g)&&(h={sort_variant:null,context:"legacy_tokenizer",contact_type:ce.EMAIL,contact_id:s,did_select_suggestion:!1},this.contact_search_logger.add_record(h))}return this.element.value!==w&&(this.element.value=w),r=this.element.up("form"),n&&Vt.clear_errors(r),this.dynamically_resize_input()},generate_shift_boundary_right_func:function(){var e,t;return e=this.element,t=function(){return e.focus()}},set_input_size:function(e){return(null==e||0>e)&&(e=20),this.element.setStyle({width:e+"px"})},calculate_input_size:function(){return this.import_links.length?(this.import_links_width=this.import_links.width(),this.import_links_visible=this.import_links.is(":visible")):void 0},dynamically_resize_input:function(){var e,t,n,i,s,o,r,a,_,l,u,c,d,h,m,p,f,v,g,w;for(m=$(this.element.parentNode.parentNode),f=parseInt(m.getStyle("width"),10)-15,p=parseInt(m.getStyle("height"),10),p!==this.textbox_height&&(this.textbox_height=p,p>=this.max_textbox_height?m.setStyle({"overflow-y":"auto"}):m.setStyle({"overflow-y":"hidden"})),r=f,e=ge(".tokenizer-link",m.parentNode),e.length>0&&(r-=e.width()),g=this.token_manager.tokens,l=!1,w=0,s=0,a=g.length;a>s;s++)v=g[s],i=v.element,n=parseInt(i.getStyle("width"),10)+parseInt(i.getStyle("margin-right"),10),c=w+n,c>f?(w=n,l=!0):n>f?(w=0,l=!0):w=c;if(u=r-w,t=7*this.element.value.length,t>u&&(u=f),this.set_input_size(u),this.import_links.length&&this.import_links_visible&&(l||f-w-t<1.25*this.import_links_width)){for(this.import_links_visible=!1,d=this.import_links,h=[],o=0,_=d.length;_>o;o++)i=d[o],h.push(ge(i).fadeOut(100));return h}},onKeyPress:function(e){var t,n;if(this.dynamically_resize_input(),this.active)switch(e.keyCode){case 44:case 188:case 59:case 186:return e.shiftKey||(this.has_selected_profile_services_entry()||this.has_selected_profile_services())&&this.tokenize_emails_input(!0),void this.reset_observer();case Event.KEY_TAB:case Event.KEY_RETURN:return this.has_selected_profile_services_entry()||this.has_selected_profile_services()?(this.tokenize_emails_input(!0),this.hide(),void Event.stop(e)):(this.selectEntry(),this.hide(),this.active=!1,void Event.stop(e));case Event.KEY_ESC:return this.hide(),this.active=!1,void Event.stop(e);case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:return this.markPrevious(),this.render(),void Event.stop(e);case Event.KEY_DOWN:return this.markNext(),this.render(),void Event.stop(e)}else{if(this.tokenize_emails_input(!1),e.keyCode===Event.KEY_TAB||e.keyCode===Event.KEY_RETURN)return this.element.value&&e.preventDefault&&e.preventDefault(),void this.tokenize_emails_input(!0);if(""===this.element.value)(t=e.keyCode)!==Event.KEY_LEFT&&t!==Event.KEY_BACKSPACE||this.token_manager.shift_left();else if((n=e.keyCode)===Event.KEY_LEFT||n===Event.KEY_RIGHT||n===Event.KEY_UP||n===Event.KEY_DOWN)return}return this.update_typeahead(),this.reset_observer()},update_typeahead:function(){return this.changed=!0,this.hasFocus=!0},reset_observer:function(){return this.observer&&clearTimeout(this.observer),this.observer=setTimeout(this.onObserverEvent.bind(this),1e3*this.options.frequency)},onObserverEvent:function($super){var e,t,n,i,s,o;if(this.active){for(o=this.element.value,s=this.options.tokens,n=0,i=s.length;i>n;n++)if(e=s[n],t=o.indexOf(e),-1!==t){if(this.has_selected_profile_services_entry())return this.tokenize_emails_input(!0),void this.hide();this.element.value=o.substr(0,t),this.selectEntry(),this.hide(),this.active=!1,this.element.value=o.substr(t+1);break}this.update_typeahead()}return this.tokenize_emails_input(!1),$super()},has_selected_profile_services:function(e){return null==e&&(e=this.getCurrentEntry()),ge(e).hasClass("profile-services-link-handler")},has_selected_profile_services_entry:function(e){var t;return null==e&&(e=this.getCurrentEntry()),0===e.value&&0!==(null!=(t=e.id)?t.length:void 0)},selectEntry:function(){var e,t,n,i,s,o,r,a,_;return t=this.getCurrentEntry(),this.has_selected_profile_services(t)?(Ke.SharedFolderActivityLogger.log("web","import_contacts_button_clicked",this.user),this.profile_services_show(),!0):this.has_selected_profile_services_entry(t)?(o="suggestion",n=t.id.split("_")[0],assert(Ft.call(he.importable_contact_services(),n)>=0,"The 'id-value' of an autocompleter-entry is not a valid Third Party contact import service"),a=he.to_name(n),this.profile_services.service_is_connected(n)?void D.success(mt("You're already connected to %(service_name)s").format({service_name:a})):Ft.call(he.importable_contact_services(),n)>=0?this.link_handler.auth_service_with_user(n,this.user.id,function(e){return function(t){return e.link_callback(t)}}(this),o):assert(!1,"Should never get here. entry_value: "+n)):(e=this.options.array[t.value],i=e.type===ce.FB?e.fb_id:e.type===ce.NEW_STYLE_GROUP?e.group_id:e.email,this.set_input_size(1),r=this.element.value,_=this.createTokenInfo(e.name.trim(),i,e.type),this.addContact(_)&&(s={sort_variant:null,context:"legacy_tokenizer",search_expr:r,selected_pos:this.index,num_query_results:this.getNumQueryResults(),contact_type:e.type,contact_id:i,contact_name:e.name.trim(),did_select_suggestion:!0},this.contact_search_logger.add_record(s)),Vt.clear_errors(this.element.up("form")),this.dynamically_resize_input(),this.index=0,this.element.focus())},addContact:function(e){var t,n,i,s,o,r,a,_,l,u,c,d,h,m,p,f,v,g,w;for(w=this.token_manager.tokens,i=0,_=w.length;_>i;i++)if(d=w[i],e.value===d.info.value)return!1;switch(this.element.value="",e.type){case ce.FB:r="fb_ids",s=new Element("img",{src:"/static/images/icons/fb_16-vflbiYTkC.png",alt:mt("Facebook")});break;case ce.EMAIL:r="emails",s=new Element("img",{src:"/static/images/icons/email_16-vflcFyDTl.png",alt:""});break;case ce.NEW_STYLE_GROUP:r="new_style_group_ids",s=new Element("img",{src:"/static/images/icons/icon_spacer-vflN3BYt2.gif",class:"sprite sprite_groups s_groups_group",alt:mt("Group")});break;case ce.INVALID:r="invalids",s=new Element("span",{class:"hidden"});break;default:assert(!1,"should never get here due to type: "+e.type)}for(h=this.getTokenClass(e),g=ge("<span class='x'>").addClass(h),g.on("click",function(e){return this.parentNode.parentNode.parentNode.parentNode.parentNode.token.remove(e),!1}),p=new Element("input",{type:"hidden",name:r,value:e.value.toString()}),d=new Element("a",{class:"title_bubble token "+h,href:"#",tabindex:"-1",title:e.bubble_title}),o=new Element("span"),this.options.wrap_name?(f=new Element("div",{class:"token-display-text"}),f.__sert(e.display),m=f,t=1):(m=e.display,t=0),u=[p,s,m],a=0,l=u.length;l>a;a++)n=u[a],o.__sert(n);return ge(o).append(g),d.__date(new Element("span").__date(new Element("span").__date(new Element("span").__date(o)))),null!=(c=$(d).down(5).next(t))&&(c.innerHTML="&nbsp;"),v=new Ut(d,this.hidden_input,this.token_manager,e),this.token_manager.add(v),this.element.up().__sert({before:d}),!0},getTokenClass:function(e){return e.valid?"token-valid":"token-error"},isTeamOnly:function(){return!1}});var Ft=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Autocompleter.TeamTokenizer=Class.create(Autocompleter.ContactsTokenizer,{initialize:function($super,e,t,n,i,s){return $super(e,t,n,i,s),this.warn_only=!s.team_only,this.element.observe("token:remove",this.notifyExternal.bind(this)),this.element.observe("token:add",this.notifyExternal.bind(this)),this.team_contacts={},this.suspended_contacts={},this.pending_contacts={},this.reloadContacts(!0)},isTeamOnly:function(){return!this.warn_only},setTeamOnly:function(e){return this.warn_only=!e,this.reloadContacts()},reloadContacts:function(e){return null==e&&(e=!1),wt.load_contacts(e=e,function(e){return function(t){return e.setContacts(t)}}(this))},setContacts:function($super,e){var t,n,i,s;for(this.team_contacts={},this.team_contacts[Z.get_viewer().work_email]=1,ge(this.element).hasClass("team-admin")||(e=e.excludeSuspended()),e=e.sortByTeamFirst(),s=e.contacts,n=0,i=s.length;i>n;n++)t=s[n],t.team&&"active"===t.join_state&&(this.team_contacts[t.email]=1),t.team&&"suspended"===t.join_state&&(this.suspended_contacts[t.email]=1),t.team&&"pending"===t.join_state&&(this.pending_contacts[t.email]=1);return $super(this.options.contact_filter?this.options.contact_filter(e):e)},createTokenInfo:function(e,t,n){var i,s,o,r,a;return a=!0,s=!1,i=t,r=!1,n===ce.FB&&(i=e),n!==ce.EMAIL||yt.validate_email(t)?Ft.call(this.members,t)>=0?(a=!1,i=mt("Already member")):Ft.call(this.invitees,t)>=0?(a=!1,i=mt("Already invited")):n!==ce.EMAIL||this.team_contacts[t]||this.pending_contacts[t]?n===ce.FB?(a=this.warn_only,s=!0):n===ce.NEW_STYLE_GROUP&&(Ft.call(this.new_style_groups,t)>=0?(a=!1,i=mt("Already member group")):(a=!0,i=mt("Group"))):(a=this.warn_only,s=!0):a=!1,t!==this.user.email&&t!==this.user.id||(i=mt("You"),a=!this.contacts_only),this.suspended_contacts[t]&&(i=mt("Suspended user"),r=!0),!e&&t&&(e=t.toString()),o={display:e,value:t,type:n,valid:a,external:s,bubble_title:i,suspended:r}},getTokenClass:function(e){return e.valid?e.suspended?"token-warn token-suspended":e.external?"token-warn":"token-valid":"token-error"},notifyExternal:function(e){var t,n,i;return i=e.memo,i.external?(n=this.token_manager.tokens.filter(function(e){return e.info.external}),t=n?n.length:0,this.element.fire("sf:token:external",{count:t})):void 0}});var Pt,Ft=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Pt=INLINE_JS.SharingModel=tt.SharingModel={ALBUM_THUMB_SIZE:260,ALBUM_PADDING:40,THUMBS_BATCH_SIZE:12,SHARING_URL_PREFIXES:["/sh","/scl","/sc"],filename:null,c2d_vars:{},is_folder:!1,is_album:!1,gallery_enabled:!1,gallery_showing:!1,file_viewer_files:[],send_link_autocompleter:null,team_only_shmodel:!1,owner_name:null,sync_vars:{},init:function(e,t){return this.filename=e,this.c2d_url=null!=t?t:"/sm/c2d",this.init_logger(),ge(".nav-close").on("click",this.close_embedded_fileviewer.bind(this)),ge(function(e){return function(){var t,n,i;return n=$("login-create-an-account"),n&&n.writeAttribute("href","/register?signup_tag=shmodel"),scrollTo(1,0),scrollTo(0,0),ge("#download_button_link[data-dl-link]").on("click",e.download_zip),e.set_viewport_size(),t=function(t,n){return e.do_c2d(n.id)},ge("#c2d-modal .login-form").on("db:login:success",t),ge("#c2d-modal .register-form").on("db:register:success",t),i=u.parse(window.location.href),i.getQuery().force_dl?(i.updateQuery({force_dl:0,dl:1}),ue.get({url:i.toString(),expected_domain:fe.PUBSERVER})):void 0}}(this))},init_folder:function(e,t,n,i,s,o,r,a,_,l,u){var c;return this.c2d_vars=e,this.sync_vars=t,null==a&&(a=!1),this.shared_link_infos=null!=_?_:null,this.share_tokens=null!=l?l:null,this.share_permissions=null!=u?u:null,this.is_folder=!0,this.gallery_enabled=n,this.gallery_showing=i,this.file_viewer_files=s,this.file_view_target=o,this.file_view_target===ne.FileViewTargetType.SHARED_CONTENT_LINK?this.file_view_origin=ne.FileViewOriginType.SHARED_CONTENT_LINK_PAGE:this.file_view_origin=ne.FileViewOriginType.SHARED_LINK_PAGE,c=this._get_sharing_url_prefix(),Ft.call(Pt.SHARING_URL_PREFIXES,c)>=0&&b.add_callback(c,this._handle_url_change,!0),ge(function(e){return function(){return e._open_file_viewer(r),e.load_thumbs(),ge("#gallery-toggle").click(function(){return e.switch_mode("gallery")}),ge("#list-toggle").click(function(){return e.switch_mode("list")}),ge(".file-link").click(function(t){return e._open_file_viewer(ge(t.currentTarget).data("mediaIndex"))})}}(this)),o===ne.FileViewTargetType.SHARED_CONTENT_LINK?this._log_scl_ttv():void 0},_get_sharing_url_prefix:function(){var e;return e=window.location.pathname.match(/^(\/s[hc]l?)\//),e?e[1]:""},_handle_url_change:function(e,t){var n;return n=Ge.isShown(),n&&!t.preview?Ge.close():void 0},_open_file_viewer:function(e){var t,n,i;if(y.isNumber(e)&&!(0>e))return i=Z.get_viewer(),t=i.is_role_signed_in(M.ROLE_WORK)?i.get_user_by_role(M.ROLE_WORK):Z.get_viewer().get_users()[0],n="react-file-viewer",Ge.open(this.file_viewer_files,e,t,n,{fileViewTarget:this.file_view_target,fileViewOrigin:this.file_view_origin,fileViewAction:ne.FileViewActionType.CLICK,sharedLinkInfos:this.shared_link_infos,shareTokens:this.share_tokens,sharePermissions:this.share_permissions}),!1},init_album:function(){return this.is_album=!0,this._resize_album_view(),Event.observe(window,"resize",this._resize_album_view.bind(this))},init_logger:function(){return ge(function(e){return function(){var e;return e=ge("#login-hover-link")[0],e&&(e.observe("click",function(){return li.log(li.CLICK_SIGN_IN)}),e.observe("click",function(){return _i.log("click_sign_in")})),$("download_button_link")&&li.attachLogListener(li.CLICK_DOWNLOAD,$("download_button_link")),e=$("add_to_my_dropbox_link"),e&&(li.attachLogListener(li.CLICK_ADD_TO_MY_DROPBOX,e),_i.attachLogListener("click_add_to_my_dropbox",e)),$$(".remove-link").length&&li.attachLogListener(li.REMOVE_LINK,$$(".remove-link")[0]),$$(".shmodel-filename").length&&li.attachLogListener(li.CLICK_FILENAME,$$(".shmodel-filename")[0]),e=$("default_content_download_button"),e&&li.attachLogListener(li.CLICK_DOWNLOAD,e),e=$("default_content_a2md"),e&&li.attachLogListener(li.CLICK_ADD_TO_MY_DROPBOX,e),e=ge("#login-create-an-account")[0],li.attachLogListener(li.CLICK_SIGNUP_THRU_DEFAULT_DROPDOWN,e),e=ge("#login-hover-cont .login-form")[0],li.attachLogListener(li.LOGIN_THRU_DEFAULT_DROPDOWN,e),ge("#share-button").click(function(e){return li.log(li.CLICK_SHARE)})}}(this))},_log_scl_ttv:function(){var e,t,n,i,s,o,r;return e=(new Date).getTime(),s=Ie.start_time(),t={ns_id:null!=(n=this.sync_vars)?n.sf_id:void 0,timing:e-s},r=Z.get_viewer().get_users(),r[0]?(o=r[0].id,i=U.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE,Ke.ShareTibEventLogger.log(o,"PREVIEW_RENDER",i,t)):void 0},set_team_only_shmodel:function(e,t){return this.team_only_shmodel=e,this.owner_name=t},_resize_album_view:function(){var e;return e=Math.floor((Ne.viewport_dimensions().width-2*this.ALBUM_PADDING)/this.ALBUM_THUMB_SIZE)*this.ALBUM_THUMB_SIZE,$("content-wrapper").setStyle({display:"block",width:e+"px"})},load_thumbs:function(){var e,t,n;return n=this.gallery_showing?$$(".gallery-icon-view img"):$$(".browse-files .icon"),t=function(e){return e.src.endsWith(ie.SPACER)||e.addClassName("thumbnail"),Ie.mark_time_to_view(),Ie.mark_time_to_interactive()},e=We.batch_load_thumbs(n,this.THUMBS_BATCH_SIZE,t),0===e?Ie.mark_time_to_interactive():void 0},switch_mode:function(e){var t,n,i,s,o,r,a;for(a=$A(["gallery","list"]),i=0,s=a.length;s>i;i++)r=a[i],n=$(r+"-view-container"),t=$(r+"-toggle"),e===r?(n.show(),t.addClassName("selected")):(n.hide(),t.removeClassName("selected"));return history.replaceState&&(o=window.location.pathname,"list"===e&&(o+="?lst"),history.replaceState({},"",o)),this.gallery_showing=!this.gallery_showing,this.load_thumbs()},set_viewport_size:function(){var e;return $(document.body).hasClassName("mobile")?(e=new Element("meta",{name:"viewport",content:"width = 480"}),document.head.appendChild(e)):void 0},toggle_dropdown:function(e,t,n){var i,s;return e&&Event.extend(e).preventDefault(),t.visible()?void 0:this.is_album?Qt.show(t,n,null,!0):(s=$$(".nav-header").first().getHeight(),i=$$(".nav-header .buttons").first().cumulativeOffset().top-4,0>i&&yt.ie8&&(i=4),Qt.show(t,n,s-i,!0))},prepare_confirm_remove_modal:function(e,t,n,i,s,o,r,a){var _,l,u;return n?(u=mt(i?"Unshare?":"Unshare album?"),_=ge("#album-disable-token-modal")[0],xt.fillVal(e.escapeHTML(),"album_unshare_name")):(o?(u=mt("Remove link created by %(name)s").format({name:r}),l=mt("You are removing the link to “%(fname)s” created by <b>%(owner)s</b>.  This link will no longer work for anyone who has it.<br/><br/>We'll notify <b>%(owner_email)s</b>.  Do you want to continue?"),l=l.format({fname:h.em_snippet(e,17),owner:r,owner_email:a})):(u=mt("Delete link to “%(name)s”?").format({name:h.em_snippet(e,17)}),l=mt("This link will no longer work for anyone who has it.")),_=ge("#disable-token-modal")[0],xt.fillVal(l,"disable-token-desc")),{title:u,contents:_}},confirm_remove:function(e,t,n,i,s,o,r,a,_,l){var u;return null==n&&(n=!1),null==i&&(i=!1),null==s&&(s=!1),null==o&&(o=null),null==r&&(r=!1),null==a&&(a=null),null==_&&(_=null),null==l&&(l=null),assert(t,"confirm_remove missing tkey"),assert(e,"confirm_remove missing name"),
assert(o,"confirm_remove missing user_id"),assert(!r||!i,"admin removal of collections not supported"),assert(!r||a,"missing link owner name for admin removal"),assert(!r||_,"missing link owner email for admin removal"),Z.get_viewer().is_uid_signed_in(o)?(u=Pt.prepare_confirm_remove_modal(e,n,i,s,o,r,a,_),en.show(u.title,u.contents,{token:t,name:e,is_album:i,user_id:o,success_callback:l})):void _e.show_modal({user_id:o,on_success:function(l){return function(){return l.confirm_remove(e,t,n,i,s,o,r,a,_)}}(this)})},confirm_remove_from_event_gid:function(e,t,n,i,s,o,r,a){var _;return null==s&&(s=!1),null==o&&(o=null),null==r&&(r=null),null==a&&(a=null),assert(t,"confirm_remove missing event gid"),assert(e,"confirm_remove missing name"),assert(i,"confirm_remove missing user_id"),assert(Z.get_viewer().is_uid_signed_in(i),"user not logged in"),assert(!s||o,"missing link owner name for admin removal"),assert(!s||r,"missing link owner email for admin removal"),_=Pt.prepare_confirm_remove_modal(e,n,!1,!1,i,s,o,r),en.show(_.title,_.contents,{name:e,user_id:i,activity_log_event_gid_dbase64:t,redirect_to_member_id:a})},do_remove:function(e){var t,n,i;return assert(e.token||e.activity_log_event_gid_dbase64,"missing token or event gid_dbase64"),t=ge("#modal-content input").first(),t.attr("disabled",!0),ge("#modal-content").addClass("ajax-loading"),i=window.location.pathname,"/links"===i||"/links/your_links"===i||"/recents"===i||i.match("^/home|^/work|^/personal")?new Ajax.DBRequest("/sm/disable/"+e.token,{subject_user:e.user_id,onSuccess:function(t){return function(){var t;return en.hide(),"function"==typeof e.success_callback&&e.success_callback(),t=mt(e.is_album?"Unshared '%(name)s'":"Deleted link to “%(name)s”"),t=t.format({name:e.name}),D.success(t),document.fire(c.LINKS_REMOVE,{token:e.token})}}(this),onComplete:function(e){return function(){return t.attr("disabled",!1),ge("#modal-content").removeClass("ajax-loading")}}(this)}):(e.token?n=u({path:"/sm/disable/"+e.token}):(n=u({path:"/sm/disable_by_event_gid/"+e.activity_log_event_gid_dbase64}),n.updateQuery("redirect_to_member_id",e.redirect_to_member_id).toString()),Vt.postRequest(n.updateQuery(M.UID_PARAM_NAME,e.user_id).toString()))},show_shmodal_onload:function(e,t,n,i){return null==i&&(i=null),ge(function(s){return function(){return b.remove_query_param("m"),Z.get_viewer().is_uid_signed_in(i)?null!=i&&at.get_for_user(Z.get_viewer().get_user_by_id(i)).verified_or_show()?s.show_shmodal(e,t,n,i):null==i?(assert(Z.get_viewer().is_paired,"Expected viewer to be paired."),s.show_share_shmodel_role_chooser(e,t,n)):void 0:void _e.show_modal({user_id:i,on_success:function(){return s.show_shmodal_onload(e,t,n,i)}})}}(this))},show_shmodal:function(e,t,n,i){var s,o,r,a,_,l,u,c,d,h;if(this.url=e,this.short_url=t,!Z.get_viewer().is_uid_signed_in(i))return void _e.show_modal({user_id:i,on_success:function(e){return function(){return e.show_shmodal(e.url,e.short_url,n,i)}}(this)});if(h=Z.get_viewer().get_user_by_id(i),at.get_for_user(h).verified_or_show()){if(c="shmodal-user-"+i,en.show(this._get_shmodal_title(h.is_team),xt.fromElm($(c))),_={},_[M.UID_PARAM_NAME]=i,Vt.add_vars("shmodal-send-form",_),this._get_thumbnail_type())for(d=$$(".shmodal-image"),l=0,u=d.length;u>l;l++)a=d[l],a.addClassName("thumbnail");return r="contacts"===n?Autocompleter.ContactsTokenizer:Autocompleter.TeamTokenizer,this.send_link_autocompleter=new r(h,c+"-new-collab-input",c+"-new-whobulk",c+"-hidden-input",{tokens:[",",";"],include_fb:!0,include_team:!0,team_only:"team_only"===n,user_id:i}),this.configure_dropdown(),this.disabled||(me.installed?(s=Me.clipboard_overlay(this.url,ge("#"+c+"-copy-link"),Pt.copied_to_clipboard),s.css({position:"fixed",zIndex:1001}),s.children().height(s.height()),clearInterval(this.follow_freshbutton),o=function(e){return function(){return Ne.clone_position(s,ge("#"+c+"-copy-link"),{offsetHeight:6,offsetWidth:6})}}(this),this.follow_freshbutton=setInterval(o,500)):$(c+"-copy-link").hide()),tn._create($("modal").down(".custom-message-container")),tn._create($("modal").down(".fb-post-sickinput")),tn._create($("modal").down(".twitter-post-sickinput")),this._populate_twitter_info(this.short_url,i),$(c+"-new-collab-input").focus(),li.log("shmodal_show")}},configure_dropdown:function(){var e,t,n,i,s;for(i=$$(".dropdown-menu-container"),t=0,n=i.length;n>t;t++)e=i[t],s=e.down(".dropdown-menu-trigger"),null!=s&&s.observe("click",function(e){return function(e){var t;return t=e.target.up(".dropdown-menu-container"),t.toggleClassName("dropdown-shown")}}(this));return document.on("click",function(e){return function(e){var t,n,i,s,o;if(!e.target.hasClassName("dropdown-menu-trigger")&&!e.target.up(".dropdown-menu-trigger")){for(s=$$(".dropdown-shown"),o=[],n=0,i=s.length;i>n;n++)t=s[n],o.push(t.removeClassName("dropdown-shown"));return o}}}(this))},copied_to_clipboard:function(){return D.success(mt("Link copied to clipboard")),en.hide(),li.log("shmodal_copy_link"),Ke.ViralLogger.log(Z.get_viewer().get_user_ids(),"shmodel","send",{src:"shmodel_copy_link",file_type:Pt.is_album?"collection":Pt.is_folder?"folder":-1===Pt.filename.indexOf(".")?"file":Jn.EXTENSION_TO_CATEGORY[Xe.file_extension(Pt.filename).toLowerCase()]||"file"})},get_shmodel_send_recipients:function(e){var t,n,i,s,o,r,a,_,l,u,c,d,h;for(assert(e,"Must pass the shmodal send form into get_shmodel_send_recipients"),t=e.select('input[name="emails"]'),n=e.select('input[name="fb_ids"]'),i=e.select('input[name="group_ids"]'),u=e.select('input[name="new_style_group_ids"]'),d=[],h=[t,n,i,u],s=0,_=h.length;_>s;s++)for(r=h[s],a=0,l=r.length;l>a;a++)o=r[a],c=o.up().innerHTML.stripTags().escapeHTML(),d.push(c.substring(0,c.indexOf("&")));return d},close_embedded_fileviewer:function(e){var t;return e.preventDefault(),t=new He,t.configureParentMessaging(function(){},["parent-ready"]),t.startListening(),t.postMessageToParent("close-fileviewer")},send_shmodel_link:function(e){var t,n,i,s;return t=$("shmodal-send-form"),assert(t,"Couldn't find the shmodal send form."),s=this.get_shmodel_send_recipients(t),i=function(e){return function(e){var t;return t=St.success_string_for_recipients(s),D.success(t),en.hide(),li.log("shmodal_send")}}(this),n=function(e){return function(e){return Vt.remove_loading()}}(this),Vt.ajax_submit(t,"/sm/share",i,n,t.down(".tokenizer-submit-button"))},show_content:function(e){var t,n,i,s;for($("shmodal-title-text").__date(Bt.to_title_str(e)),i=Bt.list,t=0,n=i.length;n>t;t++)s=i[t],s!==e&&($(Bt.to_toggle_str(s)).removeClassName("toggled"),$(Bt.to_content_str(s)).hide());return $(Bt.to_content_str(e)).show(),$(Bt.to_toggle_str(e)).addClassName("toggled"),ge("#modal .focusarea").focus()},show_send_content:function(){return this.show_content(Bt.SEND)},show_fb_content:function(){return this.show_content(Bt.FB)},show_twitter_content:function(){return this.show_content(Bt.TWITTER)},start_fb_post:function(e,t){var n,i,s,o;return i=function(n){return function(){return V.do_auth(n.do_fb_post.curry(e,t),t)}}(this),n=ge("#modal:visible, #modal-overlay:visible"),s=function(){return n.show()},V.authed_user_id===t?this.do_fb_post(e,t):Z.get_viewer().is_uid_associated(V.authed_user_id)?(n.hide(),o=new W(Z.get_viewer().get_user_by_id(t),s,i.bind(this)),o.show()):i()},start_twitter_post:function(e){return ri.is_authed(e)?this.do_twitter_post(e):ri.do_auth(this.do_twitter_post,e)},do_fb_post:function(e,t){return V.custom_show_posting=function(){return Vt.add_loading($("shmodal-fb-post-submit"))},V.custom_show_complete=function(){return en.hide(),D.success(mt("Successfully posted to Facebook")),li.log("shmodal_fb_post"),Ke.ViralLogger.log(Z.get_viewer().get_user_ids(),"shmodel","send",{src:"shmodel_fb_post",file_type:Pt.is_album?"collection":Pt.is_folder?"folder":-1===Pt.filename.indexOf(".")?"file":Jn.EXTENSION_TO_CATEGORY[Xe.file_extension(Pt.filename).toLowerCase()]||"file"})},V.post($F("shmodal-fb-post-input"),e,null,null,null,function(){return en.hide()},t)},do_twitter_post:function(e){var t;return(t=$F("shmodal-twitter-post-input"))?t.length>140?void D.error(mt("Your post must be 140 characters or less")):(ri.custom_show_posting=function(){return $("twitter-chars").hide(),Vt.add_loading($("shmodal-twitter-post-submit"))},ri.custom_post(t,function(e){return function(){return en.hide(),D.success(mt("Successfully posted to Twitter")),li.log("shmodal_tweet"),Ke.ViralLogger.log(Z.get_viewer().get_user_ids(),"shmodel","send",{src:"shmodel_twitter",file_type:Pt.is_album?"collection":Pt.is_folder?"folder":-1===Pt.filename.indexOf(".")?"file":Jn.EXTENSION_TO_CATEGORY[Xe.file_extension(Pt.filename).toLowerCase()]||"file"})}}(this),e)):void D.error(mt("Please enter a Twitter post"))},_get_shmodal_title:function(e){return null==e&&(e=!1),this.generate_title_content(this._get_shmodal_title_text(),function(e){return function(){return e.show_send_content()}}(this),function(e){return function(){return e.show_fb_content()}}(this),function(e){return function(){return e.show_twitter_content()}}(this),e)},generate_title_content:function(e,t,n,i,s){var o,r,a,_,l,u;return null==s&&(s=!1),_=ge("<div/>",{id:"shmodal-title"}),l=ge("<div/>",{id:"shmodal-title-text",text:e}),_.append(l),s||(a=ge("<a/>",{id:"shmodal-send-toggle",class:"freshtoggle ft-left toggled"}),a.html(ie.make("web","email_20")),a.on("click",t),r=ge("<a/>",{id:"shmodal-fb-toggle",class:"freshtoggle ft-middle"}),r.html(ie.make("web","fb_20")),r.on("click",n),u=ge("<a/>",{id:"shmodal-twitter-toggle",class:"freshtoggle ft-right"}),u.html(ie.make("web","twitter_20")),u.on("click",i),_.append([a,r,u])),o=ge("<div/>",{class:"clear"}),_.append(o),_[0]},_get_shmodal_title_text:function(){var e,t;return this.is_folder?(e=mt("Share link to ‘%(folder_name)s’"),e=e.format({folder_name:h.em_snippet(this.filename,15)})):(t=this._get_thumbnail_type(),t===Jn.CATEGORY_TO_TRANSLATION.IMAGE?mt("Share this image"):t===Jn.CATEGORY_TO_TRANSLATION.VIDEO?mt("Share this video"):mt("Share '%(filename)s'").format({filename:h.em_snippet(this.filename,18)}))},_get_thumbnail_type:function(){var e,t;return-1===this.filename.indexOf(".")?!1:(t=Xe.file_extension(this.filename).toLowerCase(),e=Jn.EXTENSION_TO_CATEGORY[t],!e||"IMAGE"!==e&&"VIDEO"!==e?!1:Jn.CATEGORY_TO_TRANSLATION[e])},_populate_twitter_info:function(e,t){var n,i;return n=this.is_folder?mt("Just shared some files using @Dropbox"):(i=this._get_thumbnail_type(),mt(i&&i===Jn.CATEGORY_TO_TRANSLATION.IMAGE?"Just shared an image using @Dropbox":"Just shared a file using @Dropbox")),$("shmodal-twitter-post-input").setValue(n+" "+e),yt._track_twitter_chars_left("shmodal-twitter-post-input",140),ri.is_authed(t)?ri.get_user_info(function(e){return $("shmodal-twitter-profile").down(".profile-pic").__date(new Element("img",{src:e.profile_image_url_https})),$("shmodal-twitter-profile").down(".name").__date(e.name),$("shmodal-twitter-profile").down(".username").__date("@"+e.screen_name),$("modal").down(".twitter-post-sickinput").addClassName("shrank"),$("shmodal-twitter-profile").show()},t):void 0},download_zip:function(e){var t,n,i,s,o;return t=ge("#download_button_link").attr("data-dl-link"),o=ge("#download_button_link").attr("data-test-link"),s="true"===ge("#download_button_link").attr("data-owner"),i=function(e){return function(e){var n;return"OK"===e?window.location=t:0===e.indexOf("err:")?(n=mt(s?"The zip file is too large.":"The zip file is too large. Please add it to your Dropbox."),D.error(n)):D.error(mt("Failed to download zip file.")),!1}}(this),n=function(e){return function(e){return D.error(mt("Failed to download zip file.")),!1}}(this),o&&ge.support.cors===!0?E.SilentBackgroundRequest({url:o,success:i,error:n}):window.location=t,!1},show_share_shmodel_role_chooser:function(e,t,n){return null==this.shmodel_select_role_modal&&(this.shmodel_select_role_modal=new $n({element_id:"share-shmodel-select-role-modal",link_url:e,short_url:t,tokenizer_type:n})),this.shmodel_select_role_modal.show().set_title(this._get_shmodal_title_text())},prompt_login_then_share:function(e,t,n,i){var s;return s=function(s){return function(){var s;return en.hide(),ge("#role-selector option").removeClass("disabled"),s=Z.get_viewer().get_uid_by_role(i),Z.get_viewer().sign_in_user_by_id(s),Ke.ShmodelUILogger.log("via-shmodel-viewer"),Pt.show_shmodal(e,t,n,s)}}(this),Z.get_viewer().is_role_signed_in(i)?s():_e.show_modal({role:i,on_success:s})},show_c2d_modal:function(e,t){var n,i,s,o,r;if(null==e&&(e=""),null==t&&(t=!1),e){if(e===M.ROLE_PERSONAL&&assert("forbid"!==this.team_only_shmodel,"Can't copy to personal Dropbox if restricted"),!Z.get_viewer().is_role_signed_in(e))return void _e.show_modal({role:e,on_success:function(t){return function(){return t.show_c2d_modal(e)}}(this)})}else if(Z.get_viewer().is_paired)return void new Sn({element_id:"select-role-modal"}).show();return Ke.WebMiscActivityLogger.log("show-c2d-modal",{filename:this.filename,auth_google:null!=ge.find(".auth-google")}),o=e?"#c2d-modal-"+e:"#c2d-modal",r=this._c2d_modal_msg(e,Z.get_viewer().team_name),n=this._c2d_modal_button_msg(e,Z.get_viewer().team_name),i=this._c2d_modal_desc(e,Z.get_viewer().team_name),t&&(i=this._c2d_modal_team_only_desc(Z.get_viewer().team_name)+"<br/><br/>"+i),s=this._c2d_modal_login_desc(e,Z.get_viewer().team_name),xt.fillVal(i,"c2d-desc"),xt.fillVal(s,"c2d-login-desc"),ge(".c2d-submit-button").val(n),ge(".c2d-login-register-desc").hide(),this.is_album?ge(".c2d-login-register-album-desc").show():this.is_folder?ge(".c2d-login-register-folder-desc").show():ge(".c2d-login-register-file-desc").show(),en.show(r,ge(o)[0],!1,!1,!1,!1)},_c2d_modal_msg:function(e,t){var n,i;return null==e&&(e=""),null==t&&(t=""),this.c2d_vars.title?i=this.c2d_vars.title:e===M.ROLE_PERSONAL?(i=mt("Save '%(filename)s' to my personal Dropbox"),i.format({filename:h.em_snippet(this.filename,10)})):e===M.ROLE_WORK?(i=mt("Save '%(filename)s' to my %(team_name)s Dropbox"),n=Math.max(10,15-new h(t).length),i.format({filename:h.em_snippet(this.filename,n),team_name:t})):(i=mt("Save '%(filename)s' to my Dropbox"),i.format({filename:h.em_snippet(this.filename,15)}))},_c2d_modal_button_msg:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),e===M.ROLE_PERSONAL?n=mt("Save to my personal Dropbox"):e===M.ROLE_WORK?(n=mt("Save to my %(team_name)s Dropbox"),n.format({team_name:t})):mt("Save to my Dropbox")},_c2d_modal_team_only_desc:function(e){var t;return t=mt(this.is_album?"You can only add this album to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the album to members of <b>%(team_name)s</b>.":this.is_folder?"You can only add this folder to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the folder to members of <b>%(team_name)s</b>.":"You can only add this file to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the file to members of <b>%(team_name)s</b>."),t.format({owner_name:this.owner_name,team_name:e})},_c2d_modal_desc:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),e===M.ROLE_PERSONAL?this.is_album?"warn"===this.team_only_shmodel?(n=mt("The photos and videos in this album were sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy them to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=mt("The photos and videos in this album will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):this.is_folder?"warn"===this.team_only_shmodel?(n=mt("This folder was sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy it to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=mt("This folder will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):"warn"===this.team_only_shmodel?(n=mt("This file was sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy it to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=mt("This file will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):e===M.ROLE_WORK?(n=mt(this.is_album?"The photos and videos in this album will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":this.is_folder?"This folder will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":"This file will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account."),n.format({team_name:t})):mt(this.is_album?"The photos and videos in this album will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.":this.is_folder?"This folder will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.":"This file will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.")},_c2d_modal_login_desc:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),e===M.ROLE_PERSONAL?n=mt(this.is_album?"Once you sign in to your personal Dropbox, the photos and videos in this album will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.":this.is_folder?"Once you sign in to your personal Dropbox, this folder will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.":"Once you sign in to your personal Dropbox, this file will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):e===M.ROLE_WORK?(n=mt(this.is_album?"Once you sign in to your %(team_name)s Dropbox, the photos and videos in this album will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":this.is_folder?"Once you sign in to your %(team_name)s Dropbox, this folder will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":"Once you sign in to your %(team_name)s Dropbox, this file will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account."),n.format({team_name:t})):void 0},do_c2d:function(e){var t;return assert(e,"Must specify a user_id for saving to Dropbox."),t=mt("Saving to your Dropbox..."),Z.get_viewer().is_paired&&(Z.get_viewer().get_user_by_id(e).is_team?(t=mt("Saving to your %(team_name)s Dropbox..."),t=t.format({team_name:Z.get_viewer().team_name})):t=mt("Saving to your personal Dropbox...")),D.success(t),en.hide(),new Ajax.DBRequest(this.c2d_url,{parameters:this.c2d_vars,job:this.is_folder,progress_text:t,subject_user:e,onSuccess:function(e){return function(e){return e.responseText?Ve.redirect(e.responseText):void 0}}(this)})},request_shared_folder_sync:function(t){var n;return null==t&&(t=""),n=U.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE,e.mountSharedFolder(this.sync_vars.sf_id,t,n)}};var Bt;Bt=tt.ShmodalPanes={SEND:0,FB:1,TWITTER:2,list:[0,1,2],_content_str:["shmodal-send-content","shmodal-fb-content","shmodal-twitter-content"],_toggle_str:["shmodal-send-toggle","shmodal-fb-toggle","shmodal-twitter-toggle"],_title_str:["Share by Email",mt("Share on Facebook"),mt("Share on Twitter")],to_content_str:function(e){return this._content_str[e]},to_toggle_str:function(e){return this._toggle_str[e]},to_title_str:function(e){return 0===e?Pt._get_shmodal_title_text():this._title_str[e]},to_focus_str:function(e){return this._focus_str[e]}};var Yt,zt,Lt=function(e,t){return function(){return e.apply(t,arguments)}},Nt=function(e,t){function n(){this.constructor=e}for(var i in t)It.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},It={}.hasOwnProperty;Yt=INLINE_JS.ShareLinkModal=tt.ShareLinkModal=function(e){function t(e,n,i,s,o){var r,a;this.user_id=e,null==s&&(s=!1),null==o&&(o=void 0),this.before_show=Lt(this.before_show,this),this.show=Lt(this.show,this),this.prompt_login_then_show=Lt(this.prompt_login_then_show,this),Ke.LegacySharingVortexLogger.log("construct-share-link-modal"),a={origin:i},a[M.UID_PARAM_NAME]=this.user_id,r=o?u({path:"/sm/get_link_modal_content/"+o}).toString():u({path:"/sm/share_link"+n}).toString(),t.__super__.constructor.call(this,{element_id:"share-link-modal",endpoint_url:r,parameters:a})}return Nt(t,e),t.prototype.prompt_login_then_show=function(){var e;return e=function(e){return function(){return en.hide(),ge("#role-selector option").removeClass("disabled"),Z.get_viewer().sign_in_user_by_id(e.user_id),Ke.ShmodelUILogger.log("via-shmodel-viewer"),e.show()}}(this),Z.get_viewer().is_uid_signed_in(this.user_id)?e():_e.show_modal({user_id:this.user_id,on_success:e})},t.prototype.show=function(){var e;return Ke.LegacySharingVortexLogger.log("show-share-link-modal"),e=Z.get_viewer().get_user_by_id(this.user_id),at.get_for_user(e).verified_or_show(qe.SHMODAL)?t.__super__.show.call(this):void 0},t.prototype.before_show=function(){var e,t,n,i;return i=this.$modal_window.find(".share-link-modal-content").length,i?(e={class:"ajax-loading-indicator",src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:mt("Loading...")},n=ge("<img />",e),t=ge("<div />",{class:"loading-spinner"}).append(n),this.$modal_window.find(".dynamic-content").html(t)):void 0},t}(se),zt=tt.ShareLinkModalContent=function(){function e(e,t,n,i,s,o,r,a,_,l,u){var d,m;this.owner_id=e,this.tkey=t,this.fq_path=n,this.link=i,this.filename=s,this.is_dir=o,this.tokenizer_type=r,this.tokenizer_ctx_str=a,this.is_restricted_to_members=_,this.fq_path_of_restricting_sf=u,this._send_link=Lt(this._send_link,this),this._show_shared_link_remove_confirm_modal=Lt(this._show_shared_link_remove_confirm_modal,this),this._show_shared_link_settings_modal=Lt(this._show_shared_link_settings_modal,this),this._show_shared_folder_settings_modal=Lt(this._show_shared_folder_settings_modal,this),this._select_all_text=Lt(this._select_all_text,this),this._toggle_send_link_button=Lt(this._toggle_send_link_button,this),this._toggle_recipients_outside_team_warning=Lt(this._toggle_recipients_outside_team_warning,this),this._toggle_close_button_text=Lt(this._toggle_close_button_text,this),this._close_team_prompt=Lt(this._close_team_prompt,this),this._update_team_prompt_link=Lt(this._update_team_prompt_link,this),this._display_team_upsell_prompt=Lt(this._display_team_upsell_prompt,this),this._on_add_token=Lt(this._on_add_token,this),this._mark_onboarding_as_seen=Lt(this._mark_onboarding_as_seen,this),this._add_message_checkbox_changed=Lt(this._add_message_checkbox_changed,this),this._toggle_comment_option=Lt(this._toggle_comment_option,this),this._listen=Lt(this._listen,this),this._init_autocompleter=Lt(this._init_autocompleter,this),this.$content=ge(".share-link-modal-content"),this.modal=_t.get_containing_modal(this.$content),this.modal&&("shared_folder"===this.tokenizer_type&&(this.shared_folder_members=De.create_contacts_list(l)),m={filename:this.filename,fq_path:this.fq_path,tkey:this.tkey,user_id:this.owner_id},document.fire(c.LINKS_ADD,m),ge(document).trigger(c.LINKS_ADD,m),this.modal.set_title(mt("Share link to ‘%(filename)s’").format({filename:h.em_snippet(this.filename,15)})),this.can_show_team_upsell_prompt=1===this.$content.find(".team-upsell-prompt").length,this.collab_input_id=this.tokenizer_ctx_str+"-new-collab-input",this.$collab_input=this.$content.find("#"+this.collab_input_id),this.$send_link_button=this.$content.find(".confirm-button"),this.$share_link_url_input=this.$content.find(".copy-link-input-container input[type='text']"),this.$cancel_button=this.$content.find(".cancel-button"),this.$custom_message_textarea=this.$content.find("#share-link-modal-custom-message"),this.$comment_option_container=this.$content.find(".add-message-as-comment-container"),this._init_autocompleter(),this._listen(),null!=(d=this.$share_link_url_input[0])&&d.select())}return e.prototype._init_autocompleter=function(){var e,t;return e={tokens:[",",";"],include_fb:!0,include_team:!0,team_only:"team_only"===this.tokenizer_type,user_id:this.owner_id},"shared_folder"===this.tokenizer_type?this.autocompleter=new Autocompleter.SharedFolderTokenizer(Z.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e,this.shared_folder_members):"contacts"===this.tokenizer_type?this.autocompleter=new Autocompleter.ContactsTokenizer(Z.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e):this.autocompleter=new Autocompleter.TeamTokenizer(Z.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e),t=function(e){return function(t){return function(){return e.autocompleter.contact_search_logger.log_records(e.owner_id,t)}}}(this),this.modal.logger_keydown_close_handler=t(!0),this.modal.$overlay.on("click",t(!0)),this.modal.$db_modal_x.on("click",t(!0)),this.$send_link_button.on("click",t(!1)),this.$cancel_button.on("click",t(!0)),tn.init(),this.$collab_input.focus()},e.prototype._listen=function(){var e,t,n,i,s,o,r;return this.$send_link_button.on("click",this._send_link),this.$share_link_url_input.on("click",this._select_all_text),this.$cancel_button.on("click",function(e){return function(e){return lt.pop()}}(this)),this.$content.find("#shared-link-permissions-link").on("click",this._show_shared_link_settings_modal),this.$content.find("#shared-folder-options-link").on("click",this._show_shared_folder_settings_modal),this.$content.find("#shared-link-delete-link").on("click",this._show_shared_link_remove_confirm_modal),this.$comment_option_container.length>0&&(this.$custom_message_textarea.on("input",this._toggle_comment_option),this.$comment_option_container.find("#add-message-as-comment").on("change",this._add_message_checkbox_changed),e=this.$comment_option_container.find(".bubble-dropdown-x"),e.length>0&&e.on("click",this._mark_onboarding_as_seen)),null!=(t=this.$collab_input)&&t.keyup(this._toggle_send_link_button),null!=(n=this.$collab_input)&&n.on("input",this._toggle_send_link_button),null!=(i=this.$collab_input[0])&&i.observe("token:remove",this._toggle_send_link_button),null!=(s=this.$collab_input[0])&&s.observe("token:add",this._on_add_token),null!=(o=this.$collab_input[0])&&o.observe("token:remove",this._toggle_close_button_text),null!=(r=this.$collab_input[0])&&r.observe("sf:token:external",this._toggle_recipients_outside_team_warning),this.can_show_team_upsell_prompt?(this.$content.find(".close-team-prompt-button").on("click",this._close_team_prompt),this.$content.find(".team-prompt-link").on("click",this._update_team_prompt_link)):void 0},e.prototype._toggle_comment_option=function(e){var t;return t=this.$custom_message_textarea.val().length,t>0?this.$comment_option_container.css("visibility","visible"):this.$comment_option_container.css("visibility","hidden")},e.prototype._add_message_checkbox_changed=function(e){return E.SilentBackgroundRequest({url:"/file_activity/set_share_modal_checkbox_preference",data:{fq_path:this.fq_path,checked:e.currentTarget.checked},subject_user:this.owner_id})},e.prototype._mark_onboarding_as_seen=function(e){return E.SilentBackgroundRequest({url:"/file_activity/has_seen_add_message_as_comment_onboarding",data:{fq_path:this.fq_path},subject_user:this.owner_id})},e.prototype._on_add_token=function(e){var t;return this.can_show_team_upsell_prompt&&2===(null!=(t=this.autocompleter)?t.getTokenCount():void 0)&&(this._display_team_upsell_prompt(),this.can_show_team_upsell_prompt=!1),this._toggle_close_button_text()},e.prototype._display_team_upsell_prompt=function(){var e,t,n,i;if(!(this.autocompleter.token_manager.tokens.length<2))return e=this.autocompleter.token_manager.tokens[0].info.value,t=this.autocompleter.token_manager.tokens[1].info.value,n={user_front:this.autocompleter.getContactInfoFromEmail(e),user_back:this.autocompleter.getContactInfoFromEmail(t),dimension:24},i=de.createElement(_,n),G.render(i,this.$content.find(".team-prompt-avatar-container")[0]),this.$content.find(".team-upsell-prompt-container").show()},e.prototype._update_team_prompt_link=function(e){var t,n,i,s;return t=St.truncate_emails(this.autocompleter.getEmails()),n=this.$content.find(".team-prompt-link"),s=n.attr("href"),i=u.parse(s).updateQuery({invite_members:t}),n.attr("href",i)},e.prototype._close_team_prompt=function(e){return this.$content.find(".team-upsell-prompt-container").hide()},e.prototype._toggle_close_button_text=function(e){var t,n;return n=0===(null!=(t=this.autocompleter)?t.token_manager.tokens.length:void 0),n?this.$cancel_button.text(mt("Close")):this.$cancel_button.text(mt("Cancel"))},e.prototype._toggle_recipients_outside_team_warning=function(e){var t,n;return t=ge(".external-recipient-warning-message"),t.length?(n=e.memo.count,e.memo.shared_folder_warning?n>0?t.show():t.hide():n>1?(t.find(".external-recpient-num").text(n),t.removeClass("single").show()):1===n?t.addClass("single").show():t.hide()):void 0},e.prototype._toggle_send_link_button=function(e){var t,n;return n=0===(null!=(t=this.autocompleter)?t.token_manager.tokens.length:void 0),n=n&&""===ge.trim(this.$collab_input.val()),this.$send_link_button.prop("disabled",n)},e.prototype._select_all_text=function(e){return ge(e.currentTarget)[0].select()},e.prototype._show_shared_folder_settings_modal=function(e){var t;return e.preventDefault(),t=Z.get_viewer().get_user_by_id(this.owner_id),it(t,{fqPath:this.fq_path_of_restricting_sf,isFolder:!0,origin:"SHARE_LINK_MODAL"}),lt.pop()},e.prototype._show_shared_link_settings_modal=function(e){var t;return e.preventDefault(),t=new Ht(this.owner_id,this.tkey),lt.push(t)},e.prototype._show_shared_link_remove_confirm_modal=function(e){var t;return e.preventDefault(),t=function(e){return function(){return lt.pop(),ge(document).trigger(c.LINKS_REMOVE,{fq_path:e.fq_path})}}(this),Pt.confirm_remove(this.filename,this.tkey,this.is_dir,!1,!1,this.owner_id,!1,null,null,t)},e.prototype._send_link=function(e){var t,n,i,s,o;return i=this.$content.find(".share-link-modal-send-form")[0],s=this.get_shmodel_send_recipients(i),o=function(e){return function(e){var t;return t=St.success_string_for_recipients(s),D.success(t),lt.pop(),li.log("shmodal_send")}}(this),n=function(e){return function(e){return Vt.remove_loading()}}(this),t=this.$content.find(".tokenizer-submit-button")[0],Vt.ajax_submit(i,"/sm/share",o,n,t)},e.prototype.get_shmodel_send_recipients=function(e){var t,n,i,s,o,r,a,_,l,u,c,d,h;for(assert(e,"Must pass the shmodal send form into get_shmodel_send_recipients"),t=e.select('input[name="emails"]'),n=e.select('input[name="fb_ids"]'),i=e.select('input[name="group_ids"]'),u=e.select('input[name="new_style_group_ids"]'),d=[],h=[t,n,i,u],s=0,_=h.length;_>s;s++)for(r=h[s],a=0,l=r.length;l>a;a++)o=r[a],c=o.up().innerHTML.stripTags().escapeHTML(),d.push(c.substring(0,c.indexOf("&")));return d},e}();var Ht,Kt,Nt=function(e,t){function n(){this.constructor=e}for(var i in t)It.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},It={}.hasOwnProperty,Lt=function(e,t){return function(){return e.apply(t,arguments)}},Ft=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Ht=tt.SharedLinkSettingsModal=function(e){function t(e,n,i,s,o){var r,a,_;this.owner_id=e,this.tkey=n,this.dismiss_callback=i,this.url=s,this.show_delete_link=o,Ke.LegacySharingVortexLogger.log("show-share-link-settings-modal"),r={tkey:null!=(a=this.tkey)?a:"",url:null!=(_=this.url)?_:"",
show_delete_link:this.show_delete_link},r[M.UID_PARAM_NAME]=this.owner_id,t.__super__.constructor.call(this,{element_id:"shared-link-settings-modal",endpoint_url:"/sm/shared_link_settings",parameters:r}),this.dismiss_callback&&(this.on_hide=this.dismiss_callback)}return Nt(t,e),t}(se),Kt=tt.SharedLinkSettingsModalContent=function(){function e(e,t,n,i,s,o,r){var a,_,l;this.owner_id=e,this.tkey=t,this.filename=n,this.saved_password_placeholder_value=i,this.fq_path_of_restricting_sf=s,this.fq_path=o,this.preview_type=r,this._save_settings=Lt(this._save_settings,this),this._toggle_password_input=Lt(this._toggle_password_input,this),this._enable_password_input_for_editing=Lt(this._enable_password_input_for_editing,this),this._date_change_callback=Lt(this._date_change_callback,this),this._show_calendar=Lt(this._show_calendar,this),this._hide_calendar=Lt(this._hide_calendar,this),this._future_date=Lt(this._future_date,this),this._enable_save_button=Lt(this._enable_save_button,this),this._custom_expiry_click_handler=Lt(this._custom_expiry_click_handler,this),this._hide_custom_expiry_label=Lt(this._hide_custom_expiry_label,this),this._show_custom_expiry_label=Lt(this._show_custom_expiry_label,this),this._toggle_file_preview_warning=Lt(this._toggle_file_preview_warning,this),this._toggle_expiration=Lt(this._toggle_expiration,this),this._expiry_picker_callback=Lt(this._expiry_picker_callback,this),this._show_confirm_delete_link=Lt(this._show_confirm_delete_link,this),this._show_shared_folder_settings_modal=Lt(this._show_shared_folder_settings_modal,this),this._listen=Lt(this._listen,this),this._detect_and_handle_blur_when_password_empty=Lt(this._detect_and_handle_blur_when_password_empty,this),this._is_clicked=Lt(this._is_clicked,this),this._change_password_click=Lt(this._change_password_click,this),this._init_expiration_section=Lt(this._init_expiration_section,this),this._toggle_comment_section=Lt(this._toggle_comment_section,this),this._init_comment_section=Lt(this._init_comment_section,this),this.MS_PER_DAY=864e5,K.require_css("/static/css/scooter/scooter-scoped-vflATcSDK.css"),this.PreviewHelper=Fe.PreviewHelper,this.$content=ge(".sharing-settings-modal-content"),this.modal=_t.get_containing_modal(this.$content),this.modal&&(_=h.em_snippet(this.filename,18),mt("Link settings for “%(filename)s”"),l=mt("Link permissions for '%(filename)s'").format({filename:_}),this.modal.set_title(l),this.$form=this.$content.find(".shared-link-settings-modal-form"),this.$save_button=this.$form.find(".confirm-button"),this.$password_field_container=this.$form.find(".password-field-container"),this.$password=this.$form.find(".link-password-container"),this.$password_input=this.$password.find("input[name='password']"),this.$password_label=this.$password.find("label"),this.$change_password=this.$form.find(".change-link-password-container"),this.$selected_expiry=this.$form.find(".selected-expiration"),this.$unselected_expiry=this.$form.find(".unselected-expiration"),this.$custom_expiry=this.$form.find(".custom-expiration"),this.$selected_date_box=this.$form.find(".selected-date"),this.$selected_date=this.$form.find(".selected-date-text"),this.$calendar=this.$form.find("#expiration-calendar-container"),this.$expiry_posix=this.$form.find("#expiration-posix"),this.$static_expiry=this.$form.find(".static-expiration"),this.$allow_download_no_checkbox=this.$form.find("#allow-download-no"),this.$no_download_warning=this.$form.find("#no-download-warning"),this.loaded_with_saved_password="yes"===this.$password_input.data("is-saved-password"),this._toggle_file_preview_warning(),this.loaded_with_saved_password&&this._show_password_input(a=!0),this._init_expiration_section(),this.$form.find(".comment-permissions").length&&this._init_comment_section(),this._listen())}return e.prototype._init_comment_section=function(){var e;return e=this.$form.find(".comment-permission-disabled"),e.length?e.show():(this._toggle_comment_section(),this.$content.find(".audience-selection input[type=radio]").on("change",this._toggle_comment_section))},e.prototype._toggle_comment_section=function(){var e;switch(this.$form.find(".comment-permission").hide(),e=parseInt(this.$form.find("input[name=audience]:checked").val())){case ne.TOKEN_VISIBILITY.PUBLIC:return this.$form.find(".comment-permission-anyone").show();case ne.TOKEN_VISIBILITY.TEAM_ONLY:return this.$form.find(".comment-permission-team").show();case ne.TOKEN_VISIBILITY.PASSWORD:return this.$form.find(".comment-permission-password").show()}},e.prototype._init_expiration_section=function(){var e;return this.$form.find(".expiration-selection").show(),this.$expiry_posix.val()?(ge("#expiration-yes").prop("checked",!0),e=this._posix_time_to_date(parseInt(this.$expiry_posix.val())),this._set_selected_date_text(e),this._show_custom_expiry_label()):(this.$selected_expiry.hide(),this._hide_custom_expiry_label(),this.$unselected_expiry.show())},e.prototype._change_password_click=function(e){return e.preventDefault(),this._enable_password_input_for_editing()},e.prototype._is_clicked=function(e,t){return e.is(t.target)||e.has(t.target).length},e.prototype._detect_and_handle_blur_when_password_empty=function(e){return!this.$password.is(":visible")||this.$password_input.val()||this._is_clicked(this.$password_field_container,e)?void 0:this._show_password_input(!0)},e.prototype._listen=function(){return this.loaded_with_saved_password&&(ge(window).on("click",this._detect_and_handle_blur_when_password_empty),this.$change_password.find(".change-link-password").on("click",this._change_password_click)),this.$form.on("change",this._enable_save_button),this.$form.on("submit",this._save_settings),this.$save_button.on("click",this._save_settings),this.$content.find(".cancel-button").on("click",function(e){return function(e){return lt.pop()}}(this)),this.$content.find(".audience-selection input[type=radio]").on("change",this._toggle_password_input),this.$content.find(".expiration-selection input[type=radio]").on("change",this._toggle_expiration),this.$content.find(".allow-download-selection input[type=radio]").on("change",this._toggle_file_preview_warning),this.$content.find(".delete-link").on("click",this._show_confirm_delete_link),this.$content.find("#shared-folder-options-link").on("click",this._show_shared_folder_settings_modal),ge(window).on(xe.CHANGED,this._expiry_picker_callback)},e.prototype._show_shared_folder_settings_modal=function(e){var t;return e.preventDefault(),this.modal.on_hide=null,lt.pop(),t=Z.get_viewer().get_user_by_id(this.owner_id),it(t,{fqPath:this.fq_path_of_restricting_sf,isFolder:!0,origin:"SHARE_LINK_MODAL"})},e.prototype._refreshSharedWithColumnLinkData=function(){return F.dispatch({type:ut.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{fileFqPaths:[this.fq_path]}})},e.prototype._show_confirm_delete_link=function(){var e;return e=function(e){return function(){return lt.pop(),e._refreshSharedWithColumnLinkData()}}(this),Pt.confirm_remove(this.filename,this.tkey,null,!1,!1,this.owner_id,!1,null,null,e)},e.prototype._expiry_picker_callback=function(e,t){var n,i;if(t.clicked_val!==t.old_val)return n=t.clicked_val,"custom"!==n?(i=this._future_date(parseInt(n)),this._set_expiration(i)):(this.$selected_expiry.hide(),this._show_custom_expiry_label(),this._set_selected_date_text(this._future_date(30)),this._show_calendar())},e.prototype._toggle_expiration=function(e){var t,n;return"expiration-yes"===ge(e.currentTarget).attr("id")?(this.$selected_expiry.show(),this._hide_custom_expiry_label(),this.$unselected_expiry.hide(),ee.get_controller(ge(".expiration-picker")).set_value(30),n=30,t=this._future_date(n),this._set_expiration(t),this._set_selected_date_text(t)):(this.$expiry_posix.val(""),this.$unselected_expiry.show(),this.$selected_expiry.hide(),this.$static_expiry.hide(),this._hide_custom_expiry_label(),this._hide_calendar())},e.prototype._toggle_file_preview_warning=function(){var e;return this.$allow_download_no_checkbox.is(":checked")&&(e=this.preview_type,Ft.call(this.PreviewHelper.VALID_PREVIEW_TYPES,e)<0)?this.$no_download_warning.show():this.$no_download_warning.hide()},e.prototype._show_custom_expiry_label=function(){return this.$custom_expiry.show(),this.$selected_expiry.hide(),this.$unselected_expiry.hide(),ge(window).on("click",this._custom_expiry_click_handler)},e.prototype._hide_custom_expiry_label=function(){return this.$custom_expiry.hide(),ge(window).off("click",this._custom_expiry_click_handler)},e.prototype._custom_expiry_click_handler=function(e){return this._is_clicked(this.$calendar,e)?void 0:this.$selected_date_box.is(e.target)||this.$selected_date_box.has(e.target).length?this.$calendar.is(":visible")?this.$calendar.hide():this._show_calendar():this.$calendar.is(":visible")?this.$calendar.hide():void 0},e.prototype._enable_save_button=function(e){return this.$save_button.removeAttr("disabled")},e.prototype._future_date=function(e){var t;return t=yt.start_of_day(new Date),t.setDate(t.getDate()+e),t},e.prototype._hide_calendar=function(){return this.$calendar.hide()},e.prototype._show_calendar=function(){var e,t,n;return ge(".selected-date").off("click"),this.calendar?this.$calendar.show():(n=this.$expiry_posix.val()?this._posix_time_to_date(parseInt(this.$expiry_posix.val())):this._future_date(30),t={disable_past:!0,first_day:this._future_date(1),last_day:this._future_date(365),selected_date:n,onDateChange:ge.proxy(this._date_change_callback,this)},this.calendar=new _n("expiration-calendar-container",t)),e=this.$selected_date_box.offset().left,this.$calendar.show().offset({left:e})},e.prototype._posix_time_to_date=function(e){return new Date(1e3*e)},e.prototype._set_selected_date_text=function(e){return this.$selected_date.text(ni.localize(e))},e.prototype._set_expiration=function(e){var t,n;return assert(0===e.getMilliseconds()),assert(0===e.getSeconds()),assert(0===e.getMinutes()),assert(0===e.getHours()),n=(e.getTime()+this.MS_PER_DAY)/1e3,t=n-1,this.$expiry_posix.val(t)},e.prototype._date_change_callback=function(e){return this._set_selected_date_text(e),this._set_expiration(e),this._enable_save_button(),this._hide_calendar()},e.prototype._show_password_input=function(e){var t,n,i,s,o;return null==e&&(e=!1),t=this.$content.find("label[for=audience-password]").position().left,s=this.$content.find("#audience-password").position().left,n=t-s+10,this.$password.show().css({left:n}),this.$password_input.val(""),e?(this.$password_input.addClass("disabled").attr("readonly","true"),this.$password_input.data("is-saved-password","yes"),o="●●●●●●●●",this.$password_label.text(o).show(),i=this.$password.position(),this.$change_password.css({left:i.left,top:i.top}).show()):this._enable_password_input_for_editing()},e.prototype._enable_password_input_for_editing=function(){return this.$change_password.hide(),this.$password_input.removeAttr("readonly").removeClass("disabled"),this.$password_input.data("is-saved-password","no"),this.$password_label.text(mt("Set password")).show(),this.$password_input.focus(),this._enable_save_button()},e.prototype._toggle_password_input=function(e){var t;return"audience-password"===ge(e.currentTarget).attr("id")?this._show_password_input(t=this.loaded_with_saved_password):(this.$password.hide(),this.$change_password.hide(),this.$password_input.data("is-saved-password","no"))},e.prototype._save_settings=function(e){var t,n,i,s;return"yes"===this.$password_input.data("is-saved-password")&&(i={type:"hidden",name:"password",value:this.saved_password_placeholder_value},t=ge("<input />",i),this.$form.append(t),this.$password_input.attr("name","inoperative_password")),s=function(e){return function(e){return lt.pop(),D.success(mt("Settings saved."))}}(this),n=function(e){return function(t){return e.$password.length&&e.$password.is(":visible")&&e.$password_input.focus(),Vt.remove_loading()}}(this),Vt.ajax_submit(this.$form[0],"/sm/change_shared_link_settings",s,n,this.$save_button[0])},e}();var Wt;Wt=INLINE_JS.FileOps=tt.FileOps={dir_handler:function(e,t){var n,i;return"string"==typeof t&&(t=$(t)),n=$$(".treeview .highlight")[0],n&&n.removeClassName("highlight"),i=t.up("div"),i.addClassName("highlight"),en.selected_div=i,en.shown()&&t.blur(),document.fire("db:dir_click",{path:e}),en.vars.selected_path=e},do_nonbrowse_delete:function(e,t){var n,i;return n=ge.Deferred(),i=ht("Deleted %(file_count)s item","Deleted %(file_count)s items",t.length),i=i.format({file_count:t.length}),D.success(i),new Ajax.DBRequest("/cmd/delete",{parameters:{files:t},subject_user:e,html_in_error_msg:!0,onSuccess:function(e){return document.fire(c.DELETE,{fq_paths:t}),n.resolve(e)},onFailure:function(e){return D.error(mt("Failed to perform the delete. Please try again later.")),n.reject(e)}}),n.promise()},do_folder_restore:function(e,t){var n;return n=function(t){var n,i;return n=mt("Restoring '%(folder_name)s'").format({folder_name:Xe.filename(e)}),i=t.responseText,i.startsWith("err:")?(i=i.substring(4),ge("#async-result").html(i),D.error(new Qe(i),60)):(n=mt("Restored '%(folder_name)s'").format({folder_name:Xe.filename(e)}),ge("#status-of-files").text(mt("Restored files")),D.success(n,60)),ge("#restore-done-heading").text(n),ge(".pre-restore").hide(),ge(".post-restore").show()},new Ajax.DBRequest("/cmd/restore",{parameters:{files:[e]},job:!0,html_in_error_msg:!0,progress_text:mt("Restoring..."),onSuccess:n,onFailure:n,subject_user:t})},build_revisions_uri:function(e,t,n){return null==n&&(n={}),n[M.UID_PARAM_NAME]=String(t),ae.getGandalfRule("revision_history_web")?u({path:"/history"+e}).updateQuery(n):u({path:"/revisions"+e}).updateQuery(n)}};var Vt,It={}.hasOwnProperty;Vt=INLINE_JS.Forms=tt.Forms={submitOnlyOnce:function(){var e;return e=Vt.submitted!==!0,Vt.submitted=!0,e},disable:function(e){return e?setTimeout(function(){return e.disabled=!0},0):void 0},enable:function(e){return e?setTimeout(function(){return e.disabled=!1},0):void 0},_button_on_change:function(e,t,n,i){var s,o,r,a;return s=ge(e),s[t](),null==i&&(i=s.closest("form")),o=i[0],null==this.next_id&&(this.next_id=0),r=this.next_id++,null==this.initial_vars&&(this.initial_vars={}),this.initial_vars[r]=this.collect_form_vars(o),s.attr("data-id",r),i.data("button-id",r),a=function(e){return function(){var i,a,_;s[t](),a=e.collect_form_vars(o),Object.keys(a).length!==Object.keys(e.initial_vars[r]).length&&s[n](),_=[];for(i in a)a[i]!==e.initial_vars[r][i]?_.push(s[n]()):_.push(void 0);return _}}(this),i.change(a),i.find("input").filter(":text").on("input",a),i.find("textarea").on("input",a)},show_button_on_change:function(e,t){return this._button_on_change(e,"hide","show",t)},hide_button_on_change:function(e,t){return this._button_on_change(e,"show","hide",t)},add_vars:function(e,t){var n,i,s;e=$(e),s=[];for(i in t)It.call(t,i)&&(n=new Element("input",{type:"hidden",name:i}),n.setValue(t[i]),s.push(e.__sert(n)));return s},collect_form_vars:function(e,t){var n,i,s,o,r,a;for(null==t&&(t=!1),e=e||$(document.body),i=e.select("input").concat(e.select("textarea")).concat(e.select("select")),r={},s=0,o=i.length;o>s;s++)n=i[s],n.name&&"t"!==n.name&&!ge(n).attr("data-ignore-var")&&(a=n.getValue(),(a||t)&&("string"!=typeof a&&(a=a.join(",")),null!=r[n.name]?"string"==typeof r[n.name]?r[n.name]=[r[n.name],a]:r[n.name].push(a):r[n.name]=a));return r},add_loading:function(e,t){var n;return e?(e=$(e),n=new Element("img",{src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"}),n.addClassName("text-img ajax_submit_loading"),"after"===t?ge(e).after(n):ge(e).before(n)):void 0},remove_loading:function(e){return ge(".ajax_submit_loading").remove()},ui_form_submit:function(e,t){return t=t||e.action,e.ajax_submitted?!1:(e.ajax_submitted=!0,new g(ge(e),t,{data:Vt.collect_form_vars(e),success:function(t){return function(n,i,s){var o,r;return r=ge(e).data("button-id"),null!=r?(o=ge(e).find("*[type='submit'][data-id='"+r+"']"),t.initial_vars[r]=t.collect_form_vars(e),o.hide()):void 0}}(this),complete:function(t){return function(t,n){return e.ajax_submitted=!1}}(this)}))},ajax_submit_obj:function(e){var t,n,i,s,o,r,a,_,l,u,c;return s=e.form,c=e.url,u=e.success_callback,i=e.fail_callback,t=e.button,a=e.more_vars,_=e.position,r=e.job,o=e.html_response,n=e.complete_callback,l=e.progress_text,Vt.ajax_submit(s,c,u,i,t,a,_,r,o,n,l)},ajax_submit:function(e,t,n,i,s,o,r,a,_,l,u){var c,d,h,m,p;if(null==_&&(_=!1),e.ajax_submitted)return!1;for(e.ajax_submitted=!0,p=ge(e).find(".suggestion-input"),d=0,h=p.length;h>d;d++)c=p[d],nn.blank(c.identify())();return s&&Vt.add_loading(s,r),m=Vt.collect_form_vars(e),o&&Object.extend(m,o),new Ajax.DBRequest(t||e.action,{noAutonotify:!0,parameters:m,job:a,progress_text:u,evalJSON:!1,onSuccess:function(e){return Vt.remove_loading(),n&&"function"==typeof n?n(e):void 0},onFailure:function(t){var n,s;return t&&(0===t.responseText.indexOf("err:")?(n=t.responseText.substr(4),0===n.indexOf("{")?(s=n.evalJSON(!0),Vt.fill_errors(e,s)):(_&&(n=new Qe(n)),D.error(n))):D.error(),Vt.remove_loading(),i&&"function"==typeof i)?i(t):void 0},onComplete:function(t){var n,i,s;for(s=e.select(".suggestion-input"),n=0,i=s.length;i>n;n++)c=s[n],nn.blur_elm(c);return e.ajax_submitted=!1,l&&"function"==typeof l?l(t):void 0}}),!1},clear_errors:function(e){return e=e||$(document.body),this.hide_errors(e),e.select(".error-removable").invoke("remove")},fill_errors:function(e,t){var n,i,s,o,r,a;t=t||{},e=e||$(document.body),Vt.clear_errors(e);for(r in t)It.call(t,r)&&(i=e.down("[data-error-field-name='"+r+"']")||e.down("[name='"+r+"']"),i&&(n=new Element("br",{class:"error-removable"}),s=new Element("span",{class:"error-message error-removable"}),o=t[r],assert(o.message_html||o.message_text,"Error message must have a message_html or message_text property"),o.message_html?s.update(o.message_html):s.__date(o.message_text),ge(i).before(s),ge(i).before(n),a=ge(e).find("input[name='"+r+"'], textarea[name='"+r+"']"),a&&a.addClass("input-error")));return this.show_errors(e)},value:function(e){var t,n,i,s,o;for(i=$$('input[name="'+e+'"]'),o=null,t=0,s=i.length;s>t;t++)n=i[t],o=$(n).getValue()||o;return o},postRequest:function(e,t,n){var i;return null==t&&(t={}),null==n&&(n={}),assert(null!=e,"postRequest missing action"),t.t=Oe.read(Ae.JS_CSRF_COOKIE),i=new Element("form",{action:e,method:"POST"}),n.target&&(i.target=n.target),document.body.appendChild(i),Vt.add_vars(i,t),i.submit()},hide_errors:function(e){var t,n,i,s,o;for(t=this.get_errors(e),s=[],n=0,i=t.length;i>n;n++)o=t[n],o.down("span.error-message")?s.push(o.hide()):s.push(void 0);return s},show_errors:function(e){var t,n,i,s;for(t=this.get_errors(e),n=0,i=t.length;i>n;n++)s=t[n],s.down("span.error-message")&&s.show();return ge(".sick-input").find("label").css("top","")},get_errors:function(e){var t,n;return n=".error-bubble, .error-plain-text",t=e?e.select(n):$$(n)}},ge(function(){return Vt.show_errors()});var Jt;Jt=tt.ActAsBlock={elm_list:["margin-left","margin-right","padding-left","padding-right","border-left-width","border-right-width"],parent_list:["padding-left","padding-right","border-left-width","border-right-width"],register:function(e,t){var n,i,s,o;for(null==t&&(t=document.body),s=$(t).getElementsByClassName("act_as_block"),o=[],n=0,i=s.length;i>n;n++)e=s[n],o.push(this.resize(e));return o},resize:function(e){var t,n,i,s;return e=$(e),n=e.up(),t=yt.sumStyles(e,this.elm_list),i=yt.sumStyles(n,this.parent_list),e.style.width="1px",s=n.getWidth()-t-i,s>0?e.style.width=s+"px":void 0}};var Gt;Gt=tt.BrowseStyleRows={register_all:function(){var e,t,n,i;for(n=$$(".bs-row"),e=0,t=n.length;t>e;e++)i=n[e],this.register(i);return Event.observe(document,"click",this.kill_current.bind(this)),ge(document).on("dropdown-opened",this.kill_current.bind(this))},register:function(e){var t;return e=$(e),e.db_observe("mouseover",this.mouseover.bind(this)),e.db_observe("mouseout",this.mouseout.bind(this)),t=e.down(".action-button"),t?t.db_observe("click",this.click.bind(this)):void 0},mouseover:function(e,t){return t.hasClassName("no-hover")?void 0:t.addClassName("hover")},mouseout:function(e,t){return t.removeClassName("hover")},click:function(e,t){var n,i,s;if("A"!==e.target.tagName)return i=t.up(".bs-row"),Event.stop(e),i.hasClassName("selected")?void this.kill_current(!1):(ge(document).trigger("dropdown-opened"),this.kill_current(!1),s=$(e.target),s.match(".bs-actions-list *")||i.addClassName("selected"),n=s.hasClassName("bs-row")?s:s.up(".bs-row"),n.style.zIndex=9)},kill_current:function(e){var t,n,i,s,o;for(s=$$(".bs-row.selected"),o=[],n=0,i=s.length;i>n;n++)t=s[n],t.removeClassName("selected"),o.push(t.style.zIndex="");return o}};var Xt;Xt=tt.Bubble={make:function(e,t,n,i,s){var o,r,a,_,l,u,c,d,h,m,p,f,v,g,w,b,y,k,x,E;return null==t&&(t="left"),s=null!=s?s:{},["left","right"].contains(t)?(n=n||"middle",assert(["top","middle","bottom"].contains(n),"expected tail position ['top', 'middle', 'bottom'], got "+n)):["bottom","top"].contains(t)?(n=n||"center",assert(["left","center","right"].contains(n),"expected tail position ['left', 'center', 'right'], got "+n)):["none"].contains(t)||assert(!1,"unexpected tail side, got "+t),f=new Element("table"),"titled"===s.style?(f.addClassName("bluebubble"),v="bluebubble"):(f.addClassName("bubble"),v="bubble"),i&&(f.style.width=i+"px"),w=new Element("tbody"),k=new Element("tr"),b=new Element("td"),b.addClassName("tl"),p=new Element("td"),p.addClassName("t"),"titled"===s.style&&i&&(p.style.width=i-42+"px"),y=new Element("td"),y.addClassName("tr"),"top"===t&&(g=new Element("img",{src:"/static/images/"+v+"_arrow_top.png"}),g.addClassName("tarrow"),"titled"===s.style?(g.addClassName("arrow-"+n),r=new Element("div"),r.addClassName("arrow-container"),i&&(r.style.width=i-42+"px"),r.__sert(g),p.__sert(r)):(p.style.textAlign=n,p.__sert(g))),k.__sert(b),k.__sert(p),k.__sert(y),w.__sert(k),x=new Element("tr"),d=new Element("td"),d.addClassName("l"),"left"===t&&(o="titled"===s.style?new Element("img",{src:"/static/images/bluebubble_arrow_left-vfl8zzy_-.png"}):new Element("img",{src:"/static/images/bubble_arrow-vfl8m7tk-.png"}),o.addClassName("arrow"),d.__sert(o),d.vAlign=n),c=new Element("td"),c.addClassName("c"),c.update(e),h=new Element("td"),h.addClassName("r"),"right"===t&&(m=new Element("img",{src:"/static/images/bubble_arrow_right-vflmW3_2s.png"}),m.addClassName("rarrow"),h.__sert(m),h.vAlign=n),x.__sert(d),x.__sert(c),x.__sert(h),w.__sert(x),E=new Element("tr"),l=new Element("td"),l.addClassName("bl"),a=new Element("td"),a.addClassName("b"),"bottom"===t&&(_=new Element("img",{src:"/static/images/"+v+"_arrow_bottom.png"}),_.addClassName("barrow"),"titled"===s.style?(_.addClassName("arrow-"+n),r=new Element("div"),r.addClassName("arrow-container"),i&&(r.style.width=i-42+"px"),r.__sert(_),a.__sert(r)):(a.style.textAlign=n,a.__sert(_))),u=new Element("td"),u.addClassName("br"),E.__sert(l),E.__sert(a),E.__sert(u),w.__sert(E),f.__sert(w),f}};var Qt;Qt=INLINE_JS.FreshDropdown=tt.FreshDropdown={show:function(e,t,n,i){var s,o,r,a;return null==i&&(i=!1),ge(document).trigger("dropdownOpened",[1]),s=ge(t),n||(n=s[0].offsetHeight+10),this.hide_all(),o=ge(e).show(),a=o[0].offsetWidth,r=s[0].offsetWidth,Ne.clone_position(o,s,{setHeight:!1,setWidth:!1,offsetLeft:-1*(a-r)+22,offsetTop:n}),i&&o.width(a),s.addClass("pressed"),function(e){return function(){return document.observe("click",Qt.hide_all)}}(this).defer()},hide_all:function(e){var t,n;return n=ge(".freshdropdown-menu"),t=0,n.each(function(){return ge(this).is(":visible")?t+=1:void 0}),n.hide(),ge(document).trigger("dropdownClosed",[t]),$$(".freshdropdown-button").invoke("removeClassName","pressed"),document.stopObserving("click",Qt.hide_all)}};var Zt;Zt=tt.JumpWatcher={inverval:null,last_hash:null,last_page_offset:0,check:function(){return window.location.href.endsWith("#")&&0===window.pageYOffset&&0!==Zt.last_page_offset?this.report():(this.last_page_offset=window.pageYOffset,this.last_hash=u.parse(window.location.href).fragment)},report:function(){return clearInterval(Zt.interval),raiseAndReport("Hash jump detected, last hash = "+this.last_hash+". You may have an onclick handler that isn't firing, or you are not preventing the default action (eg. by returning false in your handler)")}};var en;en=INLINE_JS.Modal=tt.Modal={KEY_SCOPE:"modal",width:640,vertical_offset:90,show:function(e,t,n,i,s,o,r,a,_){var l,u,c,d,h,m;return null==n&&(n=!1),null==i&&(i=!1),null==s&&(s=!1),null==o&&(o=!1),null==r&&(r=""),null==a&&(a=!0),null==_&&(_=!1),en.shown()&&en._cleanup(),s=s||this.width,u="#modal-content .error-message, #modal-content .error-removable, #modal-content .error-bubble",$$(u).invoke("hide"),assert(t,"Missing modal content!"),h=this.vars._prev_scope,this.vars=n||{},this.vars._prev_scope=h,$("modal").setStyle({width:s+"px",margin:"0 0 0 "+Math.floor(-s/2).toString()+"px"}),this.vars.extra_class="",r&&($("modal").addClassName(r),this.vars.extra_class=r),o||(d=yt.childElement($("modal-content"),0),d&&d!==t&&$("grave-yard").__sert(d),l=new Element("div"),l.update(t),$("modal-content").__sert(l),t.show&&t.show(),Element.show("modal")),ge("#modal-overlay").off("click"),a?ge("#modal-overlay").on("click",function(e){return en.hide(null,!1,!0),e.preventDefault(),e.stopPropagation()}):ge("#modal-overlay").on("click",function(e){return e.preventDefault(),e.stopPropagation()}),this.fix_position(),$("modal-overlay").show(),$("modal-behind").setStyle({width:s+20+"px",margin:"0 0 0 "+Math.floor(-s/2-10).toString()+"px"}),ge("#modal-behind").css("opacity",.2),$("modal-behind").show(),i?$("modal-content").select("#"+i.id).first().focus():yt.ie||(c=$("modal").down("input[type=submit]")||$("modal").down("input[type=button]"),c&&c.focus()),this.track_id||this.track_resizes(),e?(yt.isElm(e)?ge("#modal-title").html(e):ge("#modal-title").text(e),ge("#modal-title").show(),m=ge("#modal-title").text()):ge("#modal-title").hide(),Jt.register(!1,"modal"),this.keydownHandler=this.keydown.bind(this),document.observe("keydown",this.keydownHandler),$("modal-content").style.height="auto",X.getScope()!==this.KEY_SCOPE&&(this.vars._prev_scope=X.getScope()),X.setScope(this.KEY_SCOPE),this.prevent_hide_if_loading=_,ge("#modal").find("input").filter(":visible:first").focus(),this.in_viewport()&&(this.scroll_locked=!0,Ne.scroll_lock_document()),ge(document).trigger("modalOpened",[1]),!1},in_viewport:function(){var e,t,n,i,s;return e=ge("#modal"),t=e.height(),s=e.width(),n=Ne.viewport_dimensions(),i=Ne.viewport_offset(e),i.left>0&&i.top>0&&i.left+s<n.width&&i.top+t<n.height},fix_position:function(e){var t,n;return n=document.viewport.getScrollOffsets().top+this.vertical_offset,t=parseInt($("modal").getStyle("height"),10),t+this.vertical_offset<document.viewport.getHeight()?($("modal").setStyle({position:"fixed",top:this.vertical_offset+"px"}),$("modal-behind").setStyle({position:"fixed",height:t+20+"px",top:this.vertical_offset-10+"px"})):($("modal").setStyle({position:"absolute",top:n+"px"}),$("modal-behind").setStyle({position:"absolute",height:t+20+"px",top:n-10+"px"}))},keydown:function(e){var t,n,i,s;if(i=e.keyCode||e.which||e.charCode,(27===i||8===i&&!Ne.focus_in_input())&&(e.preventDefault(),this.hide(null,!1,!0)),9===i&&!Ne.focus_in_input()){for(n=$("modal").down("input[type=text], input[type=email]"),s=$("modal").down(".modal-tabs"),t=s;t&&t.next();)if(t=t.next(),t.visible()){n=t.down("input[type=text], input[type=email]");break}if(n)return e.preventDefault(),n.focus()}},shown:function(){return $("modal").visible()},hide:function(e,t,n){return e&&Event.stop(e),this.should_prevent_hide()?!1:(this.prevent_hide_if_loading=!1,this.onHide?void this.onHide(n):(this.onHide=null,Element.hide("modal-behind"),Element.hide("modal-overlay"),$("modal").removeClassName(this.vars.extra_class),t?$("modal").style.marginLeft="-10000000px":Element.hide("modal"),en._cleanup(),this.track_id&&(clearInterval(this.track_id),this.track_id=!1),document.stopObserving("keydown",this.keydownHandler),document.activeElement&&-1===[document,window,document.body].indexOf(document.activeElement)&&$(document.activeElement).blur(),X.setScope(this.vars._prev_scope)))},_cleanup:function(){return ge(document).trigger("modalClosed",[1]),this.scroll_locked?Ne.scroll_unlock_document():void 0},should_prevent_hide:function(){return this.prevent_hide_if_loading&&y.some(ge("#modal form"),function(e){return e.ajax_submitted})},track_resizes:function(){return this.track_id=setInterval(this.on_resize.bind(this),150)},on_resize:function(){var e;return e=$("modal").getHeight(),this.old_height!==e||$("modal-behind").getHeight()<e?(this.old_height=e,this.fix_position()):void 0},vars:{}};var tn;tn=tt.SickInput={init:function(){var e,t,n,i,s;for(i=$$(".sick-input"),s=[],t=0,n=i.length;n>t;t++)e=i[t],e.hasClassName("sickified")||s.push(this._create(e));return s},_create:function(e){var t,n,i;if(null!=e)return n=e.identify(),i=e.down("input")||e.down("textarea")||e.down("select"),i.observe("focus",function(){return e.addClassName("focused")}),i.observe("blur",function(){return e.removeClassName("focused")}),t=function(){return e.hasClassName("populated")&&""===i.getValue()?e.removeClassName("populated"):e.hasClassName("populated")||""===i.getValue()||e.addClassName("populated"),n in tn._handler_map?tn._handler_map[n]():void 0},Vt.show_errors(),t(),setInterval(t,100)},_handler_map:{},add_interval_handler:function(e,t){var n;return n=e.identify(),this._handler_map[n]=t},remove_interval_handler:function(e,t){var n;return n=e.identify(),this._handler_map[n]===t?delete this._handler_map[n]:void 0}};var nn;nn=tt.SuggestionInput={register:function(e){var t;return e=$(e),t=e.up("form"),nn.defaulted(e)||""===e.getValue()?e.setValue(e.title):e.addClassName("suggestion-input-unfaded"),e.observe("blur",this.blur.bind(this)),e.observe("focus",this.focus.bind(this)),e.observe("db:value_change",this.focus.bind(this)),t?(e.id||(e.id="r_elm_id_"+Math.random().toString()),t.observe("submit",nn.blank(e.id).bind(this))):void 0},register_all:function(){var e,t,n,i,s;for(i=$$(".suggestion-input"),s=[],e=0,n=i.length;n>e;e++)t=i[e],s.push(this.register(t));return s},blank:function(e){return function(t){return function(){var n;return(n=$(e))&&t.defaulted(n)?n.setValue(""):void 0}}(this)},defaulted:function(e){return e=$(e),e.getValue()===e.title},do_blank:function(e){return this.blank(e)()},clear:function(e){var t;return t={target:e},this.focus(t)},focus:function(e){var t;return(t=$(e.target))&&this.defaulted(t)?(t.addClassName("suggestion-input-unfaded"),t.setValue("")):void 0},blur_elm:function(e){return""===e.getValue()&&(e.removeClassName("suggestion-input-unfaded"),e.setValue(e.title)),e.blur()},blur:function(e){var t;return(t=$(e.target))?this.blur_elm(t):void 0},reset:function(e){var t;return(t=$(e))?(t.removeClassName("suggestion-input-unfaded"),t.setValue(t.title),t.defaulted=!0,t.blur()):void 0},setValue:function(e,t){var n;return(n=$(e))?(n.addClassName("suggestion-input-unfaded"),n.setValue(t),n.defaulted=!1):void 0}};var sn;sn=tt.TitleBubble=function(){var e,t,n,i,s,o,r;return r=0,e=0,o=function(e){return r=e},s=function(i){var s,o,a,_,l,u,c,d,h,m,p;return o=ge(i.currentTarget),p=o.attr("title"),(null!=p?p.length:void 0)&&(o.attr("data-title",p),o.removeAttr("title")),l=parseInt(o.data("title-delay")),_="title-bubble-"+e++,o.data("bubble-id",_),s=ge("<div/>",{id:_,class:"title_bubble_container"}),l||(s.css({opacity:0}),s.addClass("has-transition")),o.hasClass("white")&&s.addClass("white"),o.hasClass("black")&&s.addClass("black"),s.text(o.attr("data-title")),d=o.attr("data-title-html"),s.html(d),m="yes"!==o.attr("data-title-hide-tail"),m&&(a=ge("<div/>",{class:"tail"}),s.append(a)),ge(document.body).append(s),c=n(o[0],s[0]),u=t(c,s[0],o[0]),Ne.clone_position(s,o,{setWidth:!1,setHeight:!1,offsetTop:u.top-r,offsetLeft:u.left}),s.addClass("position-"+c),m&&Ne.clone_position(a,o,{setWidth:!1,setHeight:!1,setTop:!1,offsetLeft:u.left+u.tail_offset_left+ge(s).outerWidth()/2}),h=function(){var e;if(s.data("pending-delay")&&o.data("bubble-id")===_)return e=parseInt(o.data("title-fade-time"))||400,
s.fadeIn(e)},l?(s.hide(),s.data("pending-delay",!0),setTimeout(h,l)):s.css({opacity:""})},n=function(e,t){var n,i,s;if(e=$(e),s=e.getAttribute("data-title-position"),n=document.viewport.getDimensions(),i=e.viewportOffset(),"above"!==s&&"below"!==s&&"right"!==s&&"left"!==s&&(s="above"),"left"===s){if(i.left<t.width)return"right"}else if("right"===s){if(n.width-(i.left+e.getWidth())<t.width)return"left"}else if("below"===s){if(n.height-(i.top+e.getHeight())<t.height)return"above"}else if("above"===s&&i.top<t.height)return"below";return s},t=function(e,t,n){var i,s,o,r,a,_,l,u,c,d;return t=$(t),n=$(n),o=document.viewport.getDimensions(),i=t.getDimensions(),r=n.viewportOffset(),s=6,a=0,_=0,c=0,d=0,"below"!==e&&"above"!==e||(_="below"===e?n.getHeight()+s:-1*i.height-s,l=n.getWidth()/2-i.width/2,r.left+l+i.width>o.width?(a=o.width-r.left-i.width,c=l-a-5):(a=l,c=-5)),"left"!==e&&"right"!==e||(a="right"===e?n.getWidth()+s:-1*i.width-s,u=n.getHeight()/2-i.height/2,r.top+u+i.height>o.height?(_=o.height-r.top-i.height,d=u-_-5):(_=u,d=-5)),{left:a,top:_,tail_offset_left:c,tail_offset_top:d}},i=function(e){var t,n,i;return n=ge(null!=e?e.currentTarget:void 0),t=ge("#"+n.data("bubble-id")),t.data("pending-delay")?(t.removeData("pending-delay"),i=parseInt(n.data("title-fade-time"))||400,t.fadeOut(i,function(){return t.remove()})):t.remove()},{init:function(){return ge(document).on("mouseenter",".title_bubble",s),ge(document).on("mouseleave",".title_bubble",i).on("mouseup",".title_bubble",i),ge(document).on("mouseenter",".title_bubble_sticky",s),ge(document).on("mouseleave",".title_bubble_sticky",i)},set_vertical_space:o,hide_all:function(){return ge(".title_bubble_container").remove()}}}();var on;on=INLINE_JS.Tooltip=tt.Tooltip={attach:function(e,t,n,i){var s,o;return null==i&&(i={}),e=$(e),n=n?$(n):null,s=Xt.make(t,e.tail_position,i.tail_position,i.width,i),s.setStyle({display:"none",position:"absolute"}),$("floaters").__sert(s),e.match("#modal-content *")||e.match(".db-modal-content *")?s.style.zIndex="13001":s.style.zIndex="","right"===e.tail_position&&(o=yt.ie?32:12,s.style.marginLeft=-(s.getWidth()+e.getWidth()+o)+"px"),e.tooltip=s,e.out_target=!!n,e.observe("mouseout",this.mouseout("target",e)),e.observe("mouseover",this.mouseover("target",e)),e.out_trigger=!n,n&&(n.observe("mouseout",this.mouseout("trigger",e)),n.observe("mouseover",this.mouseover("trigger",e))),e.out_tooltip=!0,s.observe("mouseout",this.mouseout("tooltip",e)),s.observe("mouseover",this.mouseover("tooltip",e))},update:function(e,t){return e.tooltip?$(e.tooltip).update(t):void 0},mouseover:function(e,t){return function(){return t["out_"+e]=!1}},mouseout:function(e,t){return function(){return t["out_"+e]=!0,on.hide_if_out.defer(t)}},show_by:function(e){var t,n;return t=ge(e.tooltip),e=ge(e),t.show(),n=Math.floor(t[0].offsetHeight/2),Ne.clone_position(t,e,{setWidth:!1,setHeight:!1,offsetTop:Math.floor(e[0].offsetHeight/2)-n,offsetLeft:e[0].offsetWidth+1})},hide_if_out:function(e){var t;if(e.out_target&&e.out_trigger&&e.out_tooltip)return t=$(e.tooltip),t.hide()},show:function(e,t,n,i,s){return null==i&&(i="left"),e=$(e),e.tail_position||(e.tail_position=i),n=n?$(n):null,e.tooltip||this.attach(e,t,n,s),this.show_by(e)}};var rn;rn=INLINE_JS.TreeView=tt.TreeView={tv:{},loaded:!1,user:null,role_icon:"",set_params:function(e){return this.ajax_params=e},init:function(e,t,n){var i;return null==n&&(n="treeview"),this.tv[n]={},i=this.tv[n],i.autohide=null===t?!0:t,i.handler=e,i.viewdiv=$(n),i.hidefunc=this.hide.bindAsEventListener(this),this.ajax_params={},document.observe(Wn.ADD,function(e){return function(t){return e.schedule_reset()}}(this)),document.observe(Wn.REMOVE,function(e){return function(t){return e.schedule_reset()}}(this)),document.observe(Wn.MOVE,function(e){return function(t){return e.schedule_reset()}}(this))},schedule_reset:function(){return this.loaded=!1},reset:function(e){var t,n,i,s,o,r,a;return t={url:"/ajax_subtreeview",data:ge.extend({},this.ajax_params),success:function(t){return function(n){var i,s;i=[];for(s in t.tv)t.tv.hasOwnProperty(s)?(t.tv[s].viewdiv.down(".treeview-folders").update(n),e&&e.onSuccess?i.push(e.onSuccess(n)):i.push(void 0)):i.push(void 0);return i}}(this)},(null!=e?e.user:void 0)?(e.user.id!==(null!=(n=this.user)?n.id:void 0)&&(o=ge("<p />",{id:"treeview-loading"}),r=ge("<img />",{src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"}),o.append(r),a=" "+mt("Loading your folders"),o.append(a),ge("#dest-treeview .treeview-folders").html(o),this.user=e.user),t.subject_user=e.user,s=Z.get_role_title(e.user),i=Z.get_viewer().is_paired?e.user.is_team?"s_briefcase":"s_house":"dropbox",s||(s=mt("Dropbox")),ge("#first-treeview-link span").text(s),ie.replace(ge("#root-img")[0],"web",this.role_icon,i),this.role_icon=i):ge("#first-treeview-link span").text(mt("Dropbox")),E.SilentBackgroundRequest(t)},toggle:function(e,t){var n;return Event.stop(e),n=this.tv[t||"treeview"],n.shown?(n.shown=!1,this.hide(e,t)):(n.shown=!0,this.show(e.target,t)),!1},hide:function(e,t){var n;return n=this.tv[t||"treeview"],e&&$(e.target).descendantOf(n.viewdiv)?void 0:(n.viewdiv.hide(),Event.stopObserving(window,"click",n.hidefunc),n.shown=!1)},show:function(e,t){var n,i;return i=this.tv[t||"treeview"],e=$(e),e.blur(),n=e.cumulativeOffset(),i.viewdiv.setStyle({top:n.top+e.getHeight()+"px",left:n.left-4+"px"}),i.viewdiv.show(),Event.observe(window,"click",i.hidefunc)},toggleNode:function(e){var t;return e=$(e),t=e.down("img"),t.className.match("bullet_plus")?ie.replace(t,"web","bullet_plus","bullet_minus"):ie.replace(t,"web","bullet_minus","bullet_plus"),e.up().next("div").toggle(),e.blur(),!1},toggleNodeAjax:function(e,t,n){var i,s;return e.fetched_children?this.toggleNode(e):(e=$(e),i=e.down("img"),s=ie._get(i),i.src="/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",E.SilentBackgroundRequest({url:"/ajax_subtreeview"+t,data:ge.extend({},this.ajax_params),subject_user:n,success:function(t){return function(n){var o;return o=new Element("div",{style:"display: none;"}).update(n),e.up().__sert({after:o}),e.fetched_children=!0,ie._set(i,s),t.toggleNode(e)}}(this),complete:function(){return/loading/.match(i.src)?ie._set(i,s):void 0}}),!1)},handle:function(e,t){var n,i;return n=$H(this.tv).keys(),(i=$(t).ancestors().find(function(e){return n.include(e.id)}))?(i=this.tv[i.id],ge(document).trigger("db:treeview_selected",[e]),i.handler&&i.handler(e,t),i.autohide&&this.hide(i.id),!1):void 0},move:function(e,t,n){var i;return i=$(e),this.loaded?n&&n.onSuccess&&n.onSuccess():this.reset({onSuccess:function(i){return function(){return i.loaded=1,i.move(e,t,n)}}(this),user:null!=n?n.user:void 0}),assert(i,"Couldn't find tree_id"),assert($(t),"Couldn't find location_id"),$(t).appendChild(i),i.show()}};var an;an=tt.ULSelectMenu=function(){var e,t,n,i,s,o,r,a,_,l,u;return e=function(e){return e.removeClassName("shown")},u=function(e){return e.toggleClassName("shown")},r=function(){return this.removeClassName("hover")},o=function(){return this.addClassName("hover")},a=function(e,t){var n,i,s,o;for(s=[],n=0,i=t.length;i>n;n++)o=t[n],s.push(e.insert(o));return s},i=function(e,t,n){return a(e,n),e.firstChild!==t?e.__sert({top:t}):void 0},_=function(e,t){var n;return n="selected",ge(e).find("."+n).removeClass(n),ge(t).addClass(n)},l=function(e,t){var n,i,s,o,r;for(o=e.select("li"),r=[],i=0,s=o.length;s>i;i++)n=o[i],n.getAttribute("data-value")===t?r.push(_(e,n)):r.push(void 0);return r},s=function(t,n,s){return function(o){return t.hasClassName("selected")?(i(n,t,s),u(n)):(_(n,t),n.fire("db:change",t.getAttribute("data-value")),e(n))}},t=function(t){var n,i,a,_,l,u,c,d;if(_=t.select("li"),assert(_.length,"Empty list of options "+t.identify()),l=void 0,1===_.length)t.addClassName("one");else{for(i=0,a=_.length;a>i;i++)n=_[i],c=n.getAttribute("data-value"),assert(c,n.identify()+" missing data value"),n.observe("click",s(n,t,_)),n.observe("mouseenter",o),n.observe("mouseleave",r),n.hasClassName("selected")&&(l=n);$(document.body).observe("click",function(n){return $(n.target).up(".ul_select_menu")!==t?e(t):void 0})}return l||(l=_[0]),l.addClassName("selected"),d=new Element("span"),u=l.getDimensions(),d.setStyle({width:u.width+"px",height:u.height+"px",position:"relative",display:"inline-block"}),t.wrap(d)},n=function(){var e,n,i,s,o;for(s=$$(".ul_select_menu"),o=[],n=0,i=s.length;i>n;n++)e=s[n],o.push(t(e));return o},ge(n),{init:function(e){return t(e)},set_selected_by_value:l}}();var _n;_n=tt.DBCalendar=Class.create({initialize:function(e,t){return this.options=t||{},this.container=$(e),assert(this.container,"Couldn't find the element"),this.today=new Date,this.options.disable_future&&(this.options.last_day=yt.start_of_day(this.options.last_day||this.today)),this.options.disable_past&&(this.options.first_day=yt.start_of_day(this.options.first_day||this.today)),this.view_date=yt.start_of_day(this.options.selected_date||this.today),this.selected_date=yt.start_of_day(this.options.selected_date||this.today),this.render()},_change_month:function(e,t){return Event.stop(e),this.view_date.setMonth(t),this.render()},is_valid_date:function(e,t,n,i,s){var o;return e=parseInt(e,10),t=parseInt(t,10),n=parseInt(n,10),i=parseInt(i,10),s=parseInt(s,10),i=i||1970,s=s||(new Date).getFullYear()+1,t+=1,i>n?!1:n>s?!1:1>t||t>12?!1:0>=e?!1:2===t?(o=n%4===0&&(n%100!==0||n%400===0),o?29>=e:28>=e):4===t||6===t||9===t||11===t?30>=e:31>=e},change_date:function(e,t,n){var i;if(this.is_valid_date(e,t,n))return i=n!==this.view_date.getFullYear()||t!==this.view_date.getMonth(),this.selected_date=new Date(n,t,e),i?(this.view_date.setMonth(t),this.view_date.setFullYear(n),this.render()):(ge(this.container).find(".selected").removeClass("selected"),ge(this.container).find("a#day"+e+"-"+t).addClass("selected")),this.options.onDateChange?this.options.onDateChange(this.selected_date):void 0},render:function(){var e,t,n,i,s,o,r,a,_,l;return t=this.render_days(),i=ge(".current-month",t),r=i.first().data("date"),o=i.last().data("date"),l=r<=this.options.first_day,_=o>=this.options.last_day,e=new Element("div"),e.addClassName("calendar clearfix"),_||(this._next_month=function(e){return this._change_month(e,this.view_date.getMonth()+1)}.bind(this),s=new Element("a"),s.addClassName("changemonth next"),s.update(ie.make("web","arrowright",{})),Event.observe(s,"click",this._next_month),e.__sert(s)),l||(this._prev_month=function(e){return this._change_month(e,this.view_date.getMonth()-1)}.bind(this),a=new Element("a"),a.addClassName("changemonth prev"),a.update(ie.make("web","arrowleft",{})),Event.observe(a,"click",this._prev_month),e.__sert(a)),n=new Element("h5"),n.update(mt("%(month)s %(year)s",{comment:"For example 'January 2010'. This is used as part of a calendar."}).format({month:le.month_name(this.view_date.getMonth()),year:this.view_date.getFullYear()})),e.__sert(n),e.__sert(t),this.container.__date(e)},render_days:function(){var e,t,n,i,s,o,r,a,_;for(t=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1),a=t.getDay(),e=new Element("div"),e.addClassName("days"),n=s=_=a;0>=_?0>s:s>0;n=0>=_?++s:--s)r=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r.setDate(r.getDate()-n),e.__sert(this.render_day(r,!0));for(i=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1);i.getMonth()===this.view_date.getMonth();)e.__sert(this.render_day(i)),i=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),i.getDate()+1);for(o=new Date(this.view_date.getFullYear(),this.view_date.getMonth()+1,0);6!==o.getDay();)o=new Date(o.getFullYear(),o.getMonth(),o.getDate()+1),e.__sert(this.render_day(o,!0));return e},render_day:function(e,t){var n,i;return i=!t,this.options.last_day&&(t=t||e>this.options.last_day),this.options.first_day&&(t=t||e<this.options.first_day),n=new Element(t?"span":"a"),ge(n).data("date",e),i&&n.addClassName("current-month"),n.update(e.getDate()),n.addClassName("date"),n.writeAttribute("id","day"+e.getDate()+"-"+e.getMonth()),this.selected_date.getDate()===e.getDate()&&this.selected_date.getMonth()===e.getMonth()&&this.selected_date.getFullYear()===e.getFullYear()&&n.addClassName("selected"),t?n.addClassName("inactive"):(this._handler=function(e){var t;return t=e.target.identify().substr(3).split("-"),this.change_date(t[0],this.view_date.getMonth(),this.view_date.getFullYear())}.bind(this),Event.observe(n,"click",this._handler)),n}});var ln;ln=tt.DatePickerInput=Class.create({initialize:function(e,t){var n,i,s,o;return this.container=e,this.options={},Object.extend(this.options,t||{}),this.input=this.container.down(".input-date"),this.display=this.container.down(".visible-date"),o=this.input.value?yt.from_mysql_date(this.input.value):new Date,this.container.hasAttribute("data-first")&&(s=yt.from_mysql_date(this.container.getAttribute("data-first"))),n=null!=this.options.disable_future?this.options.disable_future:!0,i=null!=this.options.disable_past?this.options.disable_past:!0,this.cal_container=this.container.down(".cal-container"),this.calendar=new _n(this.cal_container,{onDateChange:this.onDateChange.bind(this),first_day:s,disable_future:n,disable_past:i,selected_date:o}),this.container.observe("click",this.show_cal.bindAsEventListener(this)),$(document.body).observe("click",this.hide_cal.bind(this)),this.onDateChange(o)},show_cal:function(e){var t;return e&&Event.stop(e),t=$(e.target),t.match(".cal-container")||t.up(".cal-container")?void 0:(ge(".cal-container").hide(),this.cal_container.show())},hide_cal:function(){return this.cal_container.hide()},onDateChange:function(e){return this.input.value=yt.to_mysql_date(e,!1),this.display.update(ni.localize(e)),this.hide_cal()}});var un;un=tt.TextInputDatePicker=Class.create({initialize:function(e,t){var n,i,s,o;return this.options={include_seconds:!0,include_microseconds:!0,choose_eod:!1},Object.extend(this.options,t||{}),this.input=$(e),assert(this.input,"Couldn't find the element "+e.toString()),s=new Date,o=this.input.value?yt.from_mysql_date(this.input.value):!1,i=new Date(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),this.cal_icon=ie.make("web","calendar_view_month",{align:"absmiddle"}),this.cal_container=new Element("div",{id:"cal_container_"+e,style:"display: none; position: absolute; z-index: 1"}),this.calendar=new _n(this.cal_container,{onDateChange:this.onDateChange.bind(this),last_day:i,selected_date:o}),this.input.__sert({after:this.cal_icon}),this.cal_icon.observe("click",this.toggle_cal.bindAsEventListener(this)),n=ge(this.input),Ne.clone_position(ge(this.cal_container),n,{setWidth:!1,setHeight:!1,offsetTop:n[0].offsetHeight}),this.cal_icon.__sert({after:this.cal_container})},toggle_cal:function(e){return e&&Event.stop(e),this.cal_container.toggle()},hide_cal:function(e){return e&&Event.stop(e),this.cal_container.hide()},onDateChange:function(e){return this.options.choose_eod&&e.setTime(yt.start_of_day(e).getTime()+86399999),this.input.value=yt.to_mysql_date(e,this.options.include_seconds,this.options.include_microseconds),this.hide_cal()}}),H.window_load(Jt.register.bind(Jt)),ge(tn.init.bind(tn)),ge(nn.register_all.bind(nn)),Event.observe(window,"scroll",function(){return sn.hide_all()}),ge(function(){return Zt.interval=setInterval(Zt.check.bind(Zt),500),sn.init()});var cn,Nt=function(e,t){function n(){this.constructor=e}for(var i in t)It.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},It={}.hasOwnProperty;cn=INLINE_JS.ChangeNameModal=tt.ChangeNameModal=function(e){function t(){t.__super__.constructor.call(this,{element_id:"change-name-modal"}),this.on_confirm_button_click=function(e){return function(t){var n,i,s;return t.preventDefault(),n=ge(t.target),i=n.closest("form"),s=function(){return e.hide(),location.reload()},Vt.ajax_submit(i[0],!1,s,null,n[0])}}(this)}return Nt(t,e),t}(_t);var dn;dn=INLINE_JS.BonusTable=tt.BonusTable={_tmpl:null,_inited:null,_next_page:0,_fetching_page:!1,init:function(e){return this.user_id=e,!dn._inited&&$("bonus-loading")?(dn._inited=!0,$("bonus-loading").show(),dn._tmpl=Qe.tmpl("bonus_row_tmpl"),dn.listen(),dn.get_next_page()):void 0},_render:function(e){var t,n,i,s;for(t=[],n=0,i=e.length;i>n;n++)s=e[n],t.push(dn._tmpl({row:s,Sprite:ie}));return $("bonus-table").__sert(t)},get_next_page:function(){return dn._fetching_page?void 0:(dn._fetching_page=!0,new Ajax.DBRequest("/account/bonus_page/"+dn._next_page,{onSuccess:function(e){var t,n,i;return t=e.responseText.evalJSON(),i=t.rows,n=t.has_more,dn._render(i),$("bonus-loading").hide(),n?(dn._next_page+=1,$("load-more-bonus").show()):$("load-more-bonus").hide(),dn._fetching_page=!1},subject_user:this.user_id}))},_max_referral_over:function(e){var t,n,i;return n=ge(e.currentTarget),i=mt("You've earned the maximum amount of referral space. Thanks for inviting people to Dropbox!"),t=ge(Xt.make(i,"right","middle")),Element.absolutize(t[0]),n.append(t),Ne.clone_position(t,n,{setWidth:!1,setHeight:!1}),t.css({width:"200px",left:parseInt(t.css("left"),10)-210+"px",top:parseInt(t.css("top"),10)-55+"px"})},_max_referral_out:function(e){var t,n,i,s,o;for(s=ge(".reached-max-referral-bonus .bubble"),o=[],n=0,i=s.length;i>n;n++)t=s[n],o.push(t.remove());return o},listen:function(){return ge("#load-more-bonus").on("click",dn.get_next_page.bind(dn)),ge(document).on("mouseenter",".reached-max-referral-bonus",dn._max_referral_over),ge(document).on("mouseleave",".reached-max-referral-bonus",dn._max_referral_out)},toggle:function(){return ge("#bonus-list").is(":visible")?(this.hide(),ge("#space-earned-link").text(mt("View all space earned"))):(this.show(),ge("#space-earned-link").text(mt("Hide space earned")))},show:function(){return ge("#bonus-list").slideDown(150)},hide:function(){return ge("#bonus-list").slideUp(150)}};var hn,mn,pn,fn;hn=INLINE_JS.DowngradeReasons=tt.DowngradeReasons={reasons:{},addReason:function(e){return this.reasons[e]=!0},addReasons:function(e){var t,n,i,s;for(s=[],t=0,i=e.length;i>t;t++)n=e[t],s.push(this.addReason(n));return s},change:function(e,t,n){var i,s,o,r,a,_;e=parseInt(e,10),s=$(t),assert(s,"Couldn't find container for DowngradeReason"),i=!1,a=this.reasons;for(r in a)o=a[r],_=$(n+r),assert(_,"Couldn't find container for "+(n+r)),o&&parseInt(r,10)===e?(_.show(),i=!0):_.hide();return i?s.show():s.hide()}},mn=tt.DowngradeReasons2={init:function(){var e,t,n,i;for(i=["input[name=downgrade_reason_id]","input[name=other_reason_id]"],e=0,t=i.length;t>e;e++)n=i[e],ge(n).change(function(e){var t;return t=e.target.id.indexOf("other")>=0,mn.change(t,e.target.getValue())});return ge(".shared-additional-info").attr("name","shared_additional_info")},change:function(e,t){var n;return ge(".downgrade-other-reason .error-message").hide(),e?void 0:(n="#downgrade-info-"+t,ge(".downgrade-info").hide(),ge(n).show(),ge(".downgrade-info textarea").removeAttr("name"),ge(n+" textarea").attr("name","additional_info"),ge("input[name=other_reason_id]").removeAttr("checked"))}},pn=tt.DowngradeSurvey={init:function(){var e;return e="#downgrade-survey-form",ge(""+e).on("submit",function(t){return function(t){var n,i;return i=ge(e+" input[name=other_reason_id]:checked").length,n=ge(e+" input[id=downgrade-radio-8]"),n.is(":checked")&&0===i?(ge(".downgrade-other-reason .error-message").show(),t.preventDefault()):void 0}}(this))}},fn=tt.TrialDowngradeReasons={init:function(){return ge(document).on("click",".reasons-option",function(e){var t,n,i,s;return i=e.target.getValue(),s=e.target.name,"other_reason_id"===s&&(n="#other-info-"+i,ge(".other-info").hide(),ge(n).show()),"downgrade_reason_id"===s?(t="#downgrade-info-"+i,ge(".downgrade-info").hide(),ge(t).show()):void 0}),ge("#downgrade-survey-form").on("submit",function(e){var t,n;return n=ge("#downgrade-survey-form input[id=downgrade-radio-207]"),n.is(":checked")&&0===ge(".q1-other-reason.textinput").val().length?(ge(".trial-downgrade--error-message").show(),void e.preventDefault()):(t="",ge(".reasons-option:checked").each(function(e,n){var i,s,o;return i=n.getValue(),s=ge("#downgrade-info-"+i+" textarea").val(),o=ge("#other-info-"+i+" textarea").val(),(null!=s?s.length:void 0)>0&&(t=i+":"+s),(null!=o?o.length:void 0)>0?t+=" "+i+":"+o:void 0}),ge(".downgrade-info textarea").removeAttr("name"),ge(".other-info textarea").removeAttr("name"),ge('#downgrade-survey-form input:hidden[name="additional_info"]').val(t))})}};var vn;vn=INLINE_JS.GetSpace=tt.GetSpace={_current_space:null,_why_msg:null,_twitter_url:null,offer_highlight_color:"#ffa",init:function(e,t,n){var i;return vn._current_space=e,vn._why_msg=t,vn._twitter_url=n,$("space-actions").on("click",".space-action",vn.perform_action),i=u.parse(window.location.href).fragment,i?vn.highlight_offer(i):void 0},highlight_offer:function(e){var t,n;return t=ge("#"+e),n=t.css("background-color"),t.css("background-color",vn.offer_highlight_color).delay(2e3).animate({"background-color":n}).queue(function(){return t.css("background-color","")})},perform_action:function(e){var t,n;return e.preventDefault(),n={contact_sales:vn._contact_sales,contact_support:vn._contact_support,teams:vn._teams,upgrade:vn._upgrade,plans:vn._plans,refer:vn._refer,get_started:vn._get_started,fb_link:vn._fb_link,twitter_link:vn._twitter_link,twitter_follow:vn._twitter_follow,why_like:vn._why_like,mailbox_link:vn._mailbox_link},t=$(e.target),t.hasClassName("space-action")||(t=t.up(".space-action")),n[t.id]()},_teams:function(){return window.location.href="/business?tk=dropbox&ag=getspace&ad=v1"},_contact_sales:function(){return window.location.href="mailto:sales@dropbox.com"},_contact_support:function(){return window.location.href="/support"},_plans:function(){return window.location.href="/plans"},_upgrade:function(){return window.location.href="/upgrade"},_refer:function(){return window.location.href="/referrals"},_get_started:function(){return window.location.href="/gs"},_fb_link:function(){return V.do_auth(function(){return vn._refresh_link_bonuses(),vn._completed($("fb_link"))},Z.get_viewer().personal_user.id)},_twitter_link:function(){return ri.do_auth(function(){return vn._refresh_link_bonuses(),ri.set_is_authed(Z.get_viewer().personal_user.id,!0),vn._completed($("twitter_link"))},Z.get_viewer().personal_user.id)},_twitter_follow:function(){return ri.is_authed(Z.get_viewer().personal_user.id)?vn.follow_dropbox():ri.do_auth(vn.follow_dropbox,Z.get_viewer().personal_user.id)},_why_like:function(){return en.show(mt("Tell us why you love Dropbox"),$("why-i-like-modal")),$("why-i-like-input").focus(),yt._track_twitter_chars_left("why-i-like-input",90)},_mailbox_link:function(){return window.location.href="http://www.mailboxapp.com/"},follow_dropbox:function(){return ri.is_authed(Z.get_viewer().personal_user.id)||(vn._refresh_link_bonuses(),ri.set_is_authed(Z.get_viewer().personal_user.id,!0)),ri.follow_dropbox({showWorking:function(){return $("twitter_follow").down(".title").__date(mt("Following Dropbox on Twitter..."))},onFailure:function(){return $("twitter_follow").down(".title").__date(mt("Follow Dropbox on Twitter"))},onSuccess:function(){return $("twitter_link")&&$("twitter_link").visible()&&vn._completed($("twitter_link")),vn._completed($("twitter_follow"))}},Z.get_viewer().personal_user.id)},submit_why:function(){return vn._why_msg=$F("why-i-like-input"),Vt.ajax_submit($("why-i-like-form"),!1,function(){return en.hide(),vn._completed($("why_like"))},!1,$("why-i-like-submit"))},_completed:function(e){var t,n;return e.addClassName("completed"),null!=(n=e.down(".icon-col"))&&n.__date(Element("img",{src:"/static/images/check_36-vflimxFPn.png"})),ge(e).css("opacity",.5).fadeTo(500,1),setTimeout(function(){return ge(e).css("opacity",1).slideUp().animate({opacity:0},{queue:!1,duration:"normal"})},1500),t=parseInt(e.down(".space").readAttribute("data-space"),10),vn._current_space+=t,$("current-space").__date(z.format_bytes(vn._current_space)),$("current-space").addClassName("updated"),setTimeout(function(){return $("current-space").removeClassName("updated")},5e3)},_refresh_link_bonuses:function(){return new Ajax.DBRequest("/social_recheck")}};var gn;gn=tt.Help={toggle_more_help:!1,show_os:function(e,t,n){return t=$(t),$$(".os-filter").invoke("removeClassName","selected"),t.addClassName("selected"),$$(".help-os-section").invoke("hide"),$$(".help-os-"+n).invoke("show"),Event.stop(e)},vote:function(e,t){return new Ajax.DBRequest("/help/"+e+"/vote/"+t),ge("#help-vote-cont").fadeOut(),D.success(mt("Thanks for your feedback!"))}};var wn,bn,yn,kn,Lt=function(e,t){return function(){return e.apply(t,arguments)}},Nt=function(e,t){function n(){this.constructor=e}for(var i in t)It.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},It={}.hasOwnProperty;bn=INLINE_JS.Hosts=tt.Hosts={attach_host_listener:function(e,t){var n,i,s,o;return n=ge("#"+e),s=n.data("host-ids"),i=n.data("display-name"),o=function(){return new yn(s,i,t,null,null).show()},ge(".unlink-host-link",n).on("click",o),n.on("dblclick",function(){return bn.edit(s,e)})},edit:function(e,t){var n,i,s,o,r,a;return s=ge("#"+t+" .host-item .sprite-text"),"true"===s.data("editing")?!1:(s.data("editing","true"),i=s.text(),s.data("previous",i),e=y.values(e),o=ge('<input type="text" class="name-input skinny-input" size="20" maxlength="256" style="word-wrap: break-word;" />').val(i),a=ge('<input type="button" class="button">').val(mt("Save")),a.on("click",function(){return bn.doneEditing(e,t)}),n=ge('<input type="button" class="button grayed">').val(mt("Cancel")),n.on("click",function(){return bn.cancelEditing(t)}),s.empty(),s.append(o,"&nbsp;",a,"&nbsp;",n),r=ge("input",s),r.on("keydown",function(){return bn.checkKey(e,t)}),r.focus(),!1)},doneEditing:function(e,t){var n,i;return n=ge("#"+t+" .host-item .sprite-text"),i=ge("input",n).val(),E.SilentBackgroundRequest({url:"/account/change_host_name",data:{host_ids:JSON.stringify(e),name:i},dataType:"json",success:function(e){return bn.unedit(n,e.display_name)}})},cancelEditing:function(e){var t;return t=ge("#"+e+" .host-item .sprite-text"),bn.unedit(t,t.data("previous"))},unedit:function(e,t){return e.data("editing","false"),e.text(t)},dismiss:function(e,t,n,i,s){return E.SilentBackgroundRequest({url:"/account/dismiss_unlink",data:{host_id:e,user_id:t,team_id:n},subject_user:s,success:function(e){return i.remove()}}),!1},checkKey:function(e,t){return function(n){return n=n||window.event,n.keyCode===Event.KEY_RETURN&&bn.doneEditing(e,t),n.keyCode===Event.KEY_ESC?bn.cancelEditing(t):void 0}},show_device_unlink_modal:function(e,t,n,i,s,o){var r,a;return r=ge("#unlink-device-modal-"+s),a={both:y.values(i),personal:[i[M.ROLE_PERSONAL]],work:[i[M.ROLE_WORK]]},en.show(n,r[0]),y.values(i).length>1&&r.addClass("show-selector"),ge("form input[type=submit]",r).on("click",function(n){return n.preventDefault(),i=a[ge(".unlink-select select",r).val()],Vt.add_vars(ge("form",r)[0],{user_ids:JSON.stringify(i),app_id:t,device_id:JSON.stringify(e),device_name:o}),ge("form",r).submit()})}},wn=tt.DeleteFailuresModal=function(e){function t(){return this.on_show=Lt(this.on_show,this),this.on_confirm_button_click=Lt(this.on_confirm_button_click,this),t.__super__.constructor.apply(this,arguments)}return Nt(t,e),t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),window.location.href="/delete_failures?host_id="+this.host_id,this.hide()},t.prototype.on_show=function(e){var t;return t=ht("Dropbox couldn't delete %(num_failures)d file from the computer <strong>%(host_name)s</strong>. You can download the name of this file and the reason why it couldn't be deleted.","Dropbox couldn't delete %(num_failures)d files from the computer <strong>%(host_name)s</strong>. You can download the names of these files and the reasons why they couldn't be deleted.",this.num_failures).format({host_name:this.name.escapeHTML(),num_failures:this.num_failures}),this.$modal_window.find(".failures_message").html(t)},t}(_t),kn=INLINE_JS.show_delete_failures_modal=tt.show_delete_failures_modal=function(e,t,n){var i;return i=new wn({element_id:"delete-failures-modal"}),i.host_id=e,i.name=t,i.num_failures=n,i.show(),!1},yn=INLINE_JS.UnlinkHostModal=tt.UnlinkHostModal=function(e){function t(e,n,i,s,o){this.host_ids=e,this.name=n,this.delete_support_type=i,this.owner_id=s,this.team_id=o,this.on_show=Lt(this.on_show,this),this._set_delete_text=Lt(this._set_delete_text,this),this.fail_callback=Lt(this.fail_callback,this),this.success_callback=Lt(this.success_callback,this),this.on_confirm_button_click=Lt(this.on_confirm_button_click,this),t.__super__.constructor.call(this,{element_id:"unlink-host-modal"}),this.show_host_selector=y(this.host_ids).values().length>1}return Nt(t,e),t.prototype.on_confirm_button_click=function(e){var t,n,i;return e.preventDefault(),n=this.$modal_window.find(".unlink_host_form")[0],t=$(this.$modal_window.find(".confirm-button")[0]),this.$modal_window.find("[type=button]").attr("disabled",""),i={host_ids:JSON.stringify(this.get_selected_hosts())},Vt.ajax_submit(n,!1,this.success_callback,this.fail_callback,t,i)},t.prototype.success_callback=function(){return window.location.reload()},t.prototype.fail_callback=function(){return this.$modal_window.find("[type=button]").removeAttr("disabled")},t.prototype._set_delete_text=function(e){return this.$modal_window.find(".delete_data_label").text(e)},t.prototype._get_unlink_select=function(){return this.$modal_window.find(".unlink-select select").val()},t.prototype._clear_delete_checkbox=function(){return this.$modal_window.find(".delete_data").prop("checked",!1)},t.prototype.on_show=function(e){var t;return this._clear_delete_checkbox(),this.delete_support_type===v.DELETE_ON_UNLINK_OLD_CLIENT?this.$modal_window.find(".unlink_host_modal_content").addClass("show_old_client_modal"):this.delete_support_type===v.DELETE_ON_UNLINK_UNSUPPORTED?this.$modal_window.find(".unlink_host_modal_content .unlink_host_form").addClass("hidden"):this.delete_support_type===v.DELETE_ON_UNLINK_SUPPORTED_TEAM_ONLY?(this.$modal_window.find(".unlink-choice").change(function(e){return function(t){return e._get_unlink_select()===M.ROLE_PERSONAL?e.$modal_window.find(".new_client").hide():e.$modal_window.find(".new_client").show()}}(this)),this._set_delete_text(mt("Delete files from %(team_name)s Dropbox the next time this computer comes online.").format({team_name:Z.get_viewer().team_name}))):this.delete_support_type===v.DELETE_ON_UNLINK_SUPPORTED_PERSONAL_ONLY?(this.$modal_window.find(".unlink-choice").change(function(e){return function(t){return e._get_unlink_select()===M.ROLE_WORK?e.$modal_window.find(".new_client").hide():e.$modal_window.find(".new_client").show()}}(this)),this._set_delete_text(mt("Delete files from my personal Dropbox the next time this computer comes online."))):this.delete_support_type===v.DELETE_ON_UNLINK_SUPPORTED&&(this._set_delete_text(mt("Delete files from these Dropboxes the next time this computer comes online.")),this.$modal_window.find(".unlink-choice").change(function(e){return function(t){return e._get_unlink_select()===M.ROLE_PERSONAL?e._set_delete_text(mt("Delete files from my personal Dropbox the next time this computer comes online.")):e._get_unlink_select()===M.ROLE_WORK?e._set_delete_text(mt("Delete files from %(team_name)s Dropbox the next time this computer comes online.").format({team_name:Z.get_viewer().team_name})):e._set_delete_text(mt("Delete files from these Dropboxes the next time this computer comes online."))}}(this))),this.show_host_selector&&(t="<span class='host_name'></span>",this.$modal_window.find(".unlink-select").removeClass("hidden"),this.$modal_window.find(".unlink-modal-text").html(mt("Which Dropboxes do you want to unlink from %(host_name)s? Any Dropbox you unlink will immediately stop syncing.").format({host_name:t}))),this.$modal_window.find("[name=host_id]").attr("value",this.host_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.$modal_window.find("[name=user_id]").attr("value",this.owner_id),this.$modal_window.find(".host_name").text(this.name);
},t.prototype.get_selected_hosts=function(){var e;return 1===y.values(this.host_ids).length?y.values(this.host_ids):(e=ge(".unlink-choice").val(),"both"===e?y.values(this.host_ids):[this.host_ids[e]])},t}(_t);var xn;xn=tt.News={DEFAULT_TAB:"recent-news",init:function(){return $("news-home").on("click","#nav a",function(e,t){var n;return t.hasAttribute("data-div")?(e.preventDefault(),n=t.readAttribute("data-div"),b.push_state("/news/"+n)):void 0}),b.add_callback("/news",xn.history_change)},change_tab:function(e){var t;return t=$$("#nav a[data-div="+e+"]").first(),$(t)?($$(".section").invoke("removeClassName","selected"),$$("#nav a").invoke("removeClassName","selected"),$(t).addClassName("selected"),$(e).addClassName("selected")):void 0},history_change:function(e){return e=e||xn.DEFAULT_TAB,xn.change_tab(e)}};var En;En=tt.Recover={init:function(){var e;return e=$("recover-form"),e.observe("submit",this.form_submit.bind(this))},form_submit:function(e){return this.clear_error(),e.preventDefault(),Vt.ajax_submit($("recover-form"),null,this.submit_response.bind(this))},submit_response:function(e){var t;return t=JSON.parse(e.responseText),"error"===t.status&&this.show_error(t.msg),"ok"===t.status&&this.show_hosts(t),"redirect"===t.status?window.location.href=t.url:void 0},show_hosts:function(e){var t,n,i,s,o,r,a;for(Vt.add_vars($("recover-form"),{check_file:"true"}),$("filename-to-create").update(e.filename),n=$("trusted-hosts"),n.update(),a=e.hosts,i=0,o=a.length;o>i;i++)t=a[i],r=new Element("li"),s="lnx","mac"===t.platform&&(s="osx"),"win"===t.platform&&(s="win"),r.__sert(ie.make("web",s)),r.__sert(new Qe(t.display_name.escapeHTML())),n.appendChild(r);return $("login-step").hide(),$("hosts-step").show()},show_error:function(e){return $("error-messages").update(e),$("error-messages").show()},clear_error:function(){return $("error-messages").update()}};var Cn;Cn=tt.Restore={next:function(e,t){var n,i;return i=ge("ul.selected"),n=i.next("ul"),n.addClass("selected"),i.removeClass("selected"),n.next("ul").length?ge("#next-page").show():ge("#next-page").hide(),ge("#prev-page").show(),Cn.inc_page(1)},prev:function(e,t){var n,i;return i=ge("ul.selected"),n=i.prev("ul"),n.addClass("selected"),i.removeClass("selected"),n.prev("ul").length?ge("#prev-page").show():ge("#prev-page").hide(),ge("#next-page").show(),Cn.inc_page(-1)},inc_page:function(e){var t,n;return t=parseInt(ge("#page_num").text(),10),n=t+e,ge("#page_num").text(n)},init:function(e,t,n){var i;return i=Z.get_viewer().get_user_by_id(n),ge("#next-page").on("click",function(e){return Cn.next(e),!1}),ge("#prev-page").on("click",function(e){return Cn.prev(e),!1}),ge("#restore-submit-button").on("click",function(t){return Wt.do_folder_restore(e,i),!1}),ge("#restore-cancel-button").on("click",function(e){return Ve.redirect(t)}),ge("#restore-back-button").on("click",function(e){return Ve.redirect(t)})}};var Dn,$n,Sn,Lt=function(e,t){return function(){return e.apply(t,arguments)}},Nt=function(e,t){function n(){this.constructor=e}for(var i in t)It.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},It={}.hasOwnProperty;Dn=tt.SelectRoleModal=function(e){function t(){return this.on_show=Lt(this.on_show,this),t.__super__.constructor.apply(this,arguments)}return Nt(t,e),t.prototype.on_select_role=null,t.prototype.on_show=function(){return ge(".role-options li").click(function(e){return function(t){var n,i;return n=ge(t.target).closest("li"),i=n.data("role"),assert(e.on_select_role,"missing on_select_role implementation"),e.on_select_role(i),e.hide()}}(this))},t}(_t),Sn=tt.ShmodelC2DSelectRoleModal=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Nt(t,e),t.prototype.on_select_role=function(e){var t;return t=function(){return Pt.show_c2d_modal(e)},Z.get_viewer().is_role_signed_in(e)?t():_e.show_modal({role:e,on_success:t})},t}(Dn),$n=tt.ShareShmodelSelectRoleModal=function(e){function t(){return this.on_select_role=Lt(this.on_select_role,this),t.__super__.constructor.apply(this,arguments)}return Nt(t,e),t.prototype.on_select_role=function(e){return Pt.prompt_login_then_share(this.options.link_url,this.options.short_url,this.options.tokenizer_type,e)},t}(Dn);var Tn;Tn=tt.TabController=Class.create({initialize:function(e,t){var n;return n=$(e),assert(n,e+" is missing."),this.container=n,this.options={killEvent:!0},Object.extend(this.options,t),this.listen()},listen:function(){var e,t,n,i,s,o;for(o=this,i=this.container.select("a"),s=[],t=0,n=i.length;n>t;t++)e=i[t],assert(e.id&&e.id.length>0,"Element is missing an id"),s.push(e.observe("click",function(e){return this.click(e)}.bindAsEventListener(o)));return s},click:function(e){return this.options.killEvent&&Event.stop(e),this.toggle($(e.target))},toggle:function(e){var t,n,i,s,o;return o=this.container.down("a.selected"),o&&(s=$(o.id+"-content"),s&&s.hide()),this.container.select(".selected").invoke("removeClassName","selected"),n=!1,e||(e=this.container.down("a"),n=!0),e.addClassName("selected"),t=$(e.id+"-content"),t&&t.show(),this.options.onTabChange&&this.options.onTabChange(e,o),this.options.url_prefix?(i=this.options.url_prefix,n||(i+="/"+e.id),b.push_state(i)):void 0}});var An;An=tt.InviteForm={initialized:!1,init:function(){return this.initialized?void 0:ge(function(e){return function(){return e.add_auto_completer=new Autocompleter.ContactsTokenizer(Z.get_viewer().get_user_by_role(M.ROLE_WORK),"team-invite-new-collab-input","team-invite-new-whobulk","team-invite-hidden-input",{tokens:[",",";"],hide_import_contacts:!0,suggestions_disabled:!0,contact_filter:function(e){return e.excludeTeamMembers().excludeFacebook().excludeNewStyleGroups().excludeMe()}}),e.add_auto_completer.clearTokens(),e.tokenAdd=ge.proxy(e._tokenAdd,e),e.tokenRemove=ge.proxy(e._tokenRemove,e),ge("#team-invite-new-collab-input")[0].on("token:add",e.tokenAdd),ge("#team-invite-new-collab-input")[0].on("token:remove",e.tokenRemove),e.reset_licenses(),e.update_free_licenses_message(),e.initialized=!0,e.setup_tab_support(ge),tn.init()}}(this))},set_emails:function(e,t){return this.invite_modal&&this.invite_modal.update_is_suggestion(t),null!=e?ge(function(t){return function(){var n,i,s,o,r;for(t.init(),r=[],s=0,o=e.length;o>s;s++)n=e[s],i=t.add_auto_completer.createTokenInfo(null,n,ce.EMAIL),r.push(t.add_auto_completer.addContact(i));return r}}(this)):void 0},rebind_modal_submit_autocompleter:function(){var e,t;return e=this.invite_modal.$modal_window,t=e.find(".tokenizer-submit-button"),t.on("mousedown",function(e){return function(){return e.add_auto_completer.beforeSubmit()}}(this)),this.setup_tab_support(e)},setup_tab_support:function(e){return e.find("#team-invite-new-collab-input").first().on("keyup change",function(){var t;return t=e.find(".new-collab-input").first(),""!==t.val()?t.attr("tabindex",-1):t.removeAttr("tabindex")})},reset_modal_licenses:function(){var e,t,n;return n=null!=__CIRCULAR_DEPENDENCY__.Dashboard?__CIRCULAR_DEPENDENCY__.Dashboard.get_licensed_members():null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.get_licensed_members():window.active_team_member_table.get_licensed_members(),this.total_licenses=null!=(e=null!=(t=__CIRCULAR_DEPENDENCY__.MembersReact)&&"function"==typeof t.get_total_licenses?t.get_total_licenses():void 0)?e:this.total_licenses,this.update_used_licenses(n),this.available_licenses=this.total_licenses-this.used_licenses,this.update_license_count(),this.new_users=0},reset_licenses:function(){return this.available_licenses=this.total_licenses-this.used_licenses,this.update_license_count(),this.new_users=0},get_new_users:function(){return this.new_users},_tokenAdd:function(e){return this.available_licenses--,ge(window).trigger("token:changed",{remaining_licenses:this.available_licenses}),this.new_users++},_tokenRemove:function(e){return this.available_licenses++,ge(window).trigger("token:changed",{remaining_licenses:this.available_licenses}),this.new_users--},already_invited_user:function(e){var t,n,i;if(window.active_team_member_table){t=window.active_team_member_table.data.users;for(i in t)if(n=t[i],n.email===e)return!0}},update_license_count:function(){var e,t;return e=ge("#license-count-message"),this.exp_subgrowth_biz_teams_remove_invite_text_header?void e.text(this.invite_modal.get_remaining_licenses_message(this.available_licenses)):(this.available_licenses<0?(t=this.invite_modal.get_remaining_licenses_message(this.available_licenses),e.addClass("over")):0===this.available_licenses?(t=mt("You have no remaining licenses."),e.removeClass("over")):this.available_licenses>0?(t=ht("You have %(invites)d remaining license.","You have %(invites)d remaining licenses.",this.available_licenses).format({invites:this.available_licenses}),e.removeClass("over")):t="You have   remaining licenses.",e.text(t))},init_modal_licenses_and_reseller:function(e,t,n,i,s){return this.total_licenses=e,this.is_trial=t,this.invite_modal||(this.invite_modal=new Rn(n,this.is_trial,i)),this.exp_subgrowth_biz_teams_remove_invite_text_header=s,ge("body").trigger("invite-modal-initialized")},update_used_licenses:function(e){return this.used_licenses=e,this.reset_licenses()},init_form_licenses:function(e,t,n){return this.total_licenses=e,this.used_licenses=t,this.is_trial=n,An.reset_licenses()},add_total_licenses:function(e){return e=e||0,e>0&&(this.total_licenses+=e,this.available_licenses+=e,this.update_license_count(),null!=__CIRCULAR_DEPENDENCY__.Dashboard)?__CIRCULAR_DEPENDENCY__.Dashboard.add_licenses(e):void 0},on_add_licenses_exit:function(e,t){var n;return(null!=(n=this.invite_modal)?n.$modal_window:void 0)&&this.rebind_modal_submit_autocompleter(),this.add_total_licenses(t)},reset_modal:function(){var e;return e=this.invite_modal.$modal_window,nn.reset(e.find("#team-invite-message")[0]),this.add_auto_completer&&(this.add_auto_completer.clearTokens(),this.add_auto_completer.update.hide()),this.reset_modal_licenses(),e.find(".new-collab-input").val("")},on_add_licenses_click:function(e){return e.preventDefault(),null!=this.add_licenses_cb&&lt.unregister(__CIRCULAR_DEPENDENCY__.AddLicensesModal.LICENSES_ADDED,this.add_licenses_cb),this.add_licenses_cb=ge.proxy(this.on_add_licenses_exit,this),lt.register(__CIRCULAR_DEPENDENCY__.AddLicensesModal.LICENSES_ADDED,this.add_licenses_cb),lt.push(new __CIRCULAR_DEPENDENCY__.AddLicensesModal)},update_free_licenses_message:function(){var e,t;return t=this.invite_as_limited(),e=ge("#license-count-message"),this.exp_subgrowth_biz_teams_remove_invite_text_header&&this.available_licenses>=0?e.hide():e.toggle(!t),ge(".team-invite-add-licenses").toggle(!t),ge("#license-free-message").toggle(t)},invite_as_limited:function(){var e;return e=ge('input[name="membership_type"]'),e&&e.is(":checked")}};var Rn,Lt=function(e,t){return function(){return e.apply(t,arguments)}},Nt=function(e,t){function n(){this.constructor=e}for(var i in t)It.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},It={}.hasOwnProperty;Rn=tt.InviteModal=function(e){function t(e,n,i){this.transition_view_model=e,this.is_trial=n,this.reseller_contact_info=i,this._reset=Lt(this._reset,this),this._update_form_pricing_information=Lt(this._update_form_pricing_information,this),this._update_remaining_licenses_message=Lt(this._update_remaining_licenses_message,this),this._make_transition_info_request=Lt(this._make_transition_info_request,this),this._handle_token_change=Lt(this._handle_token_change,this),this._licenses_total=Lt(this._licenses_total,this),this.is_making_transition_info_request=Lt(this.is_making_transition_info_request,this),this.__overlay_click_handler=Lt(this.__overlay_click_handler,this),this.__x_click_handler=Lt(this.__x_click_handler,this),this.on_cancel_button_click=Lt(this.on_cancel_button_click,this),this.on_cancel_and_log=Lt(this.on_cancel_and_log,this),this.on_hide=Lt(this.on_hide,this),this.on_show=Lt(this.on_show,this),t.__super__.constructor.call(this,{element_id:"team-invite-wizard",focus:".new-collab-input",title:mt("Invite team members")}),this.inline_add_license=null!=this.transition_view_model,this.inline_add_license&&(this.transition_info_fetcher=new vt([this.transition_view_model]),this.probability=Math.random()),this.skip_reset=!1,this.making_transition_info_request=!1,this.transition_info_callback=null,this.subgrowth_biz_upsell="V1"===O.SUBGROWTH_BIZ_UPSELL_VARIANT,this.exp_subgrowth_biz_teams_remove_invite_text_header="V1"===O.SUBGROWTH_BIZ_TEAMS_REMOVE_INVITE_TEXT_HEADER}return Nt(t,e),t.prototype.on_confirm_button_click=function(e){var t,n,i;return i=An.invite_as_limited()?0:this.add_qty,n="send_invites",i&&(n="invite_buy"),t="false",ge("#team-invite-message").val()&&(t="true"),Ke.TeamsWebActionsLogger.log("invite_member_open_invite_click",{invite_or_buy:n,invite_count:""+this._getInvitesCount(),added_message:t}),Bn.add_users(e,i)},t.prototype.on_show=function(){var e,t,n;return this._reset(),n=ge('input[name="membership_type"]'),null!=n&&n.attr("checked",!1),null!=n&&n.click(function(e){return function(){return An.update_free_licenses_message(),e._updated_charges_messages(An.invite_as_limited())}}(this)),e=ge("#team-invite-wizard .team-invite-add-licenses"),e.on("click",ge.proxy(An.on_add_licenses_click,An)),ge(window).on("token:changed",this._handle_token_change),An.initialized&&(Vt.clear_errors(),An.update_license_count(),An.update_free_licenses_message()),lt.register(lt.CLEAR,function(){return An.reset_modal()}),t=this.inline_add_license&&this.add_qty>0&&!An.invite_as_limited(),Ke.TeamsWebActionsLogger.log("invite_member_open",{invite_or_buy:t?"invite_buy":"send_invites"})},t.prototype.on_hide=function(){return ge(window).off("token:changed",this._handle_token_change)},t.prototype.on_cancel_and_log=function(){var e,t,n;return n=this.inline_add_license&&this.add_qty>0&&!An.invite_as_limited(),t="send_invites",n&&(t="invite_buy"),e="false",ge("#team-invite-message").val()&&(e="true"),Ke.TeamsWebActionsLogger.log("invite_member_open_cancel",{invite_or_buy:t,invite_count:""+this._getInvitesCount(),added_message:e})},t.prototype.on_cancel_button_click=function(e){return this.on_cancel_and_log(),t.__super__.on_cancel_button_click.call(this,e)},t.prototype.__x_click_handler=function(e){return this.on_cancel_and_log(),t.__super__.__x_click_handler.call(this,e)},t.prototype.__overlay_click_handler=function(e){return this.on_cancel_and_log(),t.__super__.__overlay_click_handler.call(this,e)},t.prototype.is_making_transition_info_request=function(){return this.making_transition_info_request},t.prototype._licenses_to_add=function(){return-1*An.available_licenses},t.prototype._licenses_total=function(){return An.total_licenses+this._licenses_to_add()},t.prototype._getInvitesCount=function(){return An.total_licenses-An.used_licenses-An.available_licenses},t.prototype._handle_token_change=function(e,t){return this.remaining_licenses=t.remaining_licenses,this._updateConfirmButton(),this._update_remaining_licenses_message(),this.inline_add_license?(clearTimeout(this.fetch_transition_timeout_id),this.fetch_transition_timeout_id=setTimeout(function(e){return function(){return e._make_transition_info_request(),e.fetch_transition_timeout_id=null}}(this),100)):void 0},t.prototype._make_transition_info_request=function(){var e,t,n,i;return this.making_transition_info_request=!0,t=Math.floor(1e6*Math.random()),this.current_callback_token=t,e=this._licenses_to_add(),n=this._licenses_total(),i=function(i){return function(s){return i._update_form_pricing_information(t,e,n,null!=s?s[0]:void 0)}}(this),e>0?this.transition_info_fetcher.get(i,{total_users:this._licenses_total()}):i(null)},t.prototype._update_remaining_licenses_message=function(){var e,t;return e=this.$modal_window.find("#license-count-message"),t=this.get_remaining_licenses_message(this.remaining_licenses),e.text(t),this.exp_subgrowth_biz_teams_remove_invite_text_header?t.length?e.show():e.hide():void 0},t.prototype.get_remaining_licenses_message=function(e){var t,n,i,s;return i=this._getInvitesCount(),n="",this.exp_subgrowth_biz_teams_remove_invite_text_header&&e>=0?n:(s=ht("invitation","invitations",i),this.subgrowth_biz_upsell&&!this.is_suggestion&&(s=ht("approval","approvals",i)),0>e?n=this.reseller_contact_info?this.reseller_contact_info.name&&this.reseller_contact_info.phone?ht("You need more licenses for this %(type)s. Contact %(name)s at %(phone)s to add more.","You need more licenses for these %(type)s. Contact %(name)s at %(phone)s to add more.",i).format({name:this.reseller_contact_info.name,phone:this.reseller_contact_info.phone,type:s}):ht("You need more licenses for this %(type)s. Contact your reseller to add more.","You need more licenses for these %(type)s. Contact your reseller to add more.",i).format({type:s}):ht("You need more licenses for this %(type)s.","You need more licenses for these %(type)s.",i).format({type:s}):0===e?(n=mt("After these %(type)s, you’ll have no remaining licenses.").format({type:s}),1===i&&(n=mt("After this %(type)s, you’ll have no remaining licenses.").format({type:s}))):(t=ht("After this %(type)s","After these %(type)s",i).format({type:s}),n=t+ht(", you’ll have %(count)d remaining license.",", you’ll have %(count)d remaining licenses.",e).format({count:e})),n)},t.prototype._update_form_pricing_information=function(e,t,n,i){var s,o,r,a,_;if(e===this.current_callback_token)return i&&t>0?(this.add_qty=t,s=this.transition_view_model.state.currency,a=i.current_total.amount,r=ft.formatCurrency(a,s),_=ft.formatCurrency(i.recurring_total_tax.amount,s),o=this.is_trial?0:i.transition_view_model.expected_price,ge(".new-amount").text(r),ge(".add-qty").text(t),ge(".recurring-amount").text(_),ge(".total-qty").text(n),ge("#expected_price").val(o),this._updated_charges_messages(An.invite_as_limited())):this._reset(),this.making_transition_info_request=!1},t.prototype.update_is_suggestion=function(e){return this.subgrowth_biz_upsell&&(this.is_suggestion=e,this._updateConfirmButton(),this._updateTitle(),this.remaining_licenses)?this._update_remaining_licenses_message():void 0},t.prototype._updateTitle=function(){return this.subgrowth_biz_upsell?this.is_suggestion?ge("#team-invite-wizard .db-modal-title .db-modal-title-text").text(mt("Invite team members")):ge("#team-invite-wizard .db-modal-title .db-modal-title-text").text(mt("Approve team members")):void 0},t.prototype._updateConfirmButton=function(e){var t,n;return null==e&&(e=!1),t=ge(".team-invite-buttons .confirm-button"),n=this.subgrowth_biz_upsell?e?mt(this.is_suggestion?this.is_trial?"Invite and add":"Invite and buy":this.is_trial?"Approve and add":"Approve and buy"):this.is_suggestion?ht("Send invite","Send invites",this._getInvitesCount()):ht("Approve member","Approve members",this._getInvitesCount()):e?mt(this.is_trial?"Invite and add":"Invite and buy"):ht("Send invite","Send invites",this._getInvitesCount()),t.val(n)},t.prototype._reset=function(){return this.add_qty=0,ge(".charges-section").hide(),ge("#expected_price").val(0),this._updateConfirmButton()},t.prototype._updated_charges_messages=function(e){var t;return t=this.inline_add_license&&this.add_qty>0&&!e,ge(".charges-section").toggle(t),this._updateConfirmButton(t)},t}(_t);var Nn,In,Ln,On,Mn,Un,jn,qn,Fn,Pn,Bn,Yn,zn,Hn,Kn,Lt=function(e,t){return function(){return e.apply(t,arguments)}},Nt=function(e,t){function n(){this.constructor=e}for(var i in t)It.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},It={}.hasOwnProperty;qn={ACTIVE:1,PENDING:2,ERROR:3,REMOVED:4,SUSPENDED:5},Bn=INLINE_JS.Team=tt.Team={_use_async_reset:!1,team_id:Z.get_viewer().team_id,set_team_id:function(e){this.team_id=e},setup_beta_modal_listeners:function(){var e,t,n,i,s,o,r,a,_;for(t=ge(".feature-list .enroll-button"),i=ge(".feature-list .feedback-button"),s=0,r=t.length;r>s;s++)e=t[s],n=ge(e).data("feature"),ge(e).click(function(e){return function(){return new In(e).show()}}(n)),e.disabled=!1;for(_=[],o=0,a=i.length;a>o;o++)e=i[o],n=ge(e).data("feature"),_.push(ge(e).click(function(e){return function(){return new Ln(e).show()}}(n)));return _},invite_modal_show:function(e,t){return An.invite_modal?(this.invite_modal_already_initialized?(An.invite_modal.show(),An.rebind_modal_submit_autocompleter()):(An.invite_modal.show(),An.init(),this.invite_modal_already_initialized=!0),null!=window.active_team_member_table&&An.update_used_licenses(window.active_team_member_table.get_licensed_members()),An.set_emails(e,t)):ge("body").one("invite-modal-initialized",function(t){return function(){return t.invite_modal_show(e)}}(this))},init_admin:function(){return sn.set_vertical_space(2),ge("form.activity-report-generator").submit(this.submit_report_form.bind(this))},init_team_name_change_notice:function(){return ge(".team_name_change_notice .hide_link").click(function(e){return function(t){return e.hide_team_name_change_banner()}}(this))},add_users:function(e,t){var n,i,s,o,r;return Event.stop(e),s=$("team-invite-form"),assert(s,"Couldn't find the team invite form."),i=ge(s).find("input[name='emails']"),o="send_invites",t&&(o="invite_buy"),n="false",ge("#team-invite-message").val()&&(n="true"),0===i.length?(D.error(mt("You haven't included anyone to invite! Please invite at least one person.")),void Ke.TeamsWebActionsLogger.log("invite_member_open_invite_error",{invite_or_buy:o,error_reason:"no_invites"})):(r=function(r){return function(){var a;return a=Vt.collect_form_vars(s),ge.extend(a,{team_id:r.team_id}),Vt.add_loading(e.target),new Ajax.DBRequest("/account/team/add_users",{parameters:a,subject_user:Z.get_viewer().work_user,progress_text:mt("Inviting members..."),noAutonotify:!0,onSuccess:function(e){var s,r,a,_;return Vt.remove_loading(),An.reset_modal(),An.add_total_licenses(t),An.invite_modal.hide(),a=JSON.parse(e.responseText),a?(null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.active_team_member_table?window.active_team_member_table.add_users(null!=a?a.users:void 0):null!=__CIRCULAR_DEPENDENCY__.Dashboard&&__CIRCULAR_DEPENDENCY__.Dashboard.set_num_invited(null!=a?a.num_invited:void 0),s=function(){var e,t;e=null!=a?a.users:void 0,t=[];for(r in e)_=e[r],t.push(_);return t}(),1===s.length?D.success(mt("Invited %(user_email)s.").format({user_email:s[0].email})):s.length>1?D.success(mt("Invited %(user_count)d people.").format({user_count:s.length})):D.error(ht("Skipped %(num_skipped)d person who is already a member of the team.","Skipped %(num_skipped)d people who are already members of the team.",i.length).format({num_skipped:i.length})),Ke.TeamsWebActionsLogger.log("invite_member_open_invite_success",{invite_or_buy:o,invite_count:""+s.length,added_message:n})):D.error()},onFailure:function(e){var t,n;return e&&(0===e.responseText.indexOf("err:")?(t=e.responseText.substr(4),0===t.indexOf("{")?(n=t.evalJSON(!0),Vt.fill_errors(s,n),Ke.TeamsWebActionsLogger.log("invite_member_open_invite_error",{invite_or_buy:o,error_reason:"form_input_invalid"})):(t=new Qe(t),D.error(t))):(D.error(),Ke.TeamsWebActionsLogger.log("invite_member_open_invite_error",{invite_or_buy:o,error_reason:"problem_request"}))),Vt.remove_loading(),ge("input[type='submit']").prop("disabled",!1)}})}}(this),setTimeout(function(){return An.invite_modal.is_making_transition_info_request()?void 0:r()},100))},show_demo_signup_modal:function(e,t,n,i,s){var o,r,a,_;return this.webinar_key=e,this.webinar_iso_datetime=t,this.webinar_date=n,this.webinar_title=i,this.tab_url=s,_=mt("Register for a webinar on %(start_time)s").format({start_time:this.webinar_date}),r=new On({element_id:"demo-signup-modal",title:_}),r.show(),r.$modal_window.find("input[name=webinar_key]").attr("value",this.webinar_key),r.$modal_window.find("input[name=webinar_title]").attr("value",this.webinar_title),r.$modal_window.find("input[name=Sales_Webinar_Topic__c]").attr("value",this.webinar_title),r.$modal_window.find("input[name=Sales_webinar_date__c]").attr("value",this.webinar_iso_datetime),a=r.$modal_window.find("input[name=retURL]"),a.attr("value",a.val()+"#"+this.tab_url),o=r.$modal_window.find("#demo-signup-form")[0],o.on("submit",r.on_confirm_button_click)},show_unsuspend_modal:function(e,t,n,i){var s;return s=new jn({element_id:"dfe-unsuspend-modal",focus:"confirm"}),s.user_name=e||n,s.email=n,s.user_id=t,s.team_id=this.team_id,s.refresh_cb=i,s.show(),!1},show_remove_or_deactivate_modal:function(e,t,n,i,s,o,r,a,_,l){var u;return u=new Mn({element_id:"dfe-remove-or-deactivate-user-modal",focus:".new-collab-input"}),u.user_name=t||i,u.email=i,u.user_id=n,u.team_id=this.team_id,u.invited=s,u.limited=r,u.num_api_apps=o,u.hide_transfer_wipe=a,u.user_recovery_enabled=_,u.refresh_cb=l,u.show(),!1},show_remove_modal:function(e,t,n,i,s,o,r,a,_,l,u){var c;return c=new Un({element_id:"dfe-remove-user-modal",focus:".new-collab-input"}),c.user_name=t||i,c.email=i,c.user_id=n,c.team_id=this.team_id,c.invited=s,c.num_api_apps=o,c.hide_transfer_setting=r,c.hide_remote_wipe_setting=a,c.user_recovery_enabled=l,c.refresh_cb=u,c.user_is_managed=_,c.show(),!1},remove_user:function(e,t){var n,i,s;return alert("in remove_user"),Event.stop(e),i=ge("input[type=submit]","#remove-user-modal"),i.attr("disabled",1),s=en.vars.user_id,n=t?!0:ge("input[name=should_disable]:checked","#remove-user-modal").val(),new Ajax.DBRequest("/account/team/remove_user",{parameters:{team_id:this.team_id,user_id:s,should_disable:n},onSuccess:function(e){return function(t){var n,i,s;return s=JSON.parse(t.responseText),null!=(n=window.active_team_member_table)&&n.remove_user(en.vars.user_id),null!=(i=window.removed_team_member_table)&&i.add_users(s),e.decrement_used_licenses(),D.success(mt("User removed."))}}(this),cleanUp:function(){return en.hide(),i.removeAttr("disabled")}})},show_reinvite_modal:function(e,t,n,i){var s;return xt.fillVal(i,"reinvite-user-email"),xt.fillVal(t,"reinvite-user-team"),s=mt("Resend invite to '%(email_address)s'").format({email_address:h.em_snippet(i,18)}),en.show(s,$("reinvite-user-modal"),{user_id:n,button:e})},email_verification:this.email_verification=new at("work"),show_email_verification_modal:function(){return this.email_verification.show_verify_modal(null,qe.NEW_DFB_TEAM)},reinvite_user:function(e){var t;return Event.stop(e),t=en.vars.user_id,new Ajax.DBRequest("/account/team/reinvite_user",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(e){var n,i,s,o;return D.success(mt("Invite sent.")),null!=(i=$("team-member-info"))&&i.update(e.responseText),n=window.active_team_member_table,n?(o=n.data.users[t],o.invite_expired=!1,s={},s[t]=o,n.update_user_data(s)):void 0},cleanUp:function(){return en.hide()}})},show_request_license_modal:function(e,t){var n;return n=mt("Send upgrade request?"),en.show(n,$("request-license-modal"),{user_id:t,button:e})},request_license:function(e){var t;return Event.stop(e),t=en.vars.user_id,new Ajax.DBRequest("/team/request_license",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(e){return ge("#request_license_text").hide(),ge("#request-license-section").hide(),D.success(mt("Request sent."))},cleanUp:function(){return en.hide()}})},show_user_activity_log_modal:function(e,t,n){var i;return i=ge("#activity-log-modal"),i.find(".activity-log-email").text(t),i.find(".activity-log-name").text(n),i.find("#activity-log-user-message").show(),en.show(mt("Create activity report"),i[0],{user_id:e})},show_team_activity_log_modal:function(e,t){var n;return n=ge("#activity-log-modal"),n.find(".activity-log-email").text(e),n.find(".activity-log-name").text(t),n.find("#activity-log-team-message").show(),en.show(mt("Create full activity report"),n[0])},generate_activity_log:function(e){var t,n,i,s,o,r,a;return Event.stop(e),n=ge("#activity-log-modal"),i=n.find("input[name='from_date']").val(),o=n.find("input[name='to_date']").val(),i>o?void D.error(mt("Your start date is after your end date.")):(s=this.team_id,a=en.vars.user_id,r=(new Date).getTimezoneOffset().toString(),t=ge(".activity-report-generator .freshbutton-blue"),t.prop("disabled",!0),new Ajax.DBRequest("/team/events_report/csv",{parameters:{from_date:i,to_date:o,team_id:s,user_id:a,tzoffset:r},onSuccess:function(e){return D.success(mt("Report started. We'll email you when it's ready."))},cleanUp:function(){return en.hide(),t.prop("disabled",!1)}}))},show_reset_password_modal:function(e,t,n){var i,s;return s=u({path:"/team/admin/member",query:{id:n}}).toString(),ge("#reset-password-modal .member-name").text(t),ge("#reset-password-modal .member-page-link").attr("href",s),i=mt("Reset password for '%(user_name)s'").format({user_name:t}),en.show(i,$("reset-password-modal"),{user_id:n,button:e})},reset_password:function(e){var t;return Event.stop(e),t=en.vars.user_id,new Ajax.DBRequest("/account/team/reset_password",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(e){return D.success(mt("User's password reset."))},cleanUp:function(){return en.hide()}})},show_reset_all_passwords_modal:function(){return en.show(mt("Reset all passwords"),$("reset-all-passwords-modal"))},set_async_password_reset:function(e){return this._use_async_reset=e},reset_all_passwords:function(){return new Ajax.DBRequest("/account/team/reset_all_passwords",{parameters:{team_id:this.team_id},job:this._use_async_reset,subject_user:Z.get_viewer().work_user,progress_text:mt("Resetting all passwords..."),onSuccess:function(e){return D.success(mt("All passwords reset."))},cleanUp:function(){return en.hide()}})},show_admin_status_modal:function(e,t,n,i,s,o){var r,a,_,l;return a=s.trim()||i,_=void 0,r=void 0,l=void 0,o?(l=mt("Add admin permissions for '%(person_name)s'").format({person_name:a.escapeHTML()}),_=mt("Are you sure you want to add admin permissions for <strong>%(person_name)s</strong>?").format({person_name:a.escapeHTML()}),r=mt("Add admin permissions",{comment:"make this user an admin; give them the permissions an admin has"})):(l=mt("Remove admin privileges from '%(person_name)s'").format({person_name:a.escapeHTML()}),_=mt("Are you sure you want to remove admin permissions from <strong>%(person_name)s</strong>?").format({person_name:a.escapeHTML()}),r=mt("Remove admin permissions",{comment:"clicking this button completes the action: it removes a person's admin status"})),xt.fillVal(i,"admin-status-email"),xt.fillVal(_,"admin-status-action"),xt.fillVal(r,"admin-status-button-action"),en.show(l,$("admin-status-modal"),{user_id:n,button:e,admin_on:o}),!1},set_admin_status:function(e){var t;return Event.stop(e),t=en.vars.user_id,new Ajax.DBRequest("/account/team/set_admin_status",{parameters:{team_id:this.team_id,user_id:t,on:en.vars.admin_on?"yes":"no"},onSuccess:function(e){var t,n;return t=mt(en.vars.admin_on?"User's admin status granted.":"User's admin status removed."),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.active_team_member_table?(n=JSON.parse(e.responseText),window.active_team_member_table.update_user_data(n),D.success(t)):en.vars.admin_on?window.location="/team/admin/member?id=%d&msg=granted".format(en.vars.user_id):window.location="/team/admin/member?id=%d&msg=removed".format(en.vars.user_id)},cleanUp:function(){return en.hide()}})},show_disable_2fa_modal:function(e,t,n){return ge("#disable-2fa-modal .member-name").text(n),en.show(mt("Disable two-step verification"),$("disable-2fa-modal"),{user_id:t,elm:e})},show_reset_2fa_modal:function(e,t,n){return ge("#reset-2fa-modal .member-name").text(n),en.show(mt("Reset two-step verification"),$("reset-2fa-modal"),{user_id:t,user_name:n,elm:e})},reset_2fa:function(){return new Ajax.DBRequest("/account/team/reset_2fa",{parameters:{team_id:this.team_id,user_id:en.vars.user_id},onSuccess:function(e){var t;return ge(".tfa_enabled").replaceWith(mt("Disabled")),t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.active_team_member_table?window.active_team_member_table.update_user_data(t):__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),
D.success(mt("Two-step verification reset for %(user_name)s").format({user_name:en.vars.user_name})),en.hide()}})},disable_2fa:function(){return new Ajax.DBRequest("/account/team/disable_2fa",{parameters:{team_id:this.team_id,user_id:en.vars.user_id},onSuccess:function(e){var t;return ge(".tfa_enabled").replaceWith(mt("Disabled")),t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.active_team_member_table?window.active_team_member_table.update_user_data(t):__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),D.success(mt("Two-step verification disabled.")),en.hide()}})},show_sso_preview_email:function(e){return en.show(mt("Email preview"),$(e))},show_sso_sample_email:function(e){return en.show(mt("Sample email"),$(e))},show_user_message_modal:function(e,t,n){var i;return xt.fillVal(n,"user-message-email"),i=mt("Send email to '%(user_name)s'").format({user_name:e}),$("user-message").value="",en.show(i,$("user-message-modal"),{user_name:e,user_id:t}),yt.focus.defer("user-message")},send_user_message:function(){var e,t;return t=en.vars.user_id,e=$F("user-message").trim(),new Ajax.DBRequest("/account/team/send_user_message",{parameters:{user_id:t,team_id:this.team_id,message:e},onSuccess:function(){var e;return e=en.vars.user_name,D.success(mt("Message successfully sent to %(user_name)s.").format({user_name:e})),en.hide()}})},hide_team_name_change_banner:function(){return new Ajax.DBRequest("/account/team/name_change_notice_received",{parameters:{team_id:this.team_id}}),ge(".team_name_change_notice").hide(),!1},hide_pin_banner:function(){return new Ajax.DBRequest("/team/invalidate_pin"),ge(".pin_notice").hide()},hide_pin_banner_with_user_id:function(e,t){var n;return n=function(e){return ge(t).closest("span").removeClass("on").addClass("off")},null===e?new Ajax.DBRequest("/team/invalidate_pin",{onSuccess:n}):new Ajax.DBRequest("/team/invalidate_pin",{parameters:{user_id:e},onSuccess:n})},get_pin_with_user_id:function(e,t,n){var i;return null==n&&(n=null),null===n&&(n=function(e,t){return ge(t).closest("span").find(".pin-value").text(e.pin+" -"),ge(t).closest("span").removeClass("off").addClass("on")}),i=function(e){var i;return i=JSON.parse(e.responseText),n(i,t)},null===e?new Ajax.DBRequest("/team/generate_pin",{onSuccess:i}):new Ajax.DBRequest("/team/generate_pin",{parameters:{user_id:e},onSuccess:i})},send_team_message:function(e){var t;return Event.stop(e),t=$F("team-message").trim(),t?new Ajax.DBRequest("/account/team/send_team_message",{parameters:{team_id:this.team_id,message:t},onSuccess:function(e){return D.success(mt("Message successfully sent to team.")),en.hide()}}):void 0},show_security_message_modal:function(){return(new Yn).show()},send_team_security_message:function(e){var t,n;return Event.stop(e),n=$F("team-security-message").trim(),t=$("team-security-message-form"),new Ajax.DBRequest("/account/team/send_team_message",{parameters:t.serialize(!0),onSuccess:function(e){return D.success(mt("Message successfully sent.")),en.hide()}})},used_licenses:0,total_licenses:0,set_used_licenses:function(e,t){return this.used_licenses=e,this.total_licenses=t},decrement_used_licenses:function(){return this.set_used_licenses(this.used_licenses-1,this.total_licenses)},show_migration_link:function(e,t){return $("migration-url").value=t,en.show(mt("Migration link for '%(email)s'").format({email:h.em_snippet(e,18)}),$("migrate-url-modal")),$("migration-url").select()},show_end_session_modal:function(e,t,n){return sn.hide_all(),ge("#end-session-modal .member-name").text(ge("#member-name").text()),en.show(mt("Close web session",{comment:"Log out of your current Dropbox web session"}),$("end-session-modal"),{login_id:e,user_id:t,elm:n})},end_session:function(){return new Ajax.DBRequest("/logout_remote_session",{parameters:{remote_login_id:en.vars.login_id,team_id:this.team_id,user_id:en.vars.user_id},onSuccess:function(){return en.hide(),Bn.remove_closest_row(en.vars.elm),D.success(mt("Web session closed."))}})},unlink_device:function(e,t,n,i,s,o,r){var a,_;return sn.hide_all(),a=$("unlink-device-modal-"+o),_=mt("Unlink %(device_name)s").format({device_name:n}),en.show(_,a,{app_id:t,user_id:s,elm:r,device_id:e,display_name:n})},unlink_device_submit:function(){return new Ajax.DBRequest("/account/unlink_team_device",{parameters:{app_id:en.vars.app_id,team_id:this.team_id,user_id:en.vars.user_id,device_id:JSON.stringify(en.vars.device_id)},subject_user:Z.get_viewer().work_user,onSuccess:function(){return en.hide(),Bn.remove_closest_row(en.vars.elm),D.success(mt("%(device_name)s unlinked.").format({device_name:en.vars.display_name}))}})},disable_app:function(e,t,n,i){return sn.hide_all(),ge("#disable-app-modal .app-name").text(t),ge("#disable-app-modal .member-name").text(ge("#member-name").text()),en.show(mt("Disable '%(app_name)s'?").format({app_name:t}),$("disable-app-modal"),{app_id:e,user_id:n,elm:i})},disable_app_submit:function(){return new Ajax.DBRequest("/api/uninstall_app",{parameters:{app_id:en.vars.app_id,keep_sandbox_files:!0,team_id:this.team_id,user_id:en.vars.user_id},subject_user:Z.get_viewer().work_user,onSuccess:function(e){return en.hide(),Bn.remove_closest_row(en.vars.elm),D.success(e.responseText)}})},remove_closest_row:function(e){var t,n,i;return t=ge(e).closest(".team_admin_table_row"),n=ge(t).closest(".team_admin_table"),1===n.find(".team_admin_table_row").length?(i=n.prev(".team_admin_table_title"),i.length||(i=ge(".team_apps_table_panel")),i.remove(),n.remove()):t.remove()},submit_report_form:function(e){return ge(e.target.elements.tzoffset).val(""+(new Date).getTimezoneOffset()),!0},show_recover_user_modal:function(e,t,n,i,s){var o;return o=new Pn({element_id:"recover-user-modal",focus:"cancel"}),o.user_name=e||n,o.email=n,o.user_id=t,o.team_id=this.team_id,o.refresh_cb=s,o.pre_removal_join_state=i,o.show(),!1}},In=tt.BetaEnrollConfirmationModal=function(e){function t(e){this.feature_name=e,this.on_confirm_button_click=Lt(this.on_confirm_button_click,this),t.__super__.constructor.call(this,{element_id:"beta-enroll-confirmation-modal__"+this.feature_name})}return Nt(t,e),t.prototype.on_confirm_button_click=function(e){var t;return t="#beta-enroll-confirmation-modal__%(feature_name)s form".format({feature_name:this.feature_name}),ge("<input>").attr({type:"hidden",name:"feature_name",value:this.feature_name}).appendTo(t),this.$modal_window.addClass("ajax-loading")},t}(_t),Ln=tt.BetaFeedbackModal=function(e){function t(e){this.feature_name=e,this.success=Lt(this.success,this),t.__super__.constructor.call(this,{element_id:"beta-feedback-modal"}),this.on_confirm_button_click=function(e){return function(t){var n,i,s;return t.preventDefault(),n=ge(t.target),i=n.closest("form"),s={feature_name:e.feature_name},Vt.ajax_submit(i[0],!1,e.success,e.error,n[0],s)}}(this)}return Nt(t,e),t.prototype.success=function(e){return D.success(mt("Thank you for your feedback.")),this.$modal_window.hide()},t.prototype.error=function(e){return 200!==e.status?D.error(mt("Failed to submit feedback. Please try again.")):void 0},t}(_t),On=tt.DemoSignupModal=function(e){function t(){return this.on_show=Lt(this.on_show,this),this.on_confirm_button_click=Lt(this.on_confirm_button_click,this),t.__super__.constructor.apply(this,arguments)}return Nt(t,e),t.prototype.on_confirm_button_click=function(e){var t,n,i,s,o,r,a,_,l,u,c,d;return e.preventDefault(),c=$("demo-signup-form"),_=$("1210"),r=ge(c).find("input[name='first_name']").val(),ge(_).find("input[name='FirstName']").attr("value",r),a=ge(c).find("input[name='last_name']").val(),ge(_).find("input[name='LastName']").attr("value",a),o=ge(c).find("input[name='email']").val(),ge(_).find("input[name='Email']").attr("value",o),u=ge(c).find("input[name='phone_number']").val(),ge(_).find("input[name='Phone']").attr("value",u),t=ge(c).find("input[name='company_name']").val(),ge(_).find("input[name='Company']").attr("value",t),i=ge(c).find("select[name='company_size']"),n=i.find("option:selected").val(),ge(_).find("input[name='Company_size__c']").attr("value",n),s=$(this.$modal_window.find(".confirm-button")[0]),d=function(e){return function(t){return e.$modal_window.hide(),_.submit()}}(this),l=Vt.collect_form_vars(c,!0),Vt.ajax_submit(c,!1,d,!1,s,l,!0)},t.prototype.on_show=function(e){return this.$modal_window.find(".db-modal-content").css({"overflow-y":""}),tn.init()},t}(_t),Nn=tt.AccountTransferBaseModal=function(e){function t(e,n,i){this.file_action_selector=n,this.transfer_choice_selector=i,this._clearInput=Lt(this._clearInput,this),this._markInputInvalid=Lt(this._markInputInvalid,this),this._markInputValid=Lt(this._markInputValid,this),this._tokenRemove=Lt(this._tokenRemove,this),this._tokenAdd=Lt(this._tokenAdd,this),this._selectChange=Lt(this._selectChange,this),this._isTransferSelected=Lt(this._isTransferSelected,this),this.checkAndApproveMemberRemoval=Lt(this.checkAndApproveMemberRemoval,this),this.on_cancel_button_click=Lt(this.on_cancel_button_click,this),this.execute_form=Lt(this.execute_form,this),this.get_cancel_button=Lt(this.get_cancel_button,this),this.get_confirm_button=Lt(this.get_confirm_button,this),this.get_button_class=Lt(this.get_button_class,this),this.set_modal_class=Lt(this.set_modal_class,this),this.handleAjaxFailure=Lt(this.handleAjaxFailure,this),this.on_show=Lt(this.on_show,this),t.__super__.constructor.call(this,e,this.file_action_selector,this.transfer_choice_selector)}return Nt(t,e),t.prototype.on_show=function(){return 0!==this.$modal_window.find("#manage-files-new-collab-input").length?(this.auto_completer=new Autocompleter.TeamTokenizer(Z.get_viewer().get_user_by_role(M.ROLE_WORK),"manage-files-new-collab-input","manage-files-new-whobulk","manage-files-hidden-input",{hide_import_contacts:!0,suggestions_disabled:!0,wrap_name:!0,single_token:!0,contact_filter:function(e){return function(t){return t.excludeNonTeam().excludeNewStyleGroups().excludeByEmail(e.email)}}(this)}),this.tokenAdd=ge.proxy(this._tokenAdd,this),this.tokenRemove=ge.proxy(this._tokenRemove,this),this.$collab_input=this.$modal_window.find("#manage-files-new-collab-input")[0],this.$collab_input.on("token:add",this.tokenAdd),this.$collab_input.on("token:remove",this.tokenRemove),this.$textinput=this.$modal_window.find(".tokenized_autocompleter_container .textinput"),this.selectChange=ge.proxy(this._selectChange,this),this.$modal_window.find(this.file_action_selector).on("change",this.selectChange)):void 0},t.prototype.handleAjaxFailure=function(e){return 200===e.status&&this._isTransferSelected()?this._markInputInvalid():void 0},t.prototype.set_modal_class=function(e){var t,n,i,s,o,r;return i="suspending deleting approve_transfer_to_suspended",s=this.get_form(),s.removeClass(i),null!=e&&s.addClass(e),null!=(o=ge(".suspend_option_content"))&&o.removeClass("title_bubble no_suspend"),n=null!=this.limited&&this.limited,t=null!=this.invited&&this.invited,n||t?(ge(".suspend_option_content").addClass("title_bubble no_suspend"),r="",r=mt(t?"Invited members can not be suspended":"Limited members can not be suspended"),ge(".suspend_option_content").attr("data-title",r)):void 0},t.prototype.get_button_class=function(){var e;return e=this.get_form(),e.hasClass("suspending")?".confirm_deactivate_button":e.hasClass("deleting")?".confirm_delete_button":e.hasClass("approve_transfer_to_suspended")?".confirm_transfer_to_suspended_button":void 0},t.prototype.get_confirm_button=function(){var e;return e=this.get_button_class(),null!=e?$(this.$modal_window.find(e+" .confirm-button")):$(this.$modal_window.find(".confirm-button"))},t.prototype.get_cancel_button=function(){var e;return e=this.get_button_class(),null!=e?$(this.$modal_window.find(e+" .cancel-button")):$(this.$modal_window.find(".cancel-button"))},t.prototype.execute_form=function(){var e,t;return t=this.get_form()[0],e=this.get_confirm_button(),Vt.ajax_submit(t,!1,this.success_callback,this.handleAjaxFailure,e)},t.prototype.on_cancel_button_click=function(e){var n;return e.preventDefault(),n=this.get_form(),n.hasClass("approve_transfer_to_suspended")?(this.reset_button_click(this.$confirm_button,this.on_confirm_button_click),this.reset_button_click(this.$cancel_button,this.on_cancel_button_click)):t.__super__.on_cancel_button_click.apply(this,arguments)},t.prototype.reset_button_click=function(e,t){return e.off("click"),null!=t?e.on("click",t):void 0},t.prototype.checkAndApproveMemberRemoval=function(e){var t,n;return!ge("#deactivate_option").is(":checked")&&ge("#transfer_files_on").is(":checked")&&!this.invited&&(t=ge(".tokenized_autocompleter_container .token-display-text"),n=ge(".tokenized_autocompleter_container .token-suspended"),t.length&&n.length)?(this.set_modal_class("approve_transfer_to_suspended"),this.$modal_window.find(".target_user_name").text(t.text()),this.$confirm_button=this.get_confirm_button(),this.reset_button_click(this.$confirm_button,function(e){return function(t){return e.execute_form()}}(this)),this.$cancel_button=this.get_cancel_button(),void this.$cancel_button.on("click",e)):this.execute_form()},t.prototype._isTransferSelected=function(){return ge(this.transfer_choice_selector).prop("checked")},t.prototype._selectChange=function(e){return this._isTransferSelected()?this.$textinput.removeClass("unselected"):this.$textinput.addClass("unselected")},t.prototype._tokenAdd=function(e){return this.$collab_input.hide(),e.memo.valid?this._markInputValid():this._markInputInvalid()},t.prototype._tokenRemove=function(e){return this.$collab_input.show(),this._clearInput()},t.prototype._markInputValid=function(){return this._clearInput(),this.$textinput.addClass("valid")},t.prototype._markInputInvalid=function(){return this._clearInput(),this.$textinput.addClass("invalid")},t.prototype._clearInput=function(){return this.$textinput.removeClass("valid"),this.$textinput.removeClass("invalid")},t}(_t),Yn=tt.TwoFactorMessageModal=function(e){function t(){t.__super__.constructor.call(this,{element_id:"team-security-message-modal",focus:"#team-security-message"})}return Nt(t,e),t.prototype.on_confirm_button_click=function(e){return Bn.send_team_security_message(e),this.hide()},t}(_t),jn=tt.DfeUnsuspendUserModal=function(e){function t(e){this.on_confirm_button_click=Lt(this.on_confirm_button_click,this),this.success_callback=Lt(this.success_callback,this),t.__super__.constructor.call(this,e)}return Nt(t,e),t.prototype.before_show=function(){var e;return t.__super__.before_show.call(this),e=mt("Unsuspend %(user_name)s").format({user_name:this.user_name}),this.$modal_window.find(".db-modal-title-text").text(e),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.$modal_window.find("[name=email]").attr("value",this.email),this.$modal_window.find(".unsuspended_name").text(this.user_name),this.$modal_window.find(".unsuspended_email").text(this.email)},t.prototype.success_callback=function(e){var t;return null!=(t=__CIRCULAR_DEPENDENCY__.MembersReact)&&t.refresh_member_stats(),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb("unsuspended"):void 0},t.prototype.on_confirm_button_click=function(e){var t,n;return e.preventDefault(),n=this.$modal_window.find(".dfe-unsuspend-modal")[0],t=$(this.$modal_window.find(".confirm-button")[0]),Vt.ajax_submit(n,!1,this.success_callback,!1,t)},t}(_t),Mn=tt.DfeRemoveOrDeactivateUserModal=function(e){function t(e){this.on_confirm_button_click=Lt(this.on_confirm_button_click,this),this.success_callback=Lt(this.success_callback,this),this.on_show=Lt(this.on_show,this),this.handle_change_action=Lt(this.handle_change_action,this),this.switch_to_removal_mode=Lt(this.switch_to_removal_mode,this),this.switch_to_deactivation_mode=Lt(this.switch_to_deactivation_mode,this),this.show_removal_content=Lt(this.show_removal_content,this),this.show_deactivation_content=Lt(this.show_deactivation_content,this),t.__super__.constructor.call(this,e,"input[name=transfer_files]","#transfer_files_on")}return Nt(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".dfe-remove-or-deactivate-user-modal")},t.prototype.set_form_action_to_deactivate=function(){return ge(".dfe-remove-or-deactivate-user-modal").attr("action","/account/team/suspend_user")},t.prototype.set_form_action_to_remove=function(){return ge(".dfe-remove-or-deactivate-user-modal").attr("action","/account/team/remove_user")},t.prototype.show_deactivation_content=function(){return this.set_modal_class("suspending")},t.prototype.show_removal_content=function(){return this.set_modal_class("deleting")},t.prototype.switch_to_deactivation_mode=function(){return this.show_deactivation_content(),this.set_form_action_to_deactivate()},t.prototype.switch_to_removal_mode=function(){return this.show_removal_content(),this.set_form_action_to_remove(),this.invited?this.$modal_window.find(".remote_wipe_setting").remove():void 0},t.prototype.handle_change_action=function(e){return e.preventDefault(),ge("#deactivate_option").is(":checked")?this.switch_to_deactivation_mode():this.switch_to_removal_mode()},t.prototype.on_show=function(e){var n,i;return t.__super__.on_show.call(this),ge("input[name=deactivate_or_remove]").on("change",this.handle_change_action),this.$modal_window.find(".deleted_user_name").text(this.user_name),this.num_api_apps?(n=ht("%(num)s API app","%(num)s API apps",this.num_api_apps).format({num:this.num_api_apps}),this.$modal_window.find(".num_api_apps").text(n)):this.$modal_window.find(".api_app_warning").hide(),i=mt("Suspend or delete %(user_name)s").format({user_name:this.user_name}),this.limited||this.invited?(ge("#deactivate_option").prop("disabled",!0),ge("#delete_option").attr("checked","checked"),this.switch_to_removal_mode()):(ge("#deactivate_option").attr("checked","checked"),this.switch_to_deactivation_mode()),this.$modal_window.find(".db-modal-title-text").text(i),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.hide_transfer_wipe?(this.$modal_window.find(".transfer_data_on_remove_setting").remove(),this.$modal_window.find(".remote_wipe_setting").remove()):void 0},t.prototype.success_callback=function(e){var t,n,i,s,o;return null!=__CIRCULAR_DEPENDENCY__.MembersReact&&__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats(),t="",i=null,s={user_id:this.user_id,team_id:this.team_id,user_name:this.user_name,email:this.email},o=null,ge("#deactivate_option").is(":checked")?(t="suspended",n=mt("User suspended"),i=null,s=null):(t="deleted",n=mt("User deleted"),o=mt("Restore",{comment:"Undo message that enables restoring a recently deleted user"}),!this.user_recovery_enabled||ge("#transfer_files_on").is(":checked")||this.invited?(i=null,s=null):i=function(e){return Bn.show_recover_user_modal(e.user_name,e.user_id,e.email,qn.ACTIVE,function(e){return D.success(mt("User %(msg)s".format({msg:e})))})}),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb(t,n,s,i,o):void 0},t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.checkAndApproveMemberRemoval(this.switch_to_removal_mode)},t}(Nn),Un=tt.DfeRemoveUserModal=function(e){function t(e){this.on_confirm_button_click=Lt(this.on_confirm_button_click,this),this.switch_to_removal_mode=Lt(this.switch_to_removal_mode,this),this.success_callback=Lt(this.success_callback,this),this.on_show=Lt(this.on_show,this),t.__super__.constructor.call(this,e,"input[name=transfer_files]","#transfer_files_on")}return Nt(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".dfe-remove-user-modal")},t.prototype.on_show=function(e){var n,i;return t.__super__.on_show.call(this),this.$modal_window.find(".remove_user_name").text(this.user_name),i=this.invited?mt("Uninvite %(user_name)s").format({user_name:this.user_name}):mt("Delete %(user_name)s").format({user_name:this.user_name}),this.$modal_window.find(".db-modal-title-text").text(i),this.num_api_apps?(n=ht("%(num)s API app","%(num)s API apps",this.num_api_apps).format({num:this.num_api_apps}),this.$modal_window.find(".num_api_app").text(n)):this.$modal_window.find(".api_app_warning").hide(),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.user_is_managed?this.$modal_window.find(".remove-content-limited-member").remove():(this.$modal_window.find(".remove_content").remove(),this.$modal_window.find(".remote_wipe_setting").remove()),this.invited&&(this.$modal_window.find(".transfer_files_option").remove(),this.$modal_window.find(".remote_wipe_setting").remove(),this.get_form().addClass("invited")),this.hide_transfer_setting&&this.$modal_window.find(".transfer_files_option").remove(),this.hide_remote_wipe_setting?this.$modal_window.find(".remote_wipe_setting").remove():void 0},t.prototype.success_callback=function(e){var t,n,i,s,o,r,a,_;return o=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():(null!=(i=window.active_team_member_table)&&i.remove_user(this.user_id),null!=(s=window.removed_team_member_table)&&s.add_users(o)),t="",r=null,a=null,_=null,this.invited?(t="uninvited",n=mt("User uninvited")):(t="deleted",n=mt("User deleted"),this.user_recovery_enabled&&!ge("#transfer_files_on").is(":checked")&&(_=mt("Restore",{comment:"Undo message that enables restoring a recently deleted user"}),a={user_id:this.user_id,team_id:this.team_id,user_name:this.user_name,email:this.email},r=function(e){return Bn.show_recover_user_modal(e.user_name,e.user_id,e.email,qn.SUSPENDED,function(e){return D.success(mt("User %(msg)s".format({msg:e})))})})),Bn.decrement_used_licenses(),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb(t,n,a,r,_):void 0},t.prototype.switch_to_removal_mode=function(){return this.set_modal_class()},t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.checkAndApproveMemberRemoval(this.switch_to_removal_mode)},t}(Nn),Fn=tt.ManageFilesModal=function(e){function t(e,n,i){this.source_user_id=e,this.source_user_name=n,this.options=i,this.on_confirm_button_click=Lt(this.on_confirm_button_click,this),this.switch_to_manage_files=Lt(this.switch_to_manage_files,this),this.success_callback=Lt(this.success_callback,this),t.__super__.constructor.call(this,this.options,"input[name=file_action]","#transfer_files_on")}return Nt(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".manage-files-modal")},t.prototype.on_show=function(){var e;return t.__super__.on_show.call(this),this.$modal_window.find("[name='source_user_id']").attr("value",this.source_user_id),this.$modal_window.find(".source-user-name").text(this.source_user_name),e=mt("Manage %(team_member)s's files").format({team_member:this.source_user_name}),this.$modal_window.find(".db-modal-title-text").text(e)},t.prototype.success_callback=function(e){var t;return t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.removed_team_member_table?window.removed_team_member_table.update_user_data(t):null!=__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),ge("#transfer_files_on").prop("checked")?D.success(mt("Transfer started",{comment:"This refers to the start of a file transfer from one Dropbox to another"})):D.success(mt("Permanently deleted files")),this.hide()},t.prototype.switch_to_manage_files=function(){return this.set_modal_class("manage-files-modal")},t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.checkAndApproveMemberRemoval(this.switch_to_manage_files)},t}(Nn),Hn=tt.show_manage_files_modal=function(e,t){var n;return n=new Fn(e,t,{element_id:"manage-files-modal",focus:".new-collab-input"}),n.show()},Pn=tt.RecoverUserModal=function(e){function t(e){this.on_cancel_button_click=Lt(this.on_cancel_button_click,this),this.on_confirm_button_click=Lt(this.on_confirm_button_click,this),this.success_callback=Lt(this.success_callback,this),t.__super__.constructor.call(this,e)}return Nt(t,e),t.prototype.before_show=function(){var e;return t.__super__.before_show.call(this),e=mt("Restore %(user_name)s?").format({user_name:this.user_name}),this.$modal_window.find(".db-modal-title-text").text(e),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.$modal_window.find(".user_name").text(this.user_name),this.$modal_window.find(".user_email").text(this.email),this.pre_removal_join_state===qn.SUSPENDED?(this.$modal_window.find(".recover_content_active_user").remove(),this.$modal_window.find(".recover_content_suspended_user").show()):(this.$modal_window.find(".recover_content_active_user").show(),this.$modal_window.find(".recover_content_suspended_user").remove())},t.prototype.success_callback=function(e){var t;return null!=(t=__CIRCULAR_DEPENDENCY__.MembersReact)&&t.refresh_member_stats(),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb("restored"):void 0},t.prototype.on_confirm_button_click=function(e){var t,n;return e.preventDefault(),n=this.$modal_window.find(".recover-user-modal")[0],t=$(this.$modal_window.find(".confirm-button")[0]),Vt.ajax_submit(n,!1,this.success_callback,!1,t)},t.prototype.on_cancel_button_click=function(e){return e.preventDefault(),Ke.TeamsWebActionsLogger.log("admin_restore_user_attempt_cancelled",{restorable_user_id:this.user_id,team_id:this.team_id}),t.__super__.on_cancel_button_click.call(this,e)},t}(_t),Kn=function(){var e;return e=function(e,t){var n,i;return ge(t).css("display","none"),n=ge(t).closest("#user_generate_liveops_pin"),i=n.find(".user_generate_liveops_pin_value"),i.text(e.pin),ge(t).addClass("liveops_pin_elem_invisible"),n.find(".user_generate_liveops_pin_text").removeClass("liveops_pin_elem_invisible")},Bn.get_pin_with_user_id(null,this,e),!1},ge("#user_generate_liveops_pin_button").click(Kn),zn=function(){return ge("#help_callus_title").hide(),ge("#help_callus_details").show(),!1},ge("#help_callus_trigger").click(zn);var Wn;Wn=tt.UpdateEvents={ADD:"db:add_file_objects",REMOVE:"db:remove_file_objects",MOVE:"db:move_file_objects"};var Vn;Vn=tt.BrowseURL={_DEFAULTS:{d:!1,from_scl_sync_modal:!1,select:!1,open_preview:!1},make_browse_url_from_fq_path:function(e,t,i){var s,o,r,a;null==i&&(i={}),assert("string"==typeof t,"expected explicit fq_path string"),r=u({path:n.get_browse_root(e)+t}),o=b.deconstruct_url().qargs;for(s in i)a=i[s],s in this._DEFAULTS&&!!a!==this._DEFAULTS[s]&&(o[s]=a);for(s in o)s in this._DEFAULTS||delete o[s];return b.construct_url(String(r),o)}};var Jn;Jn=tt.BrowseFile=Class.create({initialize:function(e){}}),Jn._CATEGORIES={IMAGE:"bmp cr2 gif ico jpeg jpg nef png psd tif tiff svg svgz",VIDEO:"3gp 3gpp 3gpp2 avi dv flv m2t m4v mkv mov mp4 mpeg mpg mts ts vob wmv",AUDIO:"aif flac m4a m4p mp3 ogg wav wma",DOCUMENT:"ai cdr csv doc docx docm eps fla indd keynote numbers otf pages pdf ppt pptx pptm pps ppsx ppsm ps rtf swf txt wpd xls xlsx xlsm",COMPRESSED_FILE:"7z bz2 gz gzip rar tar zip",CODE:"as as3 asm aspx bat c cc cmake coffee cpp cs css cxx diff erb erl groovy gry h haml hh hpp hxx java js json jsx less lst m make ml mm out patch php pl plist properties py rb sass scala scm script scss sh sml sql vb vi vim xml xsd xsl yaml yml",DISK_IMAGE:"dmg iso",EXECUTABLE:"exe",SHORTCUT:"lnk",LINK:"url webloc",FONT:"ttf"},Jn.EXTENSION_TO_CATEGORY={},Jn.CATEGORY_TO_TRANSLATION={FILE:mt("file"),FOLDER:mt("folder"),SHARED_FOLDER:mt("shared folder"),TEAM_SHARED_FOLDER:mt("team folder"),PUBLIC_FOLDER:mt("folder"),IMAGE:mt("image"),VIDEO:mt("video"),AUDIO:mt("audio"),DOCUMENT:mt("document"),COMPRESSED_FILE:mt("archive"),CODE:mt("code"),DISK_IMAGE:mt("disk image"),EXECUTABLE:mt("executable"),SHORTCUT:mt("shortcut"),LINK:mt("link"),FONT:mt("font"),SANDBOX:mt("app folder")},Jn.CATEGORY_TO_DELETED_TRANSLATION={FILE:mt("deleted file"),FOLDER:mt("deleted folder"),SHARED_FOLDER:mt("deleted shared folder"),TEAM_SHARED_FOLDER:mt("deleted team folder"),PUBLIC_FOLDER:mt("deleted folder"),IMAGE:mt("deleted image"),VIDEO:mt("deleted video"),AUDIO:mt("deleted audio"),DOCUMENT:mt("deleted document"),COMPRESSED_FILE:mt("deleted archive"),CODE:mt("deleted code"),DISK_IMAGE:mt("deleted disk image"),EXECUTABLE:mt("deleted executable"),SHORTCUT:mt("deleted shortcut"),LINK:mt("deleted link"),FONT:mt("deleted font"),SANDBOX:mt("deleted app folder")},function(){var e,t,n,i,s;i=Jn._CATEGORIES,s=[];for(e in i)n=i[e],s.push(function(){var i,s,o,r;for(o=n.trim().split(" "),r=[],i=0,s=o.length;s>i;i++)t=o[i],r.push(Jn.EXTENSION_TO_CATEGORY[t]=e);return r}());return s}();var Gn;Gn=INLINE_JS.BrowseActions=tt.BrowseActions=Class.create({initialize:function(e){return this._set_files(e)},firefly_logging_helper:function(e){return Xn.in_search_mode()&&e?(this._firefly_log_values.action_type=e,Ke.SearchClientActivityLogger.log("result_action",Xn.active_user.id,this._firefly_log_values)):void 0},unlisten:function(){},get_files:function(){return this._files},_set_files:function(e){var t;return this._files=$A(e),this._log_extras={},this.get_files().length>0?(t=e.first(),this._log_extras={path:t.fq_path,ns_id:t.ns_id},this._firefly_log_values={file_nsid:t.ns_id,file_sjid:t.sjid,firefly:!1,match_type:t.match_type,position:t.sort_rank,request_id:t.request_id,viewport:"full-view"}):void 0}});var Xn;Xn=INLINE_JS.Browse=tt.Browse={KEY_SCOPE:"browse",SCROLL_DURATION:.5,files:[],init:function(e,t,n,i,s,o,r){return this.browse_actions_ctor=t,this.global_actions_ctor=n,this.browse_actions_context_ctor=i,this.global_actions_context_ctor=s,this.ns_id_to_mount_point=o,"number"!=typeof r?void raiseAndReport("a user_id was not passed into Browse.init"):(this.active_user=Z.get_viewer().get_user_by_id(r),__CIRCULAR_DEPENDENCY__.active_user_loaded=!0,void(this.active_user||raiseAndReport("No active_user was found in Browse.init")))},setup:function(e,t){var n;return null==t&&(t=null),this.ns_id_to_mount_point=e.ns_id_to_mount_point,this.compiled_tmpl=Qe.tmpl("list_item_tmpl"),this.render_timeout=null,this.inside_root_folder=""===e.containing_fq_path,this.inside_dir=e.inside_dir,this.inside_deleted_dir=e.inside_deleted_dir,this.inside_shared_folder=e.inside_shared_folder,n="inside_deleted_dir",this.inside_deleted_dir?$("browse").addClassName(n):$("browse").removeClassName(n),this.inside_dir?(this._containing_ns_id=e.containing_ns_id,this._containing_ns_path=e.containing_ns_path,this._containing_fq_path=e.containing_fq_path,this._containing_mount_point=e.containing_mount_point,this._containing_sf_perm_role=e.containing_sf_perm_role):void 0},_get_helper:function(e){return assert(this.inside_dir,"accessed "+e+", but not inside a directory"),Xn[e]},containing_fq_path:function(){return this.inside_dir?this._get_helper("_containing_fq_path"):""},update:function(e,t){return null==t&&(t=null),$("browse-box").show(),this.clear(),"string"==typeof e&&(e=JSON.parse(e)),this.setup(e,t),document.fire(Ee.UPDATE),ge(document).trigger(Ee.UPDATE,[e])},reload_fqpath:function(e,t){return this.reload(null,yt.urlquote(e),t)},force_reload:function(){return this.reload(this.containing_ns_id(),yt.urlquote(this.containing_ns_path()),!0)}};var Qn;Qn=tt.ProgressWatcher={job_info:{},INIT_POLL_INT:1e3,FAILS_MEAN_FAIL:3,MODAL_WAIT_MS:1e3,watch:function(e,t){var n,i,s;if(e.async_task_id){if(!e.async_task_id.match(/^[A-Za-z0-9_\-=]*$/))return;i=e.async_task_id}else i=e.job_id;return Qn.job_info[i]={},n=Qn.job_info[i],n.subject_user=e.subject_user||(null!=(s=e.parameters)?s[M.UID_PARAM_NAME]:void 0),n.req=e,n.is_async_task=!!e.async_task_id,n.poll_int=Qn.INIT_POLL_INT,n.poll_count=0,n.int_id=setInterval(Qn.update_for(i),n.poll_int),n.failures=0,n.start_time=le.time(),
n.dont_hide=t},update_for:function(e){return function(){return Qn.update(e)}},backoff:function(e){var t;return t=Qn.job_info[e],clearInterval(t.int_id),t.poll_int=Math.min(Math.floor(1.5*t.poll_int),3e4),t.int_id=setInterval(Qn.update_for(e),t.poll_int)},update:function(e){var t,n;return n=Qn.job_info[e],ot.peek(e)?Qn.done(e):(n.poll_count++,n.poll_count%10===0&&Qn.backoff(e),!n.modaled&&le.time()-n.start_time>Qn.MODAL_WAIT_MS&&(t=n.req.options,rt.show(t.progress_text),t.onProgress=rt.update,null!=t.on_modal_shown&&t.on_modal_shown(),n.modaled=!0),n.is_async_task?Qn.get_async_task_status(e):Qn.get_job_status(e))},get_job_status:function(e){return new Ajax.DBRequest("/job_status/"+e,{method:"post",subject_user:Qn.job_info[e].subject_user,onSuccess:function(t){var n,i;if(n=Qn.job_info[e],i=t.responseText,0===i.indexOf("err"))return Qn.done(e),void(n.req.options.onFailure&&!ot.handled(e)&&n.req.options.onFailure(t));if(0===i.indexOf("done"))return n.req.options.job=!1,ot.peek(e)||new Ajax.Request("/job_results/"+e,{method:"post",parameters:{t:Oe.read(Ae.JS_CSRF_COOKIE)},onSuccess:function(t){return ot.handled(e)?void 0:(Et.clearWorkingMessage(),n.req.options.onSuccess?n.req.options.onSuccess(t):void 0)},onFailure:function(t){return ot.handled(e)?void 0:(Et.clearWorkingMessage(),n.req.options.onFailure?n.req.options.onFailure(t):void 0)}}),Qn.done(e);try{if(n.req.options.onProgress)return n.req.options.onProgress(t.responseText)}catch(e){}},onFailure:function(t){var n;return n=Qn.job_info[e],n.failures++,n.failures>=Qn.FAILS_MEAN_FAIL?(n.req.options.onFailure&&n.req.options.onFailure(t,!0),Et.remove(n.req),Qn.done(e)):void 0}})},get_async_task_status:function(e){return new Ajax.DBRequest("/async_task_status/"+e,{method:"post",subject_user:Qn.job_info[e].subject_user,onSuccess:function(t){var n,i;if(n=Qn.job_info[e],i=t.responseText,0===i.indexOf("done:")||0===i.indexOf("err:"))return ot.handled(e),Et.clearWorkingMessage(),0===i.indexOf("done:")&&(t.responseText=i.substr(5)),n.req.options.onSuccess&&n.req.options.onSuccess(t),n.req.options.onComplete&&n.req.options.onComplete(t),Qn.done(e);if(0===i.indexOf("async_task_err:"))return D.error(new Qe(i.substr(15))),ot.handled(e),Et.clearWorkingMessage(),Qn.done(e),Xn.force_reload();try{if(n.req.options.onProgress)return n.req.options.onProgress(t.responseText)}catch(e){}},onFailure:function(t){var n;if(n=Qn.job_info[e],n.failures++,n.failures>=Qn.FAILS_MEAN_FAIL){try{n.req.options.onFailure&&n.req.options.onFailure(t,!0)}catch(e){}return Et.remove(n.req),Qn.done(e)}}})},done:function(e){var t;return t=Qn.job_info[e],clearInterval(t.int_id),t.dont_hide?rt.update("1/1"):(delete Qn.job_info[e],t.req.async_task_id&&t.req.async_task_id!==e?void 0:rt.hide(e))}};var Zn,ei,ti,Ft=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};ti=tt.NamespaceEvents=function(){function e(e){this.ns_id=e,this.earliest=Number.MAX_VALUE,this.events=[],this.seen={},this.done=!1}return e}(),Zn=tt.EventDatePicker=function(){function e(e){var t,n,i;this.on_change=e,ge(document.body).on("click",function(e){return function(t){return e.hide_calendar(t)}}(this)),i=new Element("div",{id:"cal_container"}),ge(i).bind("click",function(e){return e.preventDefault()}),ge(document.body).append(i),this.calendar=new _n("cal_container",{onDateChange:function(e){return function(t){return e.on_change(t)}}(this),disable_future:!0}),ge(i).css("position","fixed"),n=ge("#cal_date"),t=ge("#cal_container"),Ne.clone_position(t,n,{setWidth:!1,setHeight:!1,offsetTop:n.height(),offsetLeft:n.width()-t.children().first()[0].offsetWidth}),this.hide_calendar()}return e.prototype.show_calendar=function(e){return this.shown?(ge("#cal_container").hide(),void(this.shown=!1)):(ge("#cal_container").show(),this.shown=!0)},e.prototype.hide_calendar=function(e){return e&&ge(e.target).closest("#cal_date").length>0?void 0:(ge("#cal_container").hide(),this.shown=!1,!0)},e}(),ei=INLINE_JS.Events=tt.Events={ns:null,role:"all",now:Number(new Date),timestamp:yt.start_of_day(new Date(Number(new Date)+864e5)),request_in_flight:!1,one_day:864e5,user_navigated_away:!1,init:function(e,t,n,i,s){var o,r,a;return null==s&&(s=!1),this.awaitingFirstRender=!0,a=b.deconstruct_url(),this.first_event_map=e,this.roles=t,this.rss_data=n,this.role_has_events=i,this.deletions_only=s,this.role_picker=ee.get_controller(ge("#role-selector")),1===this.roles.length?this.role=this.roles[0].role:a.qargs.role?(this.role=a.qargs.role,this.role_picker.set_state(this.role)):this.deletions_only&&(this.role=this.roles[this.roles.length-1].role),this.date_picker=new Zn(function(e){return function(t){return e.change_date(t),e.set_url(),Ke.WebMiscActivityLogger.log("filter_events_date")}}(this)),this._init_state(),this.role_picker.on_state_change=function(e){return function(){return e.role=e.role_picker.get_state(),e.ns&&!e.valid_roles().some(function(t){return t.ns_ids.contains(e.ns.ns_id)})&&(e.ns=null,an.set_selected_by_value(ge("#namespace-list")[0],"false")),e.set_url(),e.get_more(!0)}}(this),_e.set_during_login_callback(function(e){return function(e,t){return window.location.reload()}}(this)),ge(window).bind("beforeunload",function(e){return function(){e.user_navigated_away=!0}}(this)),ge("#namespace-list-container")[0]&&ge("#namespace-list-container")[0].observe("db:change",function(e){return function(t){return e.ns=e.namespaces[JSON.parse(t.memo)],e.set_url(),e.get_more(!0),Ke.WebMiscActivityLogger.log("filter_events_shared_folder")}}(this)),ge(window).on("scroll",function(e){return function(){return document.body.scrollTop=Math.min(document.body.scrollTop,document.body.scrollHeight-Ne.viewport_dimensions().height-10),e.get_more()}}(this)),a.qargs.ns&&(an.set_selected_by_value(ge("#namespace-list")[0],a.qargs.ns),this.ns=this.namespaces[a.qargs.ns]),a.qargs.date&&(r=a.qargs.date.split("-").map(Number),o=new Date(r[2],r[1]-1,r[0]),this.date_picker.calendar.selected_date=o,this.change_date(o)),this.update_calendar_first_day(),ge("#reset-rss-link").on("click",function(e){return function(t){var i;return n=e.rss_data[null!=(i=e.ns)?i.ns_id:void 0]||e.rss_data[e.role],new Ajax.DBRequest("/reset_rss",{parameters:{ns_id:n.ns_id},onSuccess:function(){return D.success(mt("RSS feed url successfully reset.")),Ve.redirect("/events")}}),!1}}(this)),this.get_more()},_init_state:function(){var e,t,n,i,s,o,r,a;for(this.namespaces={},o=y(this.roles).values(),e=0,n=o.length;n>e;e++)for(a=o[e],r=a.ns_ids,t=0,i=r.length;i>t;t++)s=r[t],this.namespaces[s]=new ti(s);return this.ns?this.ns=this.namespaces[this.ns.ns_id]:void 0},change_date:function(e){return this.timestamp=Number(e)+this.one_day,(this.timestamp<this.earliest()||this.timestamp>this.latest)&&(this.latest=this.timestamp,this._init_state()),ge("#cur_date_text").text(ni.localize(e)),this.get_more(!0)},is_scrolled_down:function(){var e,t,n;return n=Ne.scroll_offsets().top,t=Ne.viewport_dimensions().height,e=ge("#events").height(),n+t+50>=e},get_more:function(e){var t,n,i;if(!this.request_in_flight)return y(this.valid_nss()).all(function(e){return e.done})?void this.render():e||this.is_scrolled_down()?(this.request_in_flight=!0,this.render(),n=function(e){return function(){return y(e.valid_nss()).map(function(e){return e.ns_id}).join(",")}}(this),t=Math.min(this.earliest(),this.timestamp/1e3,Math.floor(this.now/1e3)),i={page_size:25,ns_ids:n(),timestamp:t},this.deletions_only&&(i.deletions_only=!0),new Ajax.DBRequest("/events/ajax",{method:"POST",parameters:i,onSuccess:function(e){return function(t){var i,s,o,r,a,_,l,u,c,d,h,m,p,f;for(i=JSON.parse(t.responseText),e.request_in_flight=!1,m=i.events,o=0,_=m.length;_>o;o++)s=m[o],s.html=ge(s.html)[0],h=s.pkey+" "+(s.html.textContent||s.html.innerText),c=e.namespaces[s.ns_id],c.seen[h]||(c.events.push(s),c.seen[h]=!0,c.earliest=s.timestamp);if(i.events.length>0)for(p=i.ns_ids,r=0,l=p.length;l>r;r++)d=p[r],e.namespaces[d].earliest=y(i.events).map(function(e){return e.timestamp}).min();if(e.render(),i.events.last())e.get_more();else if(y(i.ns_ids).join(",")!==n())e.get_more();else for(f=i.ns_ids,a=0,u=f.length;u>a;a++)d=f[a],e.namespaces[d].done=!0;return P.configureAllLinks("#event-table",".inline-restore","events")}}(this),onError:function(e){return function(){return e.request_in_flight=!1,e.user_navigated_away?void 0:D.error(mt("We had problems loading your events feed; please try again later."))}}(this)})):void this.render()},valid_roles:function(){return"all"!==this.role?y(this.roles).filter(function(e){return function(t){return t.role===e.role}}(this)):this.roles},valid_nss:function(){return this.ns?[this.ns]:y(this.valid_roles()).map(function(e){return function(e){return e.ns_ids}}(this)).flatten().map(function(e){return function(t){return e.namespaces[t]}}(this)).uniq()},earliest:function(){return y(this.valid_nss()).map(function(e){return function(e){return e.earliest}}(this)).max()},latest:Number.MAX_VALUE,update_calendar_first_day:function(){return this.date_picker.calendar.options.first_day=yt.start_of_day(new Date(y(this.valid_nss()).map(function(e){return function(t){return e.first_event_map[t.ns_id]}}(this)).min())),this.date_picker.calendar.selected_date<this.date_picker.calendar.options.first_day&&(this.date_picker.calendar.selected_date=yt.start_of_day(new Date(Number(this.date_picker.calendar.options.first_day)+this.one_day)),this.change_date(this.date_picker.calendar.selected_date)),this.date_picker.calendar.render()},set_url:function(){var e,t,n,i;return n=new Date(this.timestamp-this.one_day),t=this.now-this.timestamp>0,e={},this.ns&&(e.ns=this.ns.ns_id),"all"!==this.role&&(e.role=this.role),t&&(e.date=n.getDate()+"-"+(n.getMonth()+1)+"-"+n.getFullYear()),i=this.deletions_only?"/deleted_files":"/events",b.push_state(i,e)},render:function(){var e,t,n,i,s,o,r,a,_,l,u,c,d,h,m,p,f,v,g,w,b,k,x;if(this.role_has_events[this.role]&&this.update_calendar_first_day(),e=y(this.valid_nss()).map(function(e){return function(e){return e.events}}(this)).flatten(),t=this.earliest(),b=y(e).sortBy(function(e){return-e.timestamp}),s=y(b).filter(function(e){return function(n){return n.timestamp>=t&&n.timestamp<e.timestamp/1e3&&(null!==e.ns||!n.is_dup)}}(this)),this.role_has_events[this.role]){for(ge("#event-table").empty(),o=0,_=s.length;_>o;o++)p=s[o],n=ge(p.html),f=y(this.valid_roles()).filter(function(e){return function(e){return e.ns_ids.contains(p.ns_id)}}(this)).map(function(e){return function(e){return e.name}}(this)).join(" & "),this.deletions_only?n.find("span.role-path").text(f):n.find("span.role-label > span").text(f),ge("#event-table").append(n),null!=p.preview_jsinfo&&(i=p.preview_jsinfo,w=n.find(".inline-button"),w.on("click",this._inline_share_button.bind(this,i)));ge("#events-container").show(),ge("#events-sub-header").show(),ge("#events-sub-header").css("visibility","visible"),ge("#events-empty-state").hide(),ge(".empty-explanation").hide()}else this.request_in_flight||(ge("#events-container").hide(),ge("#events-sub-header").hide(),ge("#events-empty-state").show(),ge(".empty-explanation").show());for(this.request_in_flight?ge("#more-loading").show():(this.awaitingFirstRender&&(this.awaitingFirstRender=!1,Ke.WebMiscActivityLogger.log("events-first-load",{time:Number(new Date)-this.now})),ge("#more-loading").hide()),ge("#more-loading").css("marginTop",this.earliest()===Number.MAX_VALUE?"140px":"20px"),u=ge("#namespace-list > li"),a=0,l=u.length;l>a;a++)r=u[a],k=ge(r).data("value"),m=Ft.call(y(this.valid_roles()).map(function(e){return e.ns_ids}).flatten(),k)>=0,h=k===!1,x=h||m,ge(r).css("display",x?"":"none");return g=Ft.call(function(){var e,t,n,i;for(n=this.valid_roles(),i=[],e=0,t=n.length;t>e;e++)d=n[e],i.push(d.ns_ids.length>1);return i}.call(this),!0)>=0,this.request_in_flight?void 0:(g?(ge("#namespace-list-container").css("visibility","visible"),ge("#namespace-list-container").show()):ge("#namespace-list-container").hide(),v=this.rss_data[null!=(c=this.ns)?c.ns_id:void 0]||this.rss_data[this.role],v&&this.role_has_events[this.role]?(ge("#rss-feed a").attr("data-title",v.title),ge("#rss_url").val(v.url),ge("#rss_url").focus(),ge("#rss-feed").show(),ge("#rss-feed").css("visibility","visible")):ge("#rss-feed").hide())},show_rss_modal:function(){var e,t;return en.show(mt("Subscribe to this RSS feed"),ge("#rss-modal")[0]),t=ge("#rss_url").val(),e=Me.clipboard_overlay(t,ge("#real_copy"),function(){return D.success(mt("Link copied to clipboard!")),en.hide()},ge(".modal-buttons")),e.css({zIndex:1001})},_inline_share_button:function(e,t){return t.preventDefault(),it(e.user_id,{fqPath:e.fq_path,isFolder:e.is_dir,nsId:e.ns_id,targetNsId:e.target_ns})}};var ni;ni=tt.DateUtil={fromSecondsSinceEpochUTC:function(e){var t;return t=new Date(1970,0,1),t.setSeconds(e),t},applyTimezoneOffset:function(e,t){var n,i;return n=parseInt(t,10),i=60*(t-n),e.setHours(e.getHours()+n),e.setMinutes(e.getMinutes()+i)},contextualFormat:function(e){var t,n,i,s,o;return i=new Date(Date.now()),s=(i.getTime()-e.getTime())/1e3,t=0,28800>s?le.ago(e):(this.applyTimezoneOffset(i,M.TIMEZONE_OFFSET),this.applyTimezoneOffset(e,M.TIMEZONE_OFFSET),o=new Date(Date.now()),this.applyTimezoneOffset(o,M.TIMEZONE_OFFSET),o.setDate(o.getDate()-1),e.getYear()===i.getYear()&&e.getMonth()===i.getMonth()&&e.getDate()===i.getDate()?(n=mt("Today %(time)s"),n.format({time:ni.format(e,M.time_format)})):e.getYear()===o.getYear()&&e.getMonth()===o.getMonth()&&e.getDate()===o.getDate()?(n=mt("Yesterday %(time)s"),n.format({time:ni.format(e,M.time_format)})):ni.format(e,M.datetime_format))},toUTCDate:function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())},differenceStr:function(e,t){var n,i,s,o,r,a,_;return r=(e.getTime()-t.getTime())/1e3,60>r?ht("%d sec","%d secs",r).format(r):3600>r?(s=parseInt(r/60,10),ht("%d min","%d mins",s).format(s)):86400>r?(i=parseInt(r/3600,10),ht("%d hour","%d hours",i).format(i)):2592e3>r?(n=parseInt(r/86400,10),ht("%d day","%d days",n).format(n)):4838400>r?(a=parseInt(r/604800,10),ht("%d week","%d weeks",a).format(a)):31536e3>r?(o=parseInt(r/2592e3,10),ht("%d month","%d months",o).format(o)):(_=parseInt(r/31536e3,10),ht("%d year","%d years",_).format(_))},localize:function(e){return assert(null!=M.date_format,"Date format missing."),ni.format(e,M.date_format)},format:function(e,t){var n;return assert("string"==typeof t,"Date format requires a format string"),n={yy:function(t){return function(){return e.getFullYear().toString().substring(2)}}(this),yyyy:function(t){return function(){return e.getFullYear().toString()}}(this),M:function(t){return function(){return(e.getMonth()+1).toString()}}(this),MM:function(t){return function(){return(e.getMonth()+1).toString().lpad(2)}}(this),d:function(t){return function(){return e.getDate().toString()}}(this),dd:function(t){return function(){return e.getDate().toString().lpad(2)}}(this),h:function(t){return function(){return(e.getHours()%12||12).toString()}}(this),H:function(t){return function(){return e.getHours().toString()}}(this),HH:function(t){return function(){return e.getHours().toString().lpad(2)}}(this),m:function(t){return function(){return e.getMinutes().toString()}}(this),mm:function(t){return function(){return e.getMinutes().toString().lpad(2)}}(this),a:function(t){return function(){return e.getHours()>11?mt("PM",{comment:"PM as in evening"}):mt("AM",{comment:"AM as in morning"})}}(this)},t.replace(/([a-zA-Z]+)/g,function(e){return null!=n[e]?n[e]():e})}};var ii;ii=INLINE_JS.Timezone=tt.Timezone={check_timezone:function(){var e;if(Z.get_viewer().is_signed_in)return e=ii.get_current_timezone(),null==M.auto_timezone_offset||M.auto_timezone_offset!==e?ii.update(e):void 0},get_current_timezone:function(){var e,t,n,i;return t=new Date,t.setSeconds(0),t.setMilliseconds(0),i=t.toGMTString(),e=new Date(i.substring(0,i.lastIndexOf(" "))),n=(t-e)/36e5},update:function(e){return assert("number"==typeof e,"Timezone offset was not a number: "+e),new Ajax.DBRequest("/set_timezone",{parameters:{offset:e},noAutonotify:!0})},update_timezones_dropdown:function(e,t){var n,i;return null==t&&(t=null),i=ii.timezones_by_country[e],ge("#timezone_id").empty(),ge("#timezone_id").append(function(){var e,s,o;for(o=[],e=0,s=i.length;s>e;e++)n=i[e],o.push(ge('<option value="'+n.id+'">'+n.name+"</option>").prop("selected",n.id===t));return o}())},auto:function(){var e;return e=$F("timezone_auto"),e?ge("#tz").hide():(ii.default_country&&(ge("#timezone_country").val(ii.default_country),ii.update_timezones_dropdown(ii.default_country)),ge("#tz").show())},load_data:function(e,t){return ii.timezones_by_country=e,ii.default_country=t}};var si,oi;oi=tt.CreateApp={init:function(e,t){var n,i,s;return this.accepted_tos_by_uid=e,this.form=n=ge("#create-app-form"),this.email_verification=null,Z.get_viewer().is_paired||(s=Z.get_viewer().get_users()[0],this.select_user(s.id)),i=function(e){return function(e){var t;return t=e.target.name,n.find("input[name="+t+"]").each(function(){return ge(this).parents("label").removeClass("active"),n.removeClass(ge(this).data("next"))})}}(this),n.find("input[type=radio]").change(function(e){return i(e),ge(e.target).parents("label").addClass("active"),n.addClass(ge(this).data("next"))}),n.find("input[type=checkbox]").change(function(e){var t;ge(this).filter("#accept-tos").length||(ge(e.target).parents("label").toggleClass("active"),t=n.find("input[name="+ge(this).attr("name")+"]:checked"),n.toggleClass(ge(this).data("next"),0!==t.length))}),n.find(".role-choice input").change(function(e){return function(t){var s,o;return s=n.find(".role-choice input:checked"),o=s.val(),Z.get_viewer().is_uid_signed_in(o)?e.select_user(o):(s.prop("checked",!1),i(t),_e.show_modal({user_id:o,on_success:function(){return s.prop("checked",!0).trigger("change")}}),!1)}}(this)),n.find("input:checked").trigger("change"),n.find("input[name=tos_accept]").change(function(e){return function(t){return e.update_submit_enabled()}}(this)),n.find("#send-verify-email, #resend-verify-email").click(function(e){return function(i){return e.email_verification.send_email(t,function(){return n.addClass("verify-email-sent"),e.email_verification.flash_email_sent_notification(),e.email_verification.ensure_polling(function(){return e.email_verification.user.is_email_verified?(n.addClass("email-verified"),n.removeClass("verifiy-email-sent"),n.removeClass("email-unverified"),e.update_submit_enabled()):void 0})}),!1}}(this)),n.submit(function(e){return n=ge(e.target),Vt.ajax_submit(n[0],!1,function(e){return window.location.href=e.responseText}),!1})},select_user:function(e){return this.email_verification=at.get_for_user(Z.get_viewer().get_user_by_id(e)),this.form.find("#accept-tos-wrapper").toggle(!this.accepted_tos_by_uid[e]),this.form.find("input[name=tos_accept]").prop("checked",!1),this.form.removeClass("verify-email-sent"),this.form.find("#verify-email-wrapper").toggle(!this.email_verification.user.is_email_verified),this.form.toggleClass("email-verified",this.email_verification.user.is_email_verified),this.update_submit_enabled()},update_submit_enabled:function(){var e,t;return t=this.email_verification.user,e=this.accepted_tos_by_uid[t.id]||this.form.find("input[name=tos_accept]").prop("checked"),this.form.find("#create-button").prop("disabled",!e)}},si=INLINE_JS.Apps=tt.Apps={init_apps:function(){return ge("#show-disabled-apps").click(function(){return ge(this).parent().hide(),ge("#disabled-apps").show(),!1})},init_app_info:function(e,t,n){return this.user_email=n,ge("#app-info .icon-container").each(function(e,t){var n;return n=ge(t),n.append(Dropbox.createChooseButton({success:function(e){return n.find(".icon").attr("src",e[0].thumbnailLink),n.find("input[type=hidden]").val(e[0].link)},linkType:"direct",extensions:["images"]}))}),this._hoverable_tmpl=Qe.tmpl("hoverable_tmpl"),ge(".modal-okay-triggers-refresh").on("click",function(e){location.reload()}),ge("#unlink-users-button").on("click",function(t){si.unlink_all_users_in_dev(e)}),ge("#enable-additional-users-button").on("click",function(t){si.enable_users_in_dev(e)}),ge("#increase-max-users-button").on("click",function(t){si.enable_users_in_dev(e)}),ge("#unlink-teams-button").on("click",function(t){si.unlink_all_teams_in_dev(e)}),ge("#enable-additional-teams-button").on("click",function(t){si.enable_teams_in_dev(e)}),this._webhook_info_row_tmpl=Qe.tmpl("webhook_info_row_tmpl"),ge("#domain-list").on("click",".img-container",function(t){si.remove_domain(t.currentTarget.parentNode,e)}),ge("#oauth-uri-list").on("click",".img-container",function(t){si.remove_oauth_uri(t.currentTarget.parentNode,e)}),ge("#webhook-list").on("click",".img-container",function(t){si.remove_webhook(t.currentTarget.parentNode,e)}),ge("#webhook-list").on("click",".webhook-actions.enabled .webhook_disable",function(t){si.update_webhook_url(t.currentTarget,e,!1)}),ge("#webhook-list").on("click",".webhook-actions.disabled .webhook_enable",function(t){si.update_webhook_url(t.currentTarget,e,!0)}),ge("#delete-app-button").on("click",function(n){si.confirm_disable(t,e,0)}),ge("#webhook_url").on("click change paste focus",function(e){ge("#webhook-form").removeClass("error")}),this.init_app_info_add_redirect_uri(),ge("#oauth2-allow-implicit-grant").on("change",function(t){return si.set_oauth2_allow_implicit_grant(t.currentTarget,e)})},init_app_info_add_redirect_uri:function(){var e,t,n,i;t=/^\#?add_redirect_uri=(.*)$/.exec(window.location.hash||""),t&&(i=window.decodeURIComponent(t[1]),e=ge("#oauth-add-uri-form"),ge("input[name=oauth_uri]",e).val(i),n=ge("#add-redirect-uri-modal")[0],ge("#add-redirect-uri-modal-uri").text(i),en.show(mt("Add OAuth redirect URI"),n,{doit:function(){var e;return window.history&&window.history.replaceState?(e=window.location.href,e=e.substring(0,e.indexOf("#")),window.history.replaceState({},document.title,e)):window.location.hash="",en.hide(),si.submit_new_oauth_uri(ge("#oauth-add-uri-form")[0])}}))},init_app_datastores_browse:function(e){return this.ds_info=e,Z.get_viewer().is_paired?(this.role_picker=ee.get_controller(ge("#role-selector")),this.role_picker.on_state_change=this.app_datastores_browse_render.bind(this),_e.set_during_login_callback(function(e){return function(t,n){return e.app_datastores_browse_reload_info(function(){return n()},function(){return n("Error displaying datastores"),window.location.reload()})}}(this))):void 0},app_datastores_browse_reload_info:function(e,t){return ge.ajax({url:"/developers/apps/datastores/info",success:function(t){return function(n){return t.ds_info=n,t.app_datastores_browse_render(),"function"==typeof e?e():void 0}}(this),error:function(e){return function(e){return"function"==typeof t?t(e):void 0}}(this)}),!1},app_datastores_browse_render:function(){return this.app_datastores_browse_render_id("#apps_developed_container"),this.app_datastores_browse_render_id("#apps_used_container"),this.app_datastores_browse_render_empty()},app_datastores_browse_render_empty:function(){var e,t,n,i;if(t=ge("#no_apps_container").empty(),0===ge("#apps_developed_container").children().length&&0===ge("#apps_used_container").children().length)switch(e=ge("<div class='empty-state'></div>").appendTo(t),null!=(n=this.role_picker)?n.get_state():void 0){case nt.PERSONAL:case nt.WORK:return i=Z.get_viewer().get_user_by_role(this.role_picker.get_state()),e.append("You don't have any datastores in your "+Z.get_role_title(i)+" Dropbox.");default:return e.append("You don't have any datastores in your Dropbox.")}},app_datastores_browse_render_id:function(e){var t,n,i,s,o,r,a;for(s=this.app_datastores_browse_get_id_info(e),n=ge(e),n.empty(),t="",o=0,r=s.length;r>o;o++)i=s[o],this.app_datastores_should_render(i.uid)&&(t+=i.html);return t?(n.append(this.app_datastores_browse_get_id_header(e)),a=ge("<div class='app-list clearfix'/>").appendTo(n),a.html(t)):void 0},app_datastores_should_render:function(e){var t;return null!=this.role_picker?(t=Z.get_viewer().get_user_by_id(e),this.role_picker.is_role_visible(t.role)):!0},app_datastores_browse_get_id_info:function(e){switch(e){case"#apps_developed_container":return this.ds_info.apps_developed;case"#apps_used_container":return this.ds_info.apps_used;default:return assert(!1,"invalid ds group id")}},app_datastores_browse_get_id_header:function(e){switch(e){case"#apps_developed_container":return ge("<h2>Apps you develop</h2>");case"#apps_used_container":return ge("<h2>Apps you use</h2>");default:return assert(!1,"invalid ds group id")}},confirm_disable:function(e,t,n){var i,s;return i=mt(n?"Are you sure you want to disable '%(app_name)s'?":"Are you sure you want to delete '%(app_name)s'?"),xt.fillVal(i.format({app_name:e.escapeHTML()}),"app-disable-text"),en.show(mt(n?"Confirm disable":"Confirm delete"),$("app-disable-modal")),s="/developers/disable_app/"+t,$("app-disable-modal").down("form").action=s,$("disable-app-button").setValue(mt(n?"Disable":"Delete"))},enable_app:function(e){var t;return t="/developers/enable_app/"+e,ge("#status-button-form").attr("action",t).submit()},show_uninstall:function(e,t,n,i,s,o){var r;if(e&&Event.stop(e),en.vars={app_id:n,user_id:o},r=ge("#delete-"+i+"-app-confirm"),"sandbox"===i){if(!s)return void si.do_uninstall();ge(".app_folder",r).text(s)}return ge(".app_name",r).text(t),en.show(mt("Remove %(app_name)s?").format({app_name:h.em_snippet(t,22)}),r[0],en.vars),null},do_uninstall:function(){var e;return e=en.vars.user_id,new Ajax.DBRequest("/api/uninstall_app",{parameters:{app_id:en.vars.app_id,keep_sandbox_files:$F("keep_sandbox_files")},onSuccess:function(t){var n;return D.success(t.responseText),n=ge(".apps-"+e),ge("#inst-app-"+en.vars.app_id+"-row",n).hide().removeClass("active_app"),0===ge(".active_app",n).length&&n.hide(),0===ge(".active_app").length?(ge("#empty-explanation").text(mt("You have no apps linked to your Dropbox.")),ge("#applications-explanation",n).remove()):void 0},subject_user:e}),en.hide()},enable_users_in_dev:function(e,t){return new Ajax.DBRequest("/developers/enable_users_in_dev/"+e,{onSuccess:function(e){var t;return"ok"===e.responseText?en.show(mt("User limit increased"),$("increased-dev-user-limit-modal")):(t=JSON.parse(e.responseText),en.show(mt("Limit raised to %(user_limit)s users").format({user_limit:t.new_limit}),$("increased-dev-user-limit-modal")))}}),!1},unlink_all_users_in_dev:function(e){return en.show(mt("Unlink all users"),$("confirm-unlink-all-users"),{doit:function(){return new Ajax.DBRequest("/developers/unlink_all_users/"+e,{onSuccess:function(e){return en.hide(),location.reload()}})}}),!1},enable_teams_in_dev:function(e){return E.WebRequest({url:"/developers/enable_teams_in_dev/"+e,success:function(e){var t;return t=JSON.parse(e),en.show(mt("Limit raised to %(team_limit)s teams").format({team_limit:t.new_limit}),$("increased-dev-team-limit-modal"))}}),!1},unlink_all_teams_in_dev:function(e){return en.show(mt("Unlink all teams"),$("confirm-unlink-all-teams"),{doit:function(){return E.WebRequest({url:"/developers/unlink_all_teams/"+e,success:function(e){return en.hide(),location.reload()}})}}),!1},submit_restore_sandbox:function(e){var t;return t=$("restore-sandbox-form"),Vt.ajax_submit(t,!1,function(e){return en.hide(),D.success(mt("Restored app folder")),e.responseText.length?Xn.reload_fqpath(e.responseText):Xn.reload("","",!0)},!1,e.target),!1},submit_app_info:function(e){var t;return t=ge(e).find("input[name=name]").val(),Vt.clear_errors(e),Vt.ajax_submit(e,!1,function(){return D.success("App info updated."),t&&ge("#app-info h1").text(t),location.reload()})},submit_folder_name:function(e){var t;return t=ge(e).find("input[name=folder]").val(),Vt.clear_errors(e),Vt.ajax_submit(e,!1,function(){return D.success("App folder name updated."),ge("#folder-name .text").text(t),si.hide_folder_input()})},submit_new_webhook:function(e){var t,n,i,s,o,r,a,_,l,c,d,h;return n=ge(e),o=ge("#webhook-list"),s=ge("<img>").attr({src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:mt("Loading")}).css("vertical-align","middle"),i=n.find("input[name=webhook_url]"),d=function(e,t){return t&&t.remove(),0===o.find(".hoverable-url").length&&o.addClass("hide-status"),ge("#webhook-form-error").text(e),ge("#webhook-form").addClass("error")},a=i.val(),""===a?void d("Empty URI"):(_=u.parse(a),"http"!==(l=_.scheme)&&"https"!==l?void d("URI scheme must be http or https"):_.authority?"localhost"===(c=_.authority)||"127.0.0.1"===c||0===_.authority.indexOf("[::1]")?void d("Webhooks doesn't support localhost as Dropbox can't contact your local server. Please use an internet accessible URI."):o.find("tbody").length>=v.MAX_WEBHOOKS_PER_APP?void d("You can register a maximum of %d webhook URIs per app.".format(v.MAX_WEBHOOKS_PER_APP)):(t=ge(this._webhook_info_row_tmpl({url:a,status:"Verifying"}).toHTML()),t.find(".status").append(s),t.find(".webhook-actions").removeClass("disabled").addClass("enabled"),o.append(t),o.removeClass("hide-status"),ge("#webhook-form").removeClass("error"),r=Vt.collect_form_vars(e),i.val(""),h=(new Date).getTime(),E.WebRequest({url:"/developers/apps/update/add_webhook",dataType:"json",data:r,success:function(e){var n,s;return"invalid"===e.status?(d(e.failure_text,t),i.val(a)):(s=(new Date).getTime()-h,n=Math.max(0,1e3-s),setTimeout(function(){return"ok"===e.status?t.find(".status").text("Enabled"):"error"===e.status?(t.find("textarea").text(e.failure_text),t.find(".status").text(e.status_text).addClass("error"),t.find(".timestamp").text("Just now"),t.find(".webhook-failure-info").css("display","")):void 0},n))},error:function(){return t.remove(),i.val(a)}})):void d("Improperly formatted URI (typo maybe?)"))},remove_webhook:function(e,t){var n,i;return ge("#webhook-form").removeClass("error"),i=ge(e).find(".value").text(),n=ge("<img>").attr({src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:mt("Loading")}).css("vertical-align","middle"),ge(e).find(".status").text("Removing").removeClass("error").append(n),E.WebRequest({url:"/developers/apps/update/remove_webhook",data:{app_id:t,webhook_url:i},dataType:"json",success:function(t){var n,s;return n=e.parentNode,s=n.parentNode,s.removeChild(n),0===s.getElementsByClassName("hoverable-url").length&&ge(s).addClass("hide-status"),ge("#webhook_url").val()?void 0:ge("#webhook_url").val(i)},error:function(){return D.error("Unable to complete your request.")}})},update_webhook_url:function(e,t,n){var i,s,o,r,a;return a=ge(e.parentNode.parentNode).find(".value").text(),ge("#webhook-form").removeClass("error"),o=e.parentNode.parentNode.parentNode,i=ge("<img>").attr({src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:mt("Loading")}).css("vertical-align","middle"),s=ge(o).find(".status").text(),n="Disabled"===s,r=n?"Enabling":"Disabling",ge(o).find(".status").text(r).removeClass("error").append(i),E.WebRequest({url:"/developers/apps/update/update_webhook_url",data:{app_id:t,webhook_url:a,enable:n},dataType:"json",success:function(e){var t;return s=ge(o).find(".status").text(),t="Disabling"===s?"Disabled":"Enabled",ge(o).find(".status").text(t).removeClass("error").removeClass("img"),"Disabling"===s?ge(o).find(".webhook-actions").removeClass("enabled").addClass("disabled"):ge(o).find(".webhook-actions").removeClass("disabled").addClass("enabled")},error:function(e){return D.error("Unable to complete your request.")}})},set_oauth2_allow_implicit_grant:function(e,t){return E.WebRequest({url:"/developers/apps/update/oauth2_allow_implicit_grant",data:{app_id:t,allow:ge(e).val()},dataType:"json",success:function(e){return D.success("OAuth 2 allow implicit grant updated.")},error:function(){return D.error("Error updating OAuth 2 allow implicit grant.")}})},submit_new_oauth_uri:function(e){var t;return t=ge(e).find("input[name=oauth_uri]").val(),Vt.clear_errors(e),Vt.ajax_submit(e,!1,function(){return D.success("OAuth URI added."),si.add_oauth_uri(t),ge(e).find("input[name=oauth_uri]").val("")})},add_oauth_uri:function(e){var t;return t=ge("#oauth-uri-list"),
t.append(this._hoverable_tmpl({value:e}).toHTML()),t.show()},remove_oauth_uri:function(e,t){var n,i;return i=ge(e).find(".value").text(),n=function(t){var n;return D.success("OAuth URI removed."),n=e.parentNode,n.removeChild(e),0===n.getElementsByTagName("div").length?n.hide():void 0},E.WebRequest({url:"/developers/apps/update/remove_oauth_uri",data:{app_id:t,oauth_uri:i},dataType:"json",success:n,error:function(){return D.error("Unable to complete your request.")}})},submit_new_domain:function(e){var t;return t=ge(e).find("input[name=domain_name]").val(),Vt.clear_errors(e),Vt.ajax_submit(e,!1,function(){return D.success("Domain added."),si.add_domain(t),ge(e).find("input[name=domain_name]").val("")})},add_domain:function(e){var t;return t=ge("#domain-list"),t.append(this._hoverable_tmpl({value:e}).toHTML()),t.show()},remove_domain:function(e,t){var n,i;return i=ge(e).find(".value").text(),n=function(t){var n;return D.success("Domain removed."),n=e.parentNode,n.removeChild(e),0===n.getElementsByTagName("div").length?n.hide():void 0},E.WebRequest({url:"/developers/apps/update/remove_domain",data:{app_id:t,domain_name:i},dataType:"json",success:n,error:function(){return D.error("Unable to complete your request.")}})},show_need_users_modal:function(e){return en.show(mt("Please test this app",{comment:"Error message"}),$("app-need-users-modal")),!1},show_need_teams_modal:function(e){return en.show(mt("Please test this app",{comment:"Error message"}),$("app-need-teams-modal"))},show_name_branding_modal:function(e){return en.show(mt("Please rename this app",{comment:"Error message"}),$("app-name-branding-modal")),!1},show_need_icon_modal:function(e){return en.show(mt("Please add an icon for this app",{comment:"Error message"}),$("app-need-icon-modal")),!1},show_need_enable_users_modal:function(e){return en.show(mt("Please enable more users for this app",{comment:"Error message"}),$("app-need-enable-users-modal")),!1},show_submit_prod_status_modal:function(e){return en.show(mt("Confirm your application submission",{comment:"Error message"}),$("submit-prod-status-modal")),!1},check_for_nongenerated_oauth_tokens:function(e){var t;return t="/developers/prod_request/"+e,new Ajax.DBRequest("/developers/has_nongenerated_oauth_tokens/"+e,{onSuccess:function(e){return"true"===e.responseText?Ve.redirect(t):en.show(mt("Please auth at least one user with the OAuth flow",{comment:"Error message"}),$("app-need-nongenerated-token"))},onFailure:function(e){return Ve.redirect(t)}}),!1},hide_folder_input:function(){return ge("#folder-name").show(),ge("#folder-input").hide()},show_folder_input:function(){return ge("#folder-name").hide(),ge("#folder-input").show(),ge("#folder-input input[name=folder]").focus()}};var ri,ai;ai=INLINE_JS.twitter_auth_complete=function(e){return assert(null!=e,"user_id must be provided"),ri.onLoginSuccessCallback?ri.onLoginSuccessCallback(e):window.location.reload(),!1},ri=tt.Twitter={is_authed:function(e){return e=parseInt(e),null==ri._authed_users&&(ri._authed_users={}),ri._authed_users[e]},set_is_authed:function(e,t){return e=parseInt(e),null==ri._authed_users&&(ri._authed_users={}),ri._authed_users[e]=t},get_progress_container:function(){var e;return assert(ri.progress_container,"Twitter is missing progress_container"),e=$(ri.progress_container),assert(e,"Missing progress_container elm"),e},follow_dropbox:function(e,t){var n;return assert(null!=t,"user_id must be provided"),e.showWorking&&e.showWorking(),n=function(){return e.onFailure?e.onFailure():window.location.reload()},new Ajax.DBRequest("/twitter/follow_us",{onSuccess:function(t){return t.responseText.startsWith("ok")?e.onSuccess?e.onSuccess():void 0:n()},onFailure:function(){return n()},subject_user:t})},do_auth:function(e,t){var n,i;return assert(null!=t,"user_id must be provided"),i=u({path:"/twitter/request_token"}).updateQuery(M.UID_PARAM_NAME,t).toString(),window.open(i,"twitter_auth","width=800,height=400"),n=function(t){return ri.set_is_authed(t,!0),"function"==typeof e?e(t):void 0},ri.onLoginSuccessCallback=n},show_auth:function(e){return e&&(ri.onLoginSuccessCallback=e),xt.updateFromElm(ri.get_progress_container(),"inline-twitter-auth")},show_posting:function(){return ri.should_hide_modal()&&en.hide(),ri.get_progress_container().update(xt.fromElm("sharing-progress"))},show_complete:function(e){var t;return t=ri.get_progress_container(),t.update(xt.fromElm("sharing-posted")),ri.show_complete_into(e,t)},show_complete_into:function(e,t){var n,i,s,o,r;return n="twitter",o=mt("View tweet"),r=void 0,r=e.startsWith("ok")?"http://www.twitter.com/":e,i=t.down("#view-post"),i.href=r,i.update(o),s=ie.make("web",n),i.__sert({top:s})},post:function(e,t,n,i){var s,o;return assert(null!=i,"user_id must be provided"),assert(e,"Twitter message is empty"),s={message:e,from_referrals:ri.from_referrals,from_getspace:ri.from_getspace},new Ajax.DBRequest("/twitter_post",{parameters:s,onSuccess:function(t){var n,s;return"login"===t.responseText?(ri.onLoginSuccessCallback=function(){return ri.post(e,null,null,i)},(n=ri.custom_show_auth||ri.show_auth)()):(ri.should_hide_modal()&&en.hide(),(s=ri.onPostSuccessCallback||ri.show_complete)(t.responseText))},subject_user:i}),(o=ri.custom_show_posting||ri.show_posting)()},custom_post:function(e,t,n){return assert(null!=n,"user_id must be provided"),t&&(ri.onPostSuccessCallback=t),e?(assert(e,"Twitter message doesn't exist"),Z.get_viewer().is_signed_in?ri.post(e,null,null,n):window.open("http://www.twitter.com/home?status="+encodeURI(e))):void 0},get_user_info:function(e,t){return assert(null!=t,"user_id must be provided"),new Ajax.DBRequest("/twitter/user_info",{noAutonotify:1,parameters:{},onSuccess:function(t){return e(JSON.parse(t.responseText))},subject_user:t})},should_hide_modal:function(){return"undefined"==typeof ri.hide_modal?!0:ri.hide_modal}};var _i,li;li=tt.ShmodelLogger={CLICK_SIGN_IN:"click_sign_in",CLICK_ADD_TO_MY_DROPBOX:"click_add_to_my_dropbox",REMOVE_LINK:"remove_link",CLICK_FILENAME:"click_filename",CLICK_DOWNLOAD:"click_download",LOGIN_THRU_DEFAULT_DROPDOWN:"login_thru_default_dropdown",CLICK_SIGNUP_THRU_DEFAULT_DROPDOWN:"click_signup_thru_default_dropdown",CLICK_SHARE:"click_share",log:function(e){return new Ajax.DBRequest("/shmlog",{method:"post",noAutonotify:!0,parameters:{evt:e,url:window.location.href}})},attachLogListener:function(e,t){return null!=t?t.observe("click",function(n){return li.log(e),t.href&&"#"!==t.href&&"_blank"!==t.target?(Event.stop(n),function(){return window.location.href=t.href}.defer()):void 0}):void 0}},_i=tt.RegistrationLogger={log:function(e){var t;return t=window.location.href,new Ajax.DBRequest("/share/reglog",{method:"post",noAutonotify:!0,parameters:{evt:e,url:t}})},attachLogListener:function(e,t){return null!=t?t.observe("click",function(n){return _i.log(e),t.href&&"#"!==t.href&&"_blank"!==t.target?(Event.stop(n),function(){return window.location.href=t.href}.defer()):void 0}):void 0}};var ui;ui=tt.ModalFlow=function(){function e(e,t,n,i,s,o,r){var a,_,l,u;for(this.title=e,this.icon=t,this.states=n,this.next_state_table=i,this.previous_state_table=s,this.initial=o,this.onStart=r,this._state_map={},l=this.states,a=0,_=l.length;_>a;a++)u=l[a],this._state_map[u.name]=u;this.state=null,this._exit_listeners=[],this._cleanup_queue=[]}return e.prototype.start=function(){var e,t,n,i;for(this.vars={},n=this.states,e=0,t=n.length;t>e;e++)i=n[e],i.next=this._next.bind(this,i),i.back=this._back.bind(this,i),i.onSubmit?i.onSubmitFn=function(e,t){return e.onSubmit(this,e,t),!1}.bind(this,i):i.onSubmitFn=function(e){return function(e,t){return e.next(),!1}}(this).bind(this,i),i.contents.on("submit",i.onSubmitFn),i.contents.find(".backbutton").on("click",i.back);return en.onHide=this._onExit.bind(this),this.onStart&&this.onStart(),this.to_state(this.initial),!1},e.prototype.to_state=function(e){var t;return this.state=this._state_map[e],t=this.title,null!=this.state.title&&(t=this.state.title),en.show(t,this.state.contents[0]),this.state.enter(this)},e.prototype._next=function(e){var t;return e===this.state?(t=this.next_state_table[this.state.name](this),"__exit__"===t?this.exit():this.to_state(t)):void 0},e.prototype._back=function(e){var t;if(e===this.state){if(t=this.previous_state_table[this.state.name](this),"__cancel__"===t)return this.exit();if(t)return this.to_state(t)}},e.prototype.exit=function(){return this._onExit()},e.prototype._onExit=function(e){var t,n,i,s,o,r,a,_;for(r=this.states,t=0,i=r.length;i>t;t++)_=r[t],_.contents.off("submit",_.onSubmitFn);for(this._cleanUpExitListeners(),a=this._exit_listeners,n=0,s=a.length;s>n;n++)(o=a[n])(e);return en.onHide=null,en.hide()},e.prototype.addExitListener=function(e){return this._exit_listeners.push(e)},e.prototype.removeExitListener=function(e){return this._cleanup_queue.push(e)},e.prototype._cleanUpExitListeners=function(){var e,t,n,i,s,o;for(s=this._cleanup_queue,o=[],t=0,i=s.length;i>t;t++)e=s[t],n=this._exit_listeners.indexOf(e),o.push(this._exit_listeners.splice(n,1));return o},e}();var ci;ci=tt.TwoFactorAuth={_checkpoint_token:null,_email:null,_container_selector:null,_error_selector:null,_is_offline_setup:null,_invalid_code_count:null,_current_flow:null,set_user:function(e){return this._user=Z.get_viewer().get_user_by_id(e),assert(this._user,e+" is invalid"),ge("#twofactor-enter-password .email-placeholder").text(this._user.email)},login_init:function(){return this._container_selector="#twofactor-confirm",this._error_selector="#twofactor-confirm .error-message",this.login_listen()},login_listen:function(){return ge("#resend-link").on("click",this.resend_phone_code.bind(this)),ge("#code").focus()},init:function(){return this._container_selector=".twofactor-account-form",this._error_selector=".twofactor-account-form .error-message",this.account_listen(),ye(["external/phone_helpers","external/u2f-api"])},account_listen:function(){var e,t,n,i,s,o,r,a,_,l,u,c,d,h,m,p;return n={name:"delivery_choice",enter:function(e){return function(t){var n;return e.hide_error(),n=0,ge(".delivery-choice").each(function(){var e;return e=ge(this).height(),n=Math.max(e,n)}),ge(".delivery-choice").height(n),ge(".delivery-choice.selected > input").prop("checked",!0)}}(this),contents:ge("#twofactor-delivery-choice"),onSubmit:function(e){return function(t,n,i){return t.vars.sms=ge("#sms-choice").hasClass("selected"),t.vars.sms?n.next():e.fetch_offline_key(t,n)}}(this)},i={name:"enter_phone_number",enter:function(e){return function(t){var n,i;return e.hide_error(),e._is_offline_setup=!1,e._phone_number=null,n=$("twofactor-enter-phone"),i=e.fill_phone_number_for_edit(n,ge("#twofactor-row-"+e._user.role+" #twofactor-sms-number").text()),i.focus()}}(this),contents:ge("#twofactor-enter-phone"),onSubmit:this.submit_phone_number.bind(this)},s={name:"offline_setup",enter:function(e){return function(t){return e.hide_error(),e._is_offline_setup=!0,e._phone_number=null}}(this),contents:ge("#twofactor-offline-setup")},t={name:"confirm_phone",enter:function(e){return function(t){var n;return e._invalid_code_count=0,e._is_offline_setup?$("twofactor-enable-confirm").addClassName("offline"):(n=t.vars.phone_number,assert(n,"expected a display_phone argument"),$("phone-number-placeholder").__date(n),$("twofactor-enable-confirm").removeClassName("offline")),e.hide_error(),$("phone-code").clear().focus(),e.fill_delivery_choice(n)}}(this),onSubmit:this.submit_phone_code.bind(this),contents:ge("#twofactor-enable-confirm")},e={name:"backup_phone",enter:this.enter_backup_phone_number_shown.bind(this,"back_next"),onSubmit:this.submit_backup_phone_number.bind(this,!1,"save_none"),contents:ge("#twofactor-enter-backup-phone")},c=new ui(this.DEFAULT_ENABLE_TITLE,this.LOCK_ICON,[{name:"enable_start",enter:this.hide_error.bind(this),contents:ge("#twofactor-start")},{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.ENABLE_CONFIRM_HREF,function(e){return function(t,n){return e.successfully_enabled=!1,t.vars.mode="ENABLE",t.vars.passed_password=!0,n.next()}}(this)),contents:ge("#twofactor-enter-password")},n,i,s,t,e,{name:"recovery_code",enter:function(e){return function(){return e.fill_backup_phone(e._backup_phone),e.hide_error.bind(e)}}(this),onSubmit:this.submit_finish.bind(this,!1),contents:ge("#twofactor-recovery")},{name:"congrats_done",enter:this.after_enabled.bind(this),title:mt("Congrats! You've enabled two-step verification!"),contents:ge("#twofactor-done")}],{enable_start:function(){return"password"},password:function(){return"delivery_choice"},delivery_choice:function(e){return e.vars.sms?"enter_phone_number":"offline_setup"},enter_phone_number:function(){return"confirm_phone"},confirm_phone:function(){return"backup_phone"},backup_phone:function(){return"recovery_code"},recovery_code:function(){return"congrats_done"},congrats_done:function(){return"__exit__"},offline_setup:function(){return"confirm_phone"}},{enable_start:function(){return null},password:function(){return null},delivery_choice:function(){return null},enter_phone_number:function(){return"delivery_choice"},offline_setup:function(){return"delivery_choice"},confirm_phone:function(e){return e.vars.sms?"enter_phone_number":"offline_setup"},backup_phone:function(){return"delivery_choice"},recovery_code:function(){return"backup_phone"},congrats_done:function(){return null}},"enable_start",function(){return this.vars.passed_password=!1}),c.addExitListener(function(e){return function(t){return c.vars.passed_password&&t&&!e.successfully_enabled?D.error(mt("Two-step verification isn’t enabled")):void 0}}(this)),u=new ui(this.DEFAULT_EDIT_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e){return function(t,n){var i;return e.successfully_enabled=!1,ge(".delivery-choice").removeClass("selected"),i=!ge("#twofactor-row").hasClass("with-sms"),ge(i?"#app-choice":"#sms-choice").addClass("selected"),ge("#twofactor-recovery").addClass("edit-mode"),t.vars.passed_password=!0,n.next()}}(this)),contents:ge("#twofactor-enter-password")},n,i,s,t,{name:"backup_phone",enter:this.enter_backup_phone_number_shown.bind(this,"back_next"),onSubmit:this.submit_backup_phone_number.bind(this,!1,"save_everything"),contents:ge("#twofactor-enter-backup-phone")}],{password:function(){return"delivery_choice"},delivery_choice:function(e){return e.vars.sms?"enter_phone_number":"offline_setup"},enter_phone_number:function(){return"confirm_phone"},confirm_phone:function(){return"backup_phone"},backup_phone:function(){return"__exit__"},offline_setup:function(){return"confirm_phone"}},{password:function(){return null},delivery_choice:function(){return null},enter_phone_number:function(){return"delivery_choice"},offline_setup:function(){return"delivery_choice"},confirm_phone:function(e){return e.vars.sms?"enter_phone_number":"offline_setup"},backup_phone:function(){return"delivery_choice"}},"password",function(){return this.vars.passed_password=!1}),u.addExitListener(function(e){return function(t){return u.vars.passed_password&&t&&!e.successfully_enabled?D.error(mt("Two-step verification has not been changed")):void 0}}(this)),_=new ui(this.DEFAULT_DISABLE_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.DISABLE_CONFIRM_HREF,function(e){return function(t,n){return e.successfully_disabled=!1,t.vars.passed_password=!0,n.next()}}(this)),contents:ge("#twofactor-enter-password")},{name:"disable",enter:this.hide_error.bind(this),contents:ge("#twofactor-disable"),onSubmit:this.disable_submit.bind(this)}],{password:function(){return"disable"},disable:function(){return"__exit__"}},{password:function(){return null},disable:function(){return"__cancel__"}},"password",function(){return this.vars.passed_password=!1}),_.addExitListener(function(e){return function(t){return _.vars.passed_password&&t&&!e.successfully_disabled?D.error(mt("Two-step verification is still enabled")):void 0}}(this)),o=new ui(this.ADD_BACKUP_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e,t){return t.next()}),contents:ge("#twofactor-enter-password")},{name:"backup_phone",enter:this.enter_backup_phone_number_shown.bind(this,"cancel_save"),onSubmit:this.submit_backup_phone_number.bind(this,!0,"save_backup_phone"),contents:ge("#twofactor-enter-backup-phone")}],{password:function(){return"backup_phone"},backup_phone:function(){return"__exit__"}},{password:function(){return null},backup_phone:function(){return"__cancel__"}},"password"),l=new ui(this.EDIT_BACKUP_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e,t){return t.next()}),contents:ge("#twofactor-enter-password")},{name:"backup_phone",enter:this.enter_backup_phone_number_shown.bind(this,"cancel_save"),onSubmit:this.submit_backup_phone_number.bind(this,!1,"save_backup_phone"),contents:ge("#twofactor-enter-backup-phone")}],{password:function(){return"backup_phone"},backup_phone:function(){return"__exit__"}},{password:function(){return null},backup_phone:function(){return"__cancel__"}},"password"),h=new ui(this.EDIT_RECOVERY_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e){return function(t,n){return new Ajax.DBRequest(e.RECOVERY_CODE_HREF,{parameters:{checkpoint_token:e._checkpoint_token,use_json:!0},onSuccess:function(t){var i,s;if(s=JSON.parse(t.responseText.trim()),"OK"===s.result)return i=s.codes,e.fill_backup_codes(i,"backup-code-list-edit-container"),n.next();switch(s.result){case"EXPIRED":return e.show_error_expired();case"ALREADY_DISABLED":return ge("#twofactor-row").removeClass("twofactor-enabled"),D.success(mt("Two-step verification is already disabled. Did you maybe disable it in another window?")),en.hide()}},onFailure:e.show_error500.bind(e),cleanUp:e.hide_loading.bind(e),subject_user:e._user})}}(this)),contents:ge("#twofactor-enter-password")},{name:"recovery_code",enter:this.hide_error.bind(this),contents:ge("#twofactor-recovery-edit"),onSubmit:function(e){return function(t,n){return e._checkpoint_token=null,n.next()}}(this)}],{password:function(){return"recovery_code"},recovery_code:function(){return"__exit__"}},{password:function(){return null},recovery_code:function(){return null}},"password"),p=function(e){return function(t){return new Ajax.DBRequest(e.ADD_SECURITY_KEY_FINISH_HREF,{parameters:{checkpoint_token:e._checkpoint_token,device_response:JSON.stringify(t)},noAutonotify:!0,onSuccess:function(t){var n;return n=t.responseText.trim(),r.to_state("register_success"),ge(document).trigger("security-key-manager:UPDATE_KEYS",e._user.id)},onFailure:function(e){var t,n;return t=JSON.parse(e.responseText.substr(4)),n=null!=t.security_key_register?t.security_key_register.message_text:D.DEFAULT_ERROR,ge("#twofactor-security-key-register-error #error-msg").text(n),r.to_state("register_error")},cleanUp:e.hide_loading.bind(e),subject_user:e._user})}}(this),d=function(e){return function(t,n){return new Ajax.DBRequest(e.ADD_SECURITY_KEY_START_HREF,{parameters:{checkpoint_token:e._checkpoint_token},onSuccess:function(e){var t;return t=JSON.parse(e.responseText),u2f.register(t.registerRequests,t.authenticateRequests,p),n.next()},onFailure:e.show_error500.bind(e),cleanUp:e.hide_loading.bind(e),subject_user:e._user})}}(this),m=new ui(this.ADD_SECURITY_KEY_TITLE,this.LOCK_ICON,[{name:"unsupported_browser",enter:this.hide_error.bind(this),contents:ge("#twofactor-security-key-unsupported-browser")}],{unsupported_browser:function(){return"__exit__"}},{},"unsupported_browser"),a=new ui("Confirm password",this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e){return function(t,n){return ge(document).trigger("security-key-modal:PASSWORD_CONFIRMED",[e._user.id,e._checkpoint_token]),en.hide()}}(this)),contents:ge("#twofactor-enter-password")}],{password:function(){return"__exit__"}},{},"password"),r=new ui(this.ADD_SECURITY_KEY_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e,t){return t.next()}),contents:ge("#twofactor-enter-password")},{name:"intro",enter:this.hide_error.bind(this),contents:ge("#twofactor-security-key-intro")},{name:"prepare_register",enter:this.hide_error.bind(this),contents:ge("#twofactor-security-key-prepare-register"),onSubmit:d},{name:"register",enter:this.hide_error.bind(this),contents:ge("#twofactor-security-key-register")},{name:"register_error",enter:this.hide_error.bind(this),contents:ge("#twofactor-security-key-register-error"),onSubmit:d},{name:"register_success",enter:function(e){return function(){return e.hide_error.bind(e),e._checkpoint_token=null}}(this),onSubmit:function(e,t){return D.success(mt("Successfully added security key.")),t.next()},contents:ge("#twofactor-security-key-register-success")}],{password:function(){return"intro"},intro:function(){return"prepare_register"},prepare_register:function(){return"register"},register:function(){return"register_success"},register_error:function(){return"register"},register_success:function(){return"__exit__"}},{},"password"),this._bind_phone_input_to_save_button(),this._register_skip_link_click_to_submit_finish(),ge(".enable-twofactor").on("click",function(e){return function(t){return e.start_flow(t,c)}}(this)),ge(".disable-twofactor").on("click",function(e){return function(t){return e.start_flow(t,_)}}(this)),ge(".add-twofactor-backup-link").on("click",function(e){return function(t){return e.start_flow(t,o)}}(this)),ge(".edit-twofactor-backup").on("click",function(e){return function(t){return e.start_flow(t,l)}}(this)),ge(".edit-twofactor-recovery").on("click",function(e){return function(t){return e.start_flow(t,h)}}(this)),ge(".edit-twofactor-sms, .edit-twofactor-offline").on("click",function(e){return function(t){return e.start_flow(t,u)}}(this)),ge(document).on("twofactor:ADD_SECURITY_KEY",function(e){return function(t,n){return ge("#twofactor-security-key-unsupported-browser").length?e.start_flow(t,m,n):e.start_flow(t,r,n)}}(this)),ge(document).on("twofactor:ASK_PASSWORD_CONFIRM",function(e){return function(t,n){return e.start_flow(t,a,n)}}(this)),ge("#generate-new-recovery-code").on("click",function(e){return function(t){return e.show_loading(),new Ajax.DBRequest(e.NEW_RECOVERY_CODE_HREF,{parameters:{checkpoint_token:e._checkpoint_token,use_json:!0},onSuccess:function(t){var n,i;if(n=t.responseText.trim(),i=JSON.parse(n),"OK"===i.result)return e.fill_backup_codes(i.codes,"backup-code-list-edit-container");switch(n){case"EXPIRED":return h.to_state("password"),e.show_error_expired();case"ALREADY_DISABLED":return $("twofactor-row").removeClassName("twofactor-enabled"),D.success(mt("Two-step verification is disabled. Did you maybe disable it in another window?")),en.hide()}},onFailure:e.show_error500.bind(e),cleanUp:e.hide_loading.bind(e),subject_user:e._user})}}(this)),ge("#twofactor-enter-backup-phone #country-code").on("change",this.reset_phone_field.bind(this)),ge("#resend-link").on("click",this.enable_resend_phone_code.bind(this)),ge("#twofactor-delivery-choice input").change(function(){return ge(".delivery-choice").removeClass("selected"),ge(this).parents(".delivery-choice").addClass("selected")}),ge("#show-qr").on("click",function(e){return ge("#twofactor-offline-setup").addClass("showing-qr"),!1}),ge("#hide-qr").on("click",function(e){return ge("#twofactor-offline-setup").removeClass("showing-qr"),!1}),"#backup2fa"===window.location.hash&&ge("#twofactor-row").hasClass("allow-autopop")?this.start_flow(o):void 0},_bind_phone_input_to_save_button:function(){return this.$save_button=ge("#twofactor-enter-backup-phone").find(".back-next").find(".savebutton"),this.$phone_input=ge("#twofactor-enter-backup-phone").find(".twofactor-backup-phone-number").find(".phone-text"),this.$phone_input.on("keyup",function(e){return function(t){return e._toggle_save_phone_button(e.$phone_input,e.$save_button)}}(this)),this.$phone_input.on("input",function(e){return function(t){return e._toggle_save_phone_button(e.$phone_input,e.$save_button)}}(this)),this._toggle_save_phone_button(this.$phone_input,this.$save_button)},_register_skip_link_click_to_submit_finish:function(){return ge("#twofactor-enter-backup-phone").find(".back-next").find("#skipstep").on("click",function(e){return function(){return e.submit_finish(!0,e._current_flow,e._current_flow.state,null)}}(this))},_toggle_save_phone_button:function(e,t){var n;return n=""===ge.trim(e.val()),t.prop("disabled",n)},start_flow:function(e,t,n){return null==n&&(n=null),e.preventDefault(),delete this._phone_number,null==n&&(n=ge(e.target).data("uid")),ci.set_user(Z.get_viewer().get_user_by_id(n)),this._current_flow=t,t.start(),!1},connect_login_init:function(){return this._container_selector="#twofactor-form",this._error_selector="#twofactor-form .error",ge("#resend-link").on("click",this.connect_resend_phone_code.bind(this))},resend_phone_code:function(e){var t;if(!this.is_resending())return this.show_resending(),t="/twofactor_resend",ge("#twofactor-confirm").hasClass("backup")&&(t=u.parse(t).updateQuery({backup:!0}).toString()),new Ajax.DBRequest(t,{onSuccess:function(e){return function(t){switch(t.responseText.trim()){case"OK":return e.hide_error(),e.notify_resent();case"UNREACHABLE":return e.show_error_unreachable(!0);case"BADCARRIER":return e.show_error_bad_carrier();case"INVALIDNUMBER":return e.show_error_invalid_number();case"NOTAMOBILE":return e.show_error_not_a_mobile();case"RATELIMIT":return D.error(mt("You've asked for too many SMS messages. Please try again in a few minutes."));case"EXPIRED":return $("twofactor-confirm").submit()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_resending_with_delay.bind(this)}),!1},connect_resend_phone_code:function(e){return this.is_resending()?void 0:(this.show_resending(),new Ajax.DBRequest("/twofactor_resend",{onSuccess:function(e){return function(t){switch(t.responseText.trim()){case"OK":return e.hide_error(),e.notify_resent();case"UNREACHABLE":return D.error(e.error_unreachable(!0));case"BADCARRIER":return D.error(e.error_bad_carrier());case"INVALIDNUMBER":return e.show_error_invalid_number();case"NOTAMOBILE":return D.error(e.error_not_a_mobile());case"RATELIMIT":return D.error(mt("You've asked for too many SMS messages. Please try again in a few minutes."));case"EXPIRED":return $("twofactor-form").submit()}}}(this),onFailure:function(e){return function(t){return D.error(e.error500())}}(this),cleanUp:this.hide_resending_with_delay.bind(this)}),!1)},enable_resend_phone_code:function(e){return this.is_resending()?void 0:(this.show_resending(),new Ajax.DBRequest("/twofactor_resend",{onSuccess:function(e){return function(t){switch(t.responseText.trim()){case"OK":return e.hide_error(),e.notify_resent();case"UNREACHABLE":return e.show_error_unreachable();case"BADCARRIER":return e.show_error_bad_carrier();case"INVALIDNUMBER":return e.show_error_invalid_number();case"NOTAMOBILE":return e.show_error_not_a_mobile();case"RATELIMIT":return D.error("You've asked for too many SMS messages. Please try again in a few minutes.");case"EXPIRED":return e._current_flow.to_state("password"),e.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_resending_with_delay.bind(this)}),!1)},DEFAULT_ENABLE_TITLE:mt("Enable two-step verification"),DEFAULT_EDIT_TITLE:mt("Edit two-step verification"),DEFAULT_DISABLE_TITLE:mt("Disable two-step verification"),ADD_BACKUP_TITLE:mt("Add a backup phone number"),EDIT_BACKUP_TITLE:mt("Edit backup phone number"),EDIT_RECOVERY_TITLE:mt("View backup codes"),ADD_SECURITY_KEY_TITLE:mt("Add security key"),LOCK_ICON:"lock32",ENABLE_CONFIRM_HREF:"/account/twofactor/confirm_password",DISABLE_CONFIRM_HREF:"/account/twofactor/disable_confirm_password",EDIT_CONFIRM_HREF:"/account/twofactor/edit_confirm_password",ADD_SECURITY_KEY_START_HREF:"/account/twofactor/u2f_start_registration",ADD_SECURITY_KEY_FINISH_HREF:"/account/twofactor/u2f_finish_registration",RECOVERY_CODE_HREF:"/account/twofactor/get_rescue_code",NEW_RECOVERY_CODE_HREF:"/account/twofactor/new_rescue_code",enter_password_shown:function(){var e;return this.hide_error(),ge("#twofactor-recovery").removeClass("edit-mode"),e=$("twofactor-enter-password"),ge("#password",e).val("").focus(),!1},submit_password:function(e,t,n,i,s){var o;return(o=$("password").getValue())?(this.show_loading(),new Ajax.DBRequest(e,{parameters:{password:o},onSuccess:function(e){return function(s){var o;if(o=s.responseText.trim(),o.startsWith("OK:"))return e._checkpoint_token=o.substr(3),t(n,i);switch(o){case"EXPIRED_PASSWORD":return e.show_error_expired_password();case"INVALID":return e.show_error(mt("Invalid password"));case"RATELIMIT":return e.show_error(mt("Too many incorrect passwords. Please try again in a few minutes."));case"ALREADY_ENABLED":return $("twofactor-row").addClassName("twofactor-enabled"),D.success(mt("Two-step verification is already enabled. Did you maybe enable it in another window?")),en.hide();case"ALREADY_DISABLED":return $("twofactor-row").removeClassName("twofactor-enabled"),D.success(mt("Two-step verification is already disabled. Did you maybe disable it in another window?")),en.hide()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})):void this.show_error(mt("Please enter your password"))},fetch_offline_key:function(e,t){return this.show_loading(),new Ajax.DBRequest("/account/twofactor/add_phone",{parameters:{checkpoint_token:this._checkpoint_token,offline:!0},onSuccess:function(n){return function(i){var s;if(s=i.responseText.trim(),s.startsWith("OK:"))return n.fill_key(s.substr(3)),t.next();switch(s){case"EXPIRED":return e.to_state("password"),n.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})},fill_key:function(e){var t,n,i;return e=e.replace(new RegExp("=+$"),""),t=e.toLowerCase().replace(/(.{4})/g,"$1 "),$("secret-div").__date(t),$("qr-div").__date(),i=fe.IS_PROD?"Dropbox":"DropboxDev",n={text:"otpauth://totp/"+i+":"+this._user.email+"?secret="+e+"&issuer="+i,width:200,height:200},ke.canvas||(n.render="table"),ge("#qr-div").qrcode(n),ke.canvas?void 0:ge("#qr-div > table").css("margin","0 auto")},submit_phone_number:function(e,t,n){var i,s;return i=ge("#twofactor-enter-phone .twofactor-phone-number"),ee.get_controller(i).validate_on_submit()?(s=i.val(),this.show_loading(),new Ajax.DBRequest("/account/twofactor/add_phone",{parameters:{checkpoint_token:this._checkpoint_token,phone_number:s},onSuccess:function(n){return function(o){switch(o.responseText.trim()){case"OK":return n._phone_number=s,e.vars.phone_number=s,t.next();case"EXPIRED":return e.to_state("password"),n.show_error_expired();case"UNREACHABLE":return n.show_error_unreachable(i);case"BADCARRIER":return n.show_error_bad_carrier(i);case"INVALIDNUMBER":return n.show_error_invalid_number(i);case"NOTAMOBILE":return n.show_error_not_a_mobile(i);case"RATELIMIT":return n.show_error(mt("You've added too many phone numbers. Please try again in a few minutes."))}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})):void 0},submit_phone_code:function(e,t,n){var i;return(i=$("phone-code").getValue().trim())?-1===i.search(/^\d{6}$/)?void this.show_error(mt("Invalid security code")):(this.show_loading(),new Ajax.DBRequest("/account/twofactor/confirm_phone",{parameters:{checkpoint_token:this._checkpoint_token,twofactor_code:i,use_json:!0
},onSuccess:function(n){return function(i){var s,o;if(o=JSON.parse(i.responseText.trim()),"OK"===o.result)return n.fill_backup_codes(o.codes,"backup-code-list-container"),t.next();switch(o.result){case"INVALID":return n._invalid_code_count+=1,s=mt(n._invalid_code_count<=2?"Invalid code":n._is_offline_setup?"Invalid code. Check the clock on your phone: it must be accurate to the minute.":"Invalid code"),n.show_error(s);case"EXPIRED":return e.to_state("password"),n.show_error_expired();case"RATELIMIT":return n.show_error(mt("Too many invalid codes. Try again in a few minutes."))}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})):void this.show_error(mt("Please enter the security code"))},enter_backup_phone_number_shown:function(e,t){var n,i;return this.hide_error(),n=$("twofactor-enter-backup-phone"),i=this.fill_phone_number_for_edit(n,ge("#twofactor-row-"+this._user.role+" #twofactor-backup-number").text()),i.focus(),"back_next"===e?(ge("#twofactor-backup-back-next").show(),ge("#twofactor-backup-cancel-save").hide(),ge("#twofactor-backup-back-save").hide()):"cancel_save"===e?(ge("#twofactor-backup-back-next").hide(),ge("#twofactor-backup-cancel-save").show(),ge("#twofactor-backup-back-save").hide()):"back_save"===e?(ge("#twofactor-backup-back-next").hide(),ge("#twofactor-backup-cancel-save").hide(),ge("#twofactor-backup-back-save").show()):void 0},submit_backup_phone_number:function(e,t,n,i,s){var o,r;if(o=ge("#twofactor-enter-backup-phone .twofactor-backup-phone-number"),ee.get_controller(o).validate_on_blur()){if(r=o.val()){if(this.is_primary_number(r))return void ee.get_controller(o).show_error(mt("You can’t use your primary phone as your backup"),o)}else if(e)return void ee.get_controller(o).show_error(mt("Please enter phone number"),o);if(this._backup_phone=r,"save_backup_phone"===t)this.save_added_backup_phone(n,e,r);else if("save_everything"===t)this.submit_finish(!1,n,i,s);else if("save_none"===t)return i.next()}},is_same_phone_number:function(e,t){return e&&t?e.replace(/\D+/g,"")===t.replace(/\D+/g,""):!1},is_primary_number:function(e){var t;return t=ge("#twofactor-row-"+this._user.role),this._is_offline_setup?!1:this._phone_number?this.is_same_phone_number(e,this._phone_number):this.is_same_phone_number(e,t.data("primary_phone"))?!0:!!this.is_same_phone_number(e,ge("#twofactor-sms-number",t).text())},save_added_backup_phone:function(e,t,n){return this.show_loading(),new Ajax.DBRequest("/account/twofactor/set_backup_phone",{parameters:{checkpoint_token:this._checkpoint_token,backup_phone_number:n},onSuccess:function(i){return function(s){var o;switch(s.responseText.trim()){case"OK":return i.hide_error(),o="#twofactor-row-"+i._user.role,ge(o+" #twofactor-backup-number").text(n),ge(o).toggleClass("with-backup",!!n),n?t?D.success(mt("Backup phone number added")):D.success(mt("Backup phone number updated")):D.success(mt("Backup phone number removed")),en.hide();case"EXPIRED":return e.to_state("password"),i.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})},fill_phone_number_for_edit:function(e,t){var n,i;return i=ge("input.text-input-input",e),t?(n=ee.get_controller(ge(".phone-number-input",e)),n.set(t),i.val(n.get_local_number()),i.length&&i[0].select(),ge("#twofactor-backup-back-save").find("#skipstep").hide(),ge(".text-input-wrapper").find("label").hide(),i):i.val("")},fill_delivery_choice:function(e){return ge("#twofactor-delivery-phone-label,#confirm-phone-primary").toggle(!!e),ge("#twofactor-delivery-offline-label").toggle(!e),ge("#confirm-phone-primary-number").text(e),ge("#twofactor-row-"+this._user.role).data("primary_phone",e)},fill_backup_phone:function(e){return ge("#confirm-phone-backup").toggle(!!e),ge("#confirm-phone-backup-number").text(e)},insert_spaces_into_code:function(e){return e.toLowerCase().replace(/(.{4})/g,"$1 ")},fill_backup_codes:function(e,t){var n,i,s,o,r,a,_;if(i=ge("#"+t),i.empty(),n=ge("<ol/>",{class:"twofactor-backup-list"}),0===e.length)return i.siblings().css("display","none"),ge(".codesbox__error").css("display","block");for(o=e[0].length,16===o&&n.css("column-count","1"),r=0,a=e.length;a>r;r++)s=e[r],_=ge("<li/>",{class:"twofactor-backup-list__item"}),n.append(_.append(ge("<span/>",{class:"twofactor-backup-list__code",text:this.insert_spaces_into_code(s)})));return i.append(n),i.siblings().css("display","block"),ge(".codesbox__error").css("display","none")},submit_finish:function(e,t,n,i){var s;return this.show_loading(),s={checkpoint_token:this._checkpoint_token},this._backup_phone&&!e&&(s.backup_phone_number=this._backup_phone),new Ajax.DBRequest("/account/twofactor/enable_finish",{parameters:s,onSuccess:function(e){return function(i){switch(i.responseText.trim()){case"OK":return e.successfully_enabled=!0,"ENABLE"!==t.vars.mode?e.after_enabled(t,n):n.next();case"EXPIRED":return t.to_state("password"),e.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})},after_enabled:function(e,t){var n,i;return this._checkpoint_token=null,this.hide_error(),n=ge("#twofactor-row-"+this._user.role),n.toggleClass("with-sms",!!this._phone_number),ge("#twofactor-sms-number",n).text(this._phone_number||""),n.toggleClass("with-backup",!!this._backup_phone),ge("#twofactor-backup-number",n).text(this._backup_phone||""),n.addClass("twofactor-enabled"),ge("tr[id^='session_row_']").slice(1).hide(),"ENABLE"!==e.vars.mode?(i="/account/#security",D.success(new Qe(mt('Two-step verification updated. Any <a href="%(path)s">existing sessions, devices and apps</a> can still access your Dropbox.').format({path:i}))),null!=t?t.next():void 0):void 0},disable_submit:function(e,t){return this.show_loading(),new Ajax.DBRequest("/account/twofactor/disable",{parameters:{checkpoint_token:this._checkpoint_token},onSuccess:function(n){return function(i){var s;switch(i.responseText.trim()){case"OK":return n.successfully_disabled=!0,n._checkpoint_token=null,s=ge("#twofactor-row-"+n._user.role),s.removeClass("twofactor-enabled with-sms with-backup"),ge(document).trigger("security-key-manager:UPDATE_KEYS",n._user.id),ge("#twofactor-sms-number, #twofactor-backup-number",s).text(""),ge("tr[id^='session_row_']").slice(1).hide(),D.success(mt("Two-step verification is now disabled.")),t.next();case"EXPIRED":return e.to_state("password"),n.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})},show_error:function(e,t){var n;return t?void ee.get_controller(t).show_error(e):(n=$$(this._error_selector),e===this.error_expired_password()||e===this.error_unreachable(!0)?n.invoke("update",e):n.invoke("__date",e),n.invoke("show"))},show_error500:function(){return this.show_error(this.error_500())},show_error_bad_carrier:function(e){return this.show_error(this.error_bad_carrier(),e)},show_error_invalid_number:function(e){return this.show_error(this.error_invalid_number(),e)},show_error_not_a_mobile:function(e){return this.show_error(this.error_not_a_mobile(),e)},show_error_unreachable:function(e,t){return null==t&&(t=!1),this.show_error(this.error_unreachable(t),e)},show_error_expired:function(e){return this.show_error(this.error_expired(),e)},show_error_expired_password:function(e){return this.show_error(this.error_expired_password(),e)},error_500:function(){return mt("Sorry, an error occurred. Please try again later.")},error_bad_carrier:function(){return mt("Unfortunately, your carrier isn’t supported at this time.")},error_invalid_number:function(){return mt("That isn’t a valid phone number.")},error_not_a_mobile:function(){return mt("That phone number doesn’t appear to be a valid mobile number.")},error_unreachable:function(e){return null==e&&(e=!1),mt(e?'We couldn\'t reach your phone number. If this has happened before <a href="https://www.dropbox.com/help/364/">click here</a>.':"We couldn't reach your phone number. Are you sure it's correct?")},error_expired:function(){return mt("Since it's been a while, please enter your password again.")},error_expired_password:function(){return mt('Your password has expired. Please create a new password <a target="_blank" href="/password_expired">here</a>.')},hide_error:function(){return $$(this._error_selector).invoke("__date")},show_loading:function(){return this.hide_error(),$$(this._container_selector).invoke("addClassName","loading")},hide_loading:function(){return $$(this._container_selector).invoke("removeClassName","loading")},is_resending:function(){return $$(this._container_selector)[0].hasClassName("resending")},show_resending:function(){return $$(this._container_selector).invoke("addClassName","resending")},hide_resending:function(){return $$(this._container_selector).invoke("removeClassName","resending")},hide_resending_with_delay:function(){return setTimeout(this.hide_resending.bind(this),3e3)},notify_resent:function(){return D.success(mt("We sent you another code. It may take a few minutes to arrive."))},reset_phone_field:function(e){var t,n;return t=e.element(),n=ge(".sick-input",t.form),ge("input",n).val("").focus(),this.fill_example_phone_number(t,n)},fill_example_phone_number:function(e,t){var n,i;return"undefined"!=typeof phone_helpers&&null!==phone_helpers?(n=ge(e).val().substr(1),i=phone_helpers.get_example_mobile_number(n),ge("label",t).text(mt("Example: ")+i)):void 0},reset_phone_field_and_backup_country:function(e){var t;return this.reset_phone_field(e),""===ge("#backup-phone-number").val()?(t=ge("#twofactor-enter-backup-phone #country-code"),t.val(e.element().getValue()),this.fill_example_phone_number(t,ge(".sick-input",t[0].form))):void 0}};var di,hi,mi;mi=tt.UnsupportedBrowser={init:function(){return ge("#unsupported-browser-dismiss").on("click",function(e){return e.preventDefault(),pt.hide(),E.SilentBackgroundRequest({url:"/dismiss_browser_msg"})})}},hi=tt.ExpiredCCNotificationBar={init:function(e){return ge(".expired-dismiss").on("click",function(t){return t.preventDefault(),pt.hide(),E.SilentBackgroundRequest({url:"/dismiss_expired_cc_notification",data:{source:e}})})}},di=tt.BetaLocaleNotificationBar={init:function(e){return ge(".beta-locale-dismiss").on("click",function(t){return t.preventDefault(),pt.hide(),E.SilentBackgroundRequest({url:"/dismiss_beta_locale_notification",data:{source:e}})})}};var pi;pi=INLINE_JS.viewer=Z.get_viewer();var fi,vi,gi,wi;if(ge(ii.check_timezone),window._document_observe_listeners)for(wi=window._document_observe_listeners,fi=0,vi=wi.length;vi>fi;fi++)gi=wi[fi],document.loaded?gi.func():document.observe(gi.event,gi.func);return ge(function(){return Event.fire(document,"script:loaded")}),tt});
//# sourceMappingURL=dropbox.min.js-vflgZc2wt.map